var deviceWidth=document.documentElement.clientWidth;if(deviceWidth>750){deviceWidth=750;}document.documentElement.style.fontSize=deviceWidth/7.5+"px";
require.config({baseUrl:"./",paths:{zepto:"js/zepto.min",text:"js/requirejs/plugins/text",json:"js/requirejs/plugins/json",async:"js/requirejs/plugins/async",BMap:"http://api.map.baidu.com/api?v=2.0&ak=eM1XK6ESgAmeTi6WrMSZeXVd"}});
require(["zepto","async!BMap"],function(g){var c=g("#mapWrap");window.$mapWrap=c;var b=g("#searchSort");window.$searchSort=b;f();g("body").on("tap",".iconBack",function(h){h.stopPropagation();
var i=g(this).parents(".secondWrap,.resultWrap");i.animate({left:"100%"},function(){if(i.hasClass("resultWrap")){i.hide();}else{i.remove();}});});var a=false;
g("body").on("tap","#chooseKmButton",function(){if(!a){g(this).parents(".chooseDistance").children(".chooseKm").show();a=true;}else{g(this).parents(".chooseDistance").children(".chooseKm").hide();
a=false;}});function f(){var i=new BMap.Map("allmap");i.addControl(new BMap.MapTypeControl());i.enableScrollWheelZoom(true);i.centerAndZoom("上海",15);window.map=i;
var h=new BMap.Geolocation();window.geolocation=h;h.getCurrentPosition(function(k){if(this.getStatus()==BMAP_STATUS_SUCCESS){var j=new BMap.Marker(k.point);
i.addOverlay(j);i.panTo(k.point);}else{}},{enableHighAccuracy:true});}document.onkeydown=function(i){var h=document.all?window.event:i;if(h.keyCode==13){e();
}};g("body").on("tap","#chooseKm span",function(){var i=g(this).text();var h=g(this).attr("data");g("#kmsum").text(i).attr("data",h);g(this).parent("#chooseKm").hide();
e();a=false;});function e(){var i=g("#mapSearchText").val();var h="r-result";var j=g("#kmsum").attr("data");d(i,h,j);}g("body").on("tap","#searchSort > span",function(){g(this).addClass("current").siblings().removeClass("current");
var i=g("#mapSearchText").val();var h="r-result";var k=g("#kmsum").attr("data");var j=g(this).find(".stext").text();d(i,h,k,j);});function d(l,h,i,p){if(l==""||l==null){alert("请输入地址");
}map.clearOverlays();var n=["超市","菜场","批发市场","餐饮企业"];if(p==null){p=n;}var j,m,o;var o=0;var k=new BMap.Geocoder();k.getPoint(l,function(q){if(q){map.centerAndZoom(q,15);
map.addOverlay(new BMap.Marker(q));j=new BMap.Circle(q,i,{fillColor:"blue",strokeWeight:1,fillOpacity:0.3,strokeOpacity:0.3});map.addOverlay(j);m=new BMap.LocalSearch(map,{renderOptions:{map:map,panel:h,autoViewport:false},onSearchComplete:function(v){var t="";
if(p==n){for(var u=0;u<v.length;u++){o+=v[u].getNumPois();}t+='<div class="searchSort" id="searchSort"><span id="marketBtn"><span class="marketSUM">'+v[0].getNumPois()+'</span><span class="stext">超市</span></span><span id="foodmarketBtn"><span class="foodmarketSUM">'+v[1].getNumPois()+'</span><span class="stext">菜场</span></span><span id="wholesalemarketBtn"><span class="wholesalemarketSUM">'+v[2].getNumPois()+'</span><span class="stext">批发市场</span></span><span id="cateringbusinessBtn"><span class="cateringbusinessSUM">'+v[3].getNumPois()+'</span><span class="stext">餐饮企业</span></span></div>';
if(b.length>=1){b.remove();}c.append(t);g("#mapserachResultSum").html('<span>共有</span><span class="mapSearchSum">'+o+"</span><span>个节点</span>");}else{o=v.getNumPois();
g("#mapserachResultSum").html('<span>已选</span><span class="mapSearchSum">'+o+'</span><span>个节点</span> <span class="iconfont icon-liebiao" id="showDetailList"></span>');
}},pageCapacity:10});m.searchNearby(p,q,1000);var s="";s+='<div class="traceList" id="traceList"><h1>可追溯的商品</h1><span class="traceBox"><span class="tracepro"><a>雨润猪肉</a><a>精气神猪肉</a><a>双汇猪肉</a><a>牛肉</a><a>鸡肉</a><a>双汇猪肉</a><a>雨润猪肉</a><a>精气神猪肉</a><a>双汇猪肉</a><a>牛肉</a><a>鸡肉</a><a>双汇猪肉</a></span></span></div>';
var r=g("#traceList");if(r.length>=1){r.remove();}c.append(s);}else{alert("您选择地址没有解析到结果!");}},"上海市");}g("body").on("tap","#showDetailList",function(){g("#r-result").parents(".resultWrap").show().animate({left:"0"});
});g("body").on("tap","#r-result li",function(){var j="超市";var h="大道";var l="1km";var k="";k+='<div class="searchListHead"><span class="iconfont icon-jiantouBack iconBack"></span><div class="headlist" id="head-searchThumb"><span class="headName">'+j+'</span><span class="headAddress">'+h+'</span><span class="headtance"><span class="iconfont icon-iconfontluxiandaohang"></span> <label class="headDistance">'+l+"</label></span></div></div>";
var i='<div class="searchListBody" id="searchThumbBox"><ul class="searchThumblist" id="searchThumblist"></ul></div>';c.append('<div class="secondWrap" id="searchThumbBox"></div>');
g("#searchThumbBox").animate({left:"0"}).html(k+i);g.getJSON("json/searchThumb.json",function(o){var n="";for(var m=0;m<o.length;m++){n+='<li><a><img class="thumbimg" src="'+o[m].img+'"><p class="thumbname">'+o[m].name+'</p><p class="thumbcodename">'+o[m].tcodename+'</p><p class="thumbcode">'+o[m].tcode+'</p><p class="thumbline"><span class="iconfont icon-dao"></span><span class="iconfont icon-car2"></span><span class="iconfont icon-fangziall"></span><span class="iconfont icon-gouwuche"></span></p></li></a>';
}g("#searchThumblist").html(n);});});g("body").on("tap","#searchThumblist a",function(){var m=g(this).find(".thumbimg").attr("src");var h=g(this).find(".thumbname").text();
var k=g(this).find(".thumbcodename").text();var q=g(this).find(".thumbcode").text();var i=g(this).parents(".secondWrap").find(".headName").text();var j=g(this).parents(".secondWrap").find(".headAddress").text();
var l=g(this).parents(".secondWrap").find(".headDistance").text();var p="";p+='<div class="searchListHead"><span class="iconfont icon-jiantouBack iconBack"></span><div class="headlist" id="head-searchThumb"><span class="headName">'+i+'</span><span class="headAddress">'+j+'</span><span class="headtance"><span class="iconfont icon-iconfontluxiandaohang"></span> <label class="headDistance">'+l+"</label></span></div></div>";
var o='<div class="searchListBody" id="searchThumblistBox"></div>';c.append('<div class="secondWrap" id="searchThumbDetailBox"></div>');g("#searchThumbDetailBox").animate({left:"0"}).html(p+o);
var n="";n+='<img class="tImg" src="'+m+'"><p class="tName">'+h+'</p><p class="tCodeName"><label>'+k+'：</lable><span class="tCode">'+q+'</span></p><div class="tLine"><div class="tLineTool clearfix"><span class="iconfont icon-dao"></span><div class="tooltipsbox"><h1>屠宰</h1><p>建东屠宰场</p><span>2017-05-05 00:28</span></div></div><div class="tLineTool clearfix"><span class="iconfont icon-car2"></span><div class="tooltipsbox"><h1>屠宰</h1><p>建东屠宰场</p><span>2017-05-05 00:28</span></div></div><div class="tLineTool clearfix"><span class="iconfont icon-fangziall"></span><div class="tooltipsbox"><h1>屠宰</h1><p>建东屠宰场</p><span>2017-05-05 00:28</span></div></div><div class="tLineTool clearfix"><span class="iconfont icon-gouwuche"></span><div class="tooltipsbox"><h1>屠宰</h1><p>建东屠宰场</p><span>2017-05-05 00:28</span></div></div></div>';
g("#searchThumblistBox").html(n);});g("body").on("tap","#headList li",function(){var i=g(this).children(".iconfont");var j=g(this);var h=g(this).parents(".resultWrap");
j.addClass("current").siblings().removeClass("current");if(i.hasClass("icon-kongdown")){i.addClass("icon-kongup").removeClass("icon-kongdown");j.siblings().children(".iconfont").removeClass("icon-kongup").addClass("icon-kongdown");
j.parents(".searchListHead").children("#categoriesBox").show();if(h.find(".fixed").length>=1){h.find(".fixed").remove();}h.append('<div class="fixed"></div>');
}else{i.addClass("icon-kongdown").removeClass("icon-kongup");j.parents(".searchListHead").children("#categoriesBox").hide();h.find(".fixed").remove();}});
g("body").on("tap","#categoriesList > span",function(){g(this).addClass("current").siblings().removeClass("current");});});