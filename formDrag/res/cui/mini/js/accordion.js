/*! cui 2016-11-08 */
$.component("coral.accordion",{version:"4.0.1",options:{active:0,a:[],animate:{params:{},duration:300,easing:"swing"},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"cui-icon-arrow-down3",header:"cui-icon-arrow-up3"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var a=this.options;a.icons=$.coral.toFunction(a.icons),this.options.a.push("ddd"),this.prevShow=this.prevHide=$(),this.element.addClass("coral-accordion ctrl-init ctrl-init-accordion coral-component coral-helper-reset").attr("role","tablist"),a.collapsible||a.active!==!1&&null!=a.active||(a.active=0),this._processPanels(),a.active<0&&(a.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():$()}},_createIcons:function(){var a=this.options.icons;a&&($("<span>").addClass("coral-accordion-header-icon icon "+a.header).prependTo(this.headers),this.active.children(".coral-accordion-header-icon").removeClass(a.header).addClass(a.activeHeader),this.headers.each(function(){var a=$.parser.parseOptions(this);0==a.collapsible?$(this).children(".coral-accordion-header-icon").remove():$(this).addClass("coral-accordion-icons")}))},_destroyIcons:function(){this.headers.removeClass("coral-accordion-icons").children(".coral-accordion-header-icon").remove()},_destroy:function(){var a;this.element.removeClass("coral-accordion coral-component coral-helper-reset").removeAttr("role"),this.headers.removeClass("coral-accordion-header coral-accordion-header-active coral-state-default coral-corner-all coral-state-active coral-state-disabled coral-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),a=this.headers.next().removeClass("coral-helper-reset coral-widget-content coral-corner-bottom coral-accordion-content coral-accordion-content-active coral-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&a.css("height","")},_setOption:function(a,b){return"active"===a?void this._activate(b):("event"===a&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(b)),this._super(a,b),"collapsible"!==a||b||this.options.active!==!1||this._activate(0),"icons"===a&&(this._destroyIcons(),b&&this._createIcons()),void("disabled"===a&&(this.element.toggleClass("coral-state-disabled",!!b).attr("aria-disabled",b),this.headers.add(this.headers.next()).toggleClass("coral-state-disabled",!!b))))},_keydown:function(a){if(!a.altKey&&!a.ctrlKey){var b=$.coral.keyCode,c=this.headers.length,d=this.headers.index(a.target),e=!1;switch(a.keyCode){case b.RIGHT:case b.DOWN:e=this.headers[(d+1)%c];break;case b.LEFT:case b.UP:e=this.headers[(d-1+c)%c];break;case b.SPACE:case b.ENTER:this._eventHandler(a);break;case b.HOME:e=this.headers[0];break;case b.END:e=this.headers[c-1]}e&&($(a.target).attr("tabIndex",-1),$(e).attr("tabIndex",0),e.focus(),a.preventDefault())}},_panelKeyDown:function(a){a.keyCode===$.coral.keyCode.UP&&a.ctrlKey&&$(a.currentTarget).prev().focus()},refresh:function(){var a=this.options;this._processPanels(),a.active===!1&&a.collapsible===!0||!this.headers.length?(a.active=!1,this.active=$()):a.active===!1?this._activate(0):this.active.length&&!$.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".coral-state-disabled").length?(a.active=!1,this.active=$()):this._activate(Math.max(0,a.active-1)):a.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("coral-accordion-header coral-state-default coral-corner-all"),this.headers.next().addClass("coral-accordion-content coral-helper-reset coral-component-content coral-corner-bottom").filter(":not(.coral-accordion-content-active)").hide()},_refresh:function(){var a,b=this.options,c=b.heightStyle,d=this.element.parent();this.active=this._findActive(b.active).addClass("coral-accordion-header-active coral-state-active coral-corner-top").removeClass("coral-corner-all"),this.active.next().addClass("coral-accordion-content-active").show(),this.headers.attr("role","tab").each(function(){var a=$(this),b=a.uniqueId().attr("id"),c=a.next(),d=c.uniqueId().attr("id");a.attr("aria-controls",d),c.attr("aria-labelledby",b)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(b.event),"fill"===c?($.coral.fitParent(this.component(),!0),a=d.height(),this.element.siblings(":visible").each(function(){var b=$(this),c=b.css("position");"absolute"!==c&&"fixed"!==c&&(a-=b.outerHeight(!0))}),this.headers.each(function(){a-=$(this).outerHeight(!0)}),this.headers.next().each(function(){$(this).height(Math.max(0,a-$(this).innerHeight()+$(this).height()))}).addClass("coral-scroll")):"auto"===c&&($.coral.fitParent(this.component(),!1),a=0,this.headers.next().each(function(){a=Math.max(a,$(this).css("height","").height())}).height(a)),this.headers.each(function(){var a=$.parser.parseOptions(this);0==a.collapsible&&$(this).next().addClass("hidden")})},_activate:function(a){var b=this._findActive(a)[0];b!==this.active[0]&&(b=b||this.active[0],this._eventHandler({target:b,currentTarget:b,preventDefault:$.noop}))},_findActive:function(a){return"number"==typeof a?this.headers.eq(a):$()},_setupEvents:function(a){var b={keydown:"_keydown"};a&&$.each(a.split(" "),function(a,c){b[c]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,b),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(a){var b=this.options,c=this.active,d=$(a.currentTarget),e=d[0]===c[0],f=e&&b.collapsible,g=f?$():d.next(),h=c.next(),i={oldHeader:c,oldPanel:h,newHeader:f?$():d,newPanel:g,headerOptions:$.parser.parseOptions(f?$():d)};a.preventDefault(),e&&!b.collapsible||this._trigger("beforeActivate",a,i)===!1||(b.active=f?!1:this.headers.index(d),this.active=e?$():d,this._toggle(i),c.removeClass("coral-accordion-header-active coral-state-active"),b.icons&&c.children(".coral-accordion-header-icon").removeClass(b.icons.activeHeader).addClass(b.icons.header),e||(d.removeClass("coral-corner-all").addClass("coral-accordion-header-active coral-state-active coral-corner-top"),b.icons&&d.children(".coral-accordion-header-icon").removeClass(b.icons.header).addClass(b.icons.activeHeader),d.next().addClass("coral-accordion-content-active")))},_toggle:function(a){var b=a.newPanel,c=this.prevShow.length?this.prevShow:a.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=b,this.prevHide=c,this.options.animate?this._animate(b,c,a):(c.hide(),b.show(),this._toggleComplete(a)),c.attr({"aria-hidden":"true"}),c.prev().attr("aria-selected","false"),b.length&&c.length?c.prev().attr({tabIndex:-1,"aria-expanded":"false"}):b.length&&this.headers.filter(function(){return 0===$(this).attr("tabIndex")}).attr("tabIndex",-1),b.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_animate:function(a,b,c){var d,e,f,g=this,h=0,i=a.length&&(!b.length||a.index()<b.index()),j=this.options.animate||{},k=i&&j.down||j,l=function(){g._toggleComplete(c)};return"number"==typeof k&&(f=k),"string"==typeof k&&(e=k),e=e||k.easing||j.easing,f=f||k.duration||j.duration,b.length?a.length?(d=a.show().outerHeight(),b.animate(this.hideProps,{duration:f,easing:e,step:function(a,b){b.now=Math.round(a)}}),void a.hide().animate(this.showProps,{duration:f,easing:e,complete:l,step:function(a,b){b.now=Math.round(a),"height"!==b.prop?h+=b.now:"content"!==g.options.heightStyle&&(h=0)}})):b.animate(this.hideProps,f,e,l):a.animate(this.showProps,f,e,l)},_toggleComplete:function(a){var b=a.oldPanel;b.removeClass("coral-accordion-content-active").prev().removeClass("coral-corner-top").addClass("coral-corner-all"),b.length&&(b.parent()[0].className=b.parent()[0].className),this._trigger("onActivate",null,a)}});