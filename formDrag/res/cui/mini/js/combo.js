/*! cui 2016-11-08 */
!function(){"use strict";function a(a,b){$(".coral-combo-wrapper").not(a).hide(),$(".coral-combo-iframePanel:visible").not(b).hide()}$(document).unbind(".coral-combobox").bind("mousedown.coral-combobox mousewheel.coral-combobox",function(b){var c=$(b.target).closest(".coral-combo-panel").length,d=$(b.target).closest(".coral-combo").length,e=$(b.target).closest(".coral-button").length;c||d&&!e||a()}),$.component("coral.combo",$.coral.inputbase,{castProperties:["triggers","showRequiredMark","hideRequiredMark","shortCut","onBlur"],version:"4.0.2",options:{panelRenderOnShow:!1,popupDialog:!1,showStar:!0,showDirection:"down",labelField:null,starBefore:!1,isInited:!1,id:null,name:null,showOnFocus:!0,iframePanel:!1,buttons:[],forceSelection:!0,width:"auto",height:22,placeholder:"",cls:"",required:!1,errMsg:null,errMsgPosition:"leftBottom",isLabel:!1,panelWidth:null,panelHeight:"auto",panelComponentCls:"",position:{my:"left top",at:"left bottom",collision:"none"},maxPanelHeight:200,multiple:!1,separator:",",valueTextSeparator:"-",postMode:"value",editable:!1,readonly:!1,readonlyInput:!0,disabled:!1,clearOnLoad:!0,hasArrow:!0,value:"",text:"",delay:300,zIndex:1e4,enableHighlight:!1,enablePinyin:!1,showClose:!1,enableFilter:!1,enterFilter:!0,query:null,filter:function(a,b){var c=$(this).attr("component-role"),d=$(this)[c]("option"),e=d.textField,f=d.valueField,g=b[e].toLowerCase(),h=b[f].toString().toLowerCase();return a=a.toLowerCase(),g.indexOf(a)>-1?"text":d.enablePinyin===!0&&pinyinEngine.toPinyin(g,!1,"").indexOf(a)>-1?!0:h.indexOf(a)>-1},onKeyUp:null,onKeyDown:null,onEnter:null,onBlur:null,onClick:null,onValidError:null,onValidSuccess:null,onShowPanel:$.noop,onHidePanel:$.noop,onChange:$.noop,triggers:null,excluded:!1},_addCacheItem:function(a){"object"==typeof a&&("undefined"==typeof this.cache&&(this.cache={}),this.cache=$.extend({},this.cache,a))},_getCacheItem:function(a){return"string"==typeof a?this.cache&&this.cache[a]?this.cache[a]:null:void 0},_removeCacheItem:function(a){this.cache&&this.cache[a]&&delete this.cache[a]},_create:function(){this._prepareInit(),this._initCombo(),this._setDefaultValue(),this._initState(),this._initData(),this._bindEvent()},_prepareInit:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.panelRendered=!1,this.dataLoaded=!1,this.search=!1,this.isInit=!1,this.isLoaded=!1,this.isInited=!1,this.currentValues=[],this.cache={},this.options.enableSearch===!0&&(this.options.readonlyInput=!1),(this.options.popupDialog||this.options.enableFilter)&&(this.options.readonlyInput=!0),this.element.hide(),this.element.attr("id")?this.element.attr("id")!=this.options.id&&(this.options.id=this.element.attr("id")):this.options.id&&this.element.attr("id",this.options.id),this.element.attr("id")||(this.options.id=this.element.uniqueId().attr("id")),this.element.attr("name")&&this.options.name?this.element.attr("name")!=this.options.name&&(this.options.name=this.element.attr("name")):!this.options.name&&this.element.attr("name")&&(this.options.name=this.element.attr("name")),this.element.attr("value")&&this.options.value?this.element.attr("value")!=this.options.value&&(this.options.value=this.element.attr("value")):!this.options.value&&this.element.attr("value")&&(this.options.value=this.element.attr("value")),"SELECT"==$(this.element)[0].tagName&&(this.transformData=this._transformData())},_initCombo:function(){this.className="coral-combo-text coral-combo-default coral-textbox-default tabbable "+this.element[0].className,this.classBorder="coral-combo-border",this.compClass="coral-combo coral-textbox",this.hiddenClass="coral-combo-value",this.uiCombo={combo:null,panel:null},this.previousValue=null,this.createInput(),this.uiCombo.combo=$(this.textboxWrapper),this.elementBorder=$(this.elementBorder),this.uiCombo.textbox=$(this.textboxInput),this.element=$(this.textboxInput),this.options.labelField&&this._createLabel(),this.options.name&&(this.element.removeAttr("name").attr("orgname",this.options.name),name=" name='"+this.options.name+"'"),this.uiCombo.panel=$("<div class='coral-combo-panel "+this.options.panelComponentCls+"'></div>").appendTo("body"),this.options.iframePanel&&(this.uiCombo.iframePanel=$("<iframe class='coral-combo-iframePanel' style='position:absolute;display:none;'></iframe>").appendTo("body")),this.uiCombo.pContent=$("<div class='coral-combo-content'></div>").appendTo(this.uiCombo.panel),this.options.enableFilter&&$("<div class='coral-combo-filter'><span class='coral-combo-filter-border'><input type='text' class='coral-combo-filterbox'></span><span class='coral-combo-search cui-icon-search2'></span></div>").appendTo(this.uiCombo.panel);var a="absolute";this.options.popupDialog&&(a="",this.uiCombo.popupDialog=$("<div class='coral-combo-popup-dialog'></div>").appendTo("body"),this.uiCombo.popupInputbox=$("<input type='text' />").appendTo(this.uiCombo.popupDialog)),0==this.options.hasArrow&&(this.elementBorder.css({"padding-right":0}),this.uiCombo.textbox.css({"padding-right":0}),this.uiClose().css({right:0})),this.uiCombo.panel.css({position:a}).addClass("coral-combo-wrapper "+this.options.cls+"-panel coral-front").hide(),this.uiCombo.textbox.attr("placeholder",this.options.placeholder),this._showPlaceholder(),this.options.buttons.length>0&&this._createButtonPanel()},_initState:function(){this.options.isLabel===!0?this._setIsLabel(this.options.isLabel):this._setReadonly(this.options.readonly),this.options.readonly||this.uiCombo.textbox.prop("readonly",this.options.readonlyInput),this.resize()},_initData:$.noop,_setDefaultValue:function(){return this.options.value?(this.setValue(this.options.value),void(this.originalValue=this.getValue())):void(this.originalValue="")},_showPlaceholder:function(a){if(!$.support.placeholder&&!this.component().find(".coral-textbox-placeholder-label").length){a=a?a:this.options.placeholder;var b=$("<span class='coral-textbox-placeholder-label'>"+a+"</span>");$(this.uiCombo.textbox).after(b)}},_hidePlaceholder:function(){$.support.placeholder||this.component().find(".coral-textbox-placeholder-label").remove()},_setIsLabel:function(a){!0===a?(this.component().removeClass("coral-readonly"),this.component().addClass("coral-isLabel"),this.uiCombo.textbox.prop("readonly",!0),this.options.emptyText&&""===this.getValue()&&this.uiCombo.textbox.val(""),this.hidePanel(),this.uiCombo.textbox.removeClass("tabbable"),this.uiCombo.textbox.removeAttr("placeholder")):(this.component().removeClass("coral-isLabel coral-readonly"),this.uiCombo.textbox.prop("readonly",this.options.readonlyInput),this.options.readonly=!1,this.uiCombo.textbox.addClass("tabbable"),this.uiCombo.textbox.attr("placeholder",this.options.placeholder)),this.options.isLabel=!!a},_setReadonlyInput:function(a){a?this.uiCombo.textbox.prop("readonly",!0):this.uiCombo.textbox.prop("readonly",!1)},_setReadonly:function(a){a?(this.element.prop("readonly",!0),this.uiCombo.textbox.prop("readonly",!0),this.uiCombo.textbox.removeClass("tabbable"),this.uiCombo.combo.find(".coral-combo-value").prop("readonly",!0)):($(this.element).prop("readonly",!1),this.uiCombo.textbox.prop("readonly",!1),this.uiCombo.textbox.addClass("tabbable"),this.uiCombo.combo.find(".coral-combo-value").prop("readonly",!1)),this.options.readonly=!!a,this.uiCombo.combo.removeClass("coral-isLabel"),this.uiCombo.combo.toggleClass("coral-readonly",this.options.readonly)},_setDisabled:function(a){a?(this.element.prop("disabled",!0),this.uiCombo.combo.find(".coral-combo-value").prop("disabled",!0),this.uiCombo.combo.find(".coral-combo-text").prop("disabled",!0),this.uiCombo.textbox.removeClass("tabbable")):($(this.element).prop("disabled",!1),this.uiCombo.combo.find(".coral-combo-value").prop("disabled",!1),this.uiCombo.combo.find(".coral-combo-text").prop("disabled",!1),this.uiCombo.textbox.addClass("tabbable")),this.options.disabled=!!a,this.uiCombo.combo.toggleClass(this.componentFullName+"-disabled coral-state-disabled",this.options.disabled)},_selectPrev:$.noop,_selectNext:$.noop,_doEnter:$.noop,_doQuery:$.noop,_addHighlight:function(a,b){if(""!==b&&a.length&&this.options.enableHighlight){a=$(a);var c,d=b.replace(/[\s]+/g," ").split(" ");a.each(function(a,e){var f=$(e),g=$(e).parent(),h=$(e).html();if(h!=b){if(f.hasClass(".coral-combobox-item-selected"))return void g.html(that._getTextFromHTML(h));if(!f.children("input").length){for(var i=0;i<d.length;i++)c=new RegExp(""+d[i],"gmi"),h=h.replace(c,'<span class="coral-keyword-highlight">'+d[i]+"</span>");f.html(h)}}})}},_getTextFromHTML:function(a){return"undefined"!=typeof a?(a=a.replace(/<\/?[^>]*>/g,""),a=a.replace(/[ | ]*\n/g,"\n"),a=a.replace(/&nbsp;/gi,"")):void 0},_clearValues:function(a){var b,c,d=this.options.valueField,e=this.currentValues,f=e.length,g=0;for(b=0;f>b;b++)for(c=0;c<a.length;c++)if(e[b]==a[c][d]){g+=1;break}return g!=f},_removeHighlight:function(a){if(a.length&&this.options.enableHighlight){a=$(a);var b=this;a.each(function(a,c){var d=$(c).parent(),e=d.html();d.html(b._getTextFromHTML(e))})}},focus:function(){if(this.options.disabled||this.options.readonly||this.options.isLabel)return!1;if(this.uiCombo.textbox.focus(),!this.dataLoaded){var a={focus:{param:null}};return this._addCacheItem(a),!0}return!0},_bindEvent:function(){var b=this,c=(this.options,this.uiCombo.combo,this.uiCombo.panel),d=this.uiCombo.iframePanel;this.options.disabled&&this.element.addClass("coral-state-disabled"),this._off(b.component());var e,f;this._on(this.uiCombo.panel.find(".coral-combo-filterbox"),{focusin:function(a){f=!0}}),this._on({"mouseenter.coral-combo-border":function(a){b.component().hasClass("coral-isLabel")||b.component().hasClass("coral-readonly")||(b.uiCombo.combo.addClass("coral-textbox-hover"),this._updateTitle())},"mouseleave.coral-combo-border":function(a){b.component().hasClass("coral-isLabel")||b.component().hasClass("coral-readonly")||b.uiCombo.combo.removeClass("coral-textbox-hover")},"keydown.coral-combo-text":function(a){this._doKeyDown(a,!1);var b=this.options;b.shortCut&&$.coral.callFunction(b.shortCut,event,this)},"keyup.coral-combo-text":function(a){this.options.readonly||this.options.isLabel||this._trigger("onKeyUp",a,{})},"blur.coral-combo-text":function(a){this._setHv(a,"blur")},"focusin.coral-combo-text":function(a){this.options.readonly||this.options.isLabel||(this.component().addClass("coral-state-focus"),e||this._trigger("onFocus",a))},"focusout.coral-combo-text":function(a){return this.cancelBlur?void delete this.cancelBlur:void(this.options.readonly||this.options.isLabel||this._delay(function(){return e?void(e=!1):(this.component().removeClass("coral-state-focus"),f?void(f=!1):(this.hidePanel(),void this._trigger("onBlur",a)))},100))},"click.coral-combo-text":function(a){(!b.component().hasClass("coral-isLabel")&&!b.component().hasClass("coral-readonly")||1!=this.options.hasArrow||this.options.readOnlyInput)&&(b.component().hasClass("coral-state-focus")&&(this.options.popupDialog&&this.options.showOnFocus===!0?this.uiCombo.popupDialog.dialog("open"):c.is(":visible")?this.hidePanel():this.showPanel()),this.options.enableFilter&&(f=!0),b._trigger("onClick",a))},"mousedown.coral-combo-arrow":function(a){this.component().hasClass("coral-isLabel")||this.component().hasClass("coral-readonly")||this.component().hasClass("coral-state-focus")&&(e=!0)},"click.coral-combo-arrow":function(g){a(c,d),b.component().hasClass("coral-isLabel")||b.component().hasClass("coral-readonly")||(b.component().hasClass("coral-state-focus")&&(e=!0),this.options.enableFilter&&(f=!0),this.focus(),b.options.popupDialog?b.uiCombo.popupDialog.dialog("open"):c.is(":visible")?b.hidePanel():b.showPanel())},"click.coral-input-clearIcon":function(a){this.component().hasClass("coral-state-focus")&&(e=!0),this.clear(),this.options.placeholder&&this._showPlaceholder()},combogridonshowpanel:function(a){b._removeGridHighlights(),b._scrollTo(b.getValue()),b.grid().grid("refresh")}}),this._on(this.uiCombo.panel.find(".coral-combo-filterbox"),{keydown:function(a){this._doKeyDown(a,!0)}}),this._on(this.uiCombo.panel.find(".coral-combo-search"),{click:function(a){return a.preventDefault(),this._filter(a,!0),!1}}),this._on(this.uiCombo.panel.find(".coral-combo-filterbox"),{focusout:function(a){return this.cancelBlur?void(this.cancelBlur=!1):void this._delay(function(){this.hidePanel()},100)}})},_updateTitle:function(){var a=$("<span style = 'visibility: hidden'>"+this.getText()+"</span>").appendTo("body");this.component().outerWidth()<a.width()&&this.component().attr("title",this.getText()),a.remove()},_doKeyDown:function(a,b){var c=this.options,d=this.panel();if(this.previousValue=$(a.target).val(),!c.readonly&&!c.isLabel){var e=$.coral.keyCode;switch(a.keyCode){case e.TAB:break;case e.ENTER:a.preventDefault(),this._doEnter(a),this._setHv(a),this._trigger("onEnter",a,{});break;case e.ESCAPE:this.hidePanel();break;case e.UP:a.preventDefault(),c.readonly===!1&&(d.is(":visible")?c.onSelectPrev?this._trigger("onSelectPrev",a):this._selectPrev(a):this.showPanel());break;case e.DOWN:a.preventDefault(),c.readonly===!1&&(d.is(":visible")?c.onSelectNext?this._trigger("onSelectNext",a):this._selectNext(a):this.showPanel());break;default:0==this.options.readonlyInput&&this._filter(a,b)}this._hidePlaceholder(),this._trigger("onKeyDown",a)}},_setHv:function(a,b){var c=$(a.target),d=c.val();d=this.options.multiple?d.split(this.options.separator):[d],this._showItems();var e=!0;if("blur"==b&&(e=d.toString()!=this.previousValue),e){var f=(this.options.textField,this.options.valueField,this._checkMathch(d,!0));f?this.setValues(f.valarr):(c.val(""),this.setValues([""]))}},_searchFilter:$.noop,_filter:function(a,b){var c=this,d=this.options,e=this.panel();return c.timer&&clearTimeout(c.timer),e.is(":visible")||c.showPanel(),c.timer=setTimeout(function(){var f=$(a.target).val();if(b&&(f=e.find(".coral-combo-filterbox").val()),f=c.options.multiple?f.split(d.separator):[f],f!=c.previousValue){d.query?d.query.call(c.element,f):(c.search=!0,c._doQuery(f));c.options.textField,c.options.valueField;if(!b){var g=c._checkMathch(f,!1);c.setValues(g.valarr,!0,!0)}c.resizeIframePanel()}},d.delay),!1},_formatValue:function(a){return a},_setOption:function(a,b){return"id"!==a&&"name"!==a?("readonly"===a&&this._setReadonly(b),"readonlyInput"===a&&this._setReadonlyInput(b),"disabled"===a&&this._setDisabled(b),"data"===a&&(this.data=b),this._super(a,b),"isLabel"===a?void this._setIsLabel(b):void("labelField"===a&&this.labelPanel.html(b))):void 0},_destroy:function(){this.panel().remove(),this.options.iframePanel&&this.uiCombo.iframePanel.remove(),this.component().replaceWith(this.element),this.options.name&&this.element.removeAttr("orgname").attr("name",this.options.name),this.element.show(),this.element.css(this.originalCss)},component:function(){return this.uiCombo.combo},panel:function(){return this.uiCombo.panel},uiArrow:function(){return this.uiCombo.combo.find("span.coral-combo-arrow")},uiClose:function(){return this.uiCombo.combo.find("span.coral-input-clearIcon")},uiBorder:function(){return this.component().find("span.coral-combo-border")},resize:function(a){var b=this.options,c=this.uiCombo.combo;this.uiCombo.panel,this.elementBorder;if(a&&(b.width=a),"auto"!=b.width&&"item"!=b.width){if(isNaN(b.width)){var d=this.element.parent(":first"),e=null;a=this.element.outerWidth(),d&&"BODY"!==d.get(0).tagName&&(e=d.outerWidth(),a>e&&(a=e)),b.width=a}c.outerWidth(b.width)}},resizeIframePanel:function(){var a,b=(this.options,this.uiCombo.combo,this.uiCombo.panel),c=this.uiCombo.iframePanel||$();a=b.height(),c.css("height",a)},_initPanel:function(){var a=this.options,b=(this.uiCombo.combo,this.elementBorder),c=this.uiCombo.panel,d=a.panelHeight;this._renderItems(this.options.data),this.panelRendered=!0,this.lazyPanelHtml="",c.css("width",a.panelWidth?a.panelWidth:b.outerWidth()),c.css("height",d),isNaN(d)&&(this.uiCombo.pContent.css({"max-height":a.maxPanelHeight+"px"}),this.uiCombo.popupDialogTree&&this.uiCombo.popupDialogTree.css({"max-height":a.maxPanelHeight+"px"})),this.options.enableFilter&&!isNaN(d)?this.uiCombo.pContent.height(a.panelHeight-30):"auto"==d?this.uiCombo.pContent.height(""):this.uiCombo.pContent.height(d-2),this.options.iframePanel&&this.uiCombo.iframePanel.css("height",c.outerHeight())},showPanel:function(){var a=this,b=this.options,c=this.uiCombo.combo,d=this.elementBorder,e=this.options.showDirection,f=this.uiCombo.panel,g=this.uiCombo.iframePanel||$();if(f.is(":hidden")){var h=$(".coral-front:visible").map(function(){return+$(this).css("z-index")}).get(),i=Math.max.apply(null,h);i>=+f.css("z-index")&&(f.css("z-index",i+1),this.options.iframePanel&&g.css("z-index",i)),this._initPanel(),this._PanelInited=!0,f.show(0,function(){a.resizeIframePanel(),g.show(),function h(){f.is(":visible")&&(f.css({left:$.coral.getLeft(f,d),top:$.coral.getTop(f,d,e),width:b.panelWidth?b.panelWidth:d.outerWidth()}),a.options.iframePanel&&g.css({left:$.coral.getLeft(g,d),top:$.coral.getTop(g,c,e),width:b.panelWidth?b.panelWidth:d.outerWidth()}),setTimeout(h,200))}(),a.uiCombo.panel.find(".coral-combo-filterbox").focus(),a._trigger("onShowPanel",null,{}),a._scrollTo(a.getValue())})}b.enableFilter&&this.setValues(this.getValues())},hidePanel:function(){this.uiCombo.panel.hide(),this.uiCombo.iframePanel&&this.uiCombo.iframePanel.hide(),this._trigger("onHidePanel",null,{})},disable:function(){this._setDisabled(!0)},enable:function(){this._setDisabled(!1)},show:function(){this._super()},hide:function(){this._super(),this.hidePanel()},hideErrors:function(){$.validate.hideErrors(this.uiBorder()),this.component().removeClass("coral-combo-error")},clear:function(){this.setValues([],!0,!1)},getOldText:function(){return this.oldText},reset:function(){this.setValue(this.originalValue)},getText:function(){return this.uiCombo.combo.find("input.coral-combo-text").val()},_setText:function(a){var b=this.uiCombo.combo.find("input.coral-combo-text");b.val(a),this.previousValue=a},setText:function(a){this._setText(a)},getValues:function(){var a=[];return this.dataLoaded?(this.uiCombo.combo.find("input.coral-combo-value").each(function(){a.push($(this).val())}),a):this.currentValues},setValues:function(a,b,c){var d=this.getValues(),e=this.options,f=0,g=[],h=[];a=a||[],this.oldValues=d;var i=[],j="",k="";if(this.uiCombo.combo.find("input.coral-combo-value").remove(),a.length>1||""!=a[0]){for(f=0;f<a.length;f++)j="",k="",this.options.name&&(j=" name='"+this.options.name+"' "),i.push("<input type='hidden' "+j+" value='"+this._formatValue(a[f])+"' class='coral-combo-value' />");this.uiCombo.combo.append(i.join(""))}for(f=0;f<d.length;f++)g[f]=d[f];for(f=0;f<a.length;f++)for(var l=0;l<g.length;l++)if(a[f]==g[l]){h.push(a[f]),g.splice(l,1);break}if(a.length&&this.options.placeholder&&this._hidePlaceholder(),"item"==e.width){var m=$("<div style = 'visibility:hidden;'><span>"+this.getText()+"</span></div>").appendTo("body"),n=this.component().find(".coral-textbox-default"),o=parseInt(n.css("padding-left"))+parseInt(n.css("padding-right")),p=this.uiArrow().outerWidth()+2*parseInt(this.uiArrow().css("right")),q=m.find("span").outerWidth()+o+p;this.resize(q),m.remove(),e.width="item"}h.length==a.length&&a.length==d.length||!b||(this.options.multiple?this._trigger("onChange",null,{value:a,newValue:a,newText:this.getText(),text:this.getText(),oldValue:d,oldText:this.getOldText()}):this._trigger("onChange",null,{value:a[0],newValue:a[0],newText:this.getText(),text:this.getText(),oldValue:d[0],oldText:this.getOldText()}))},getValue:function(){return this.getValues().join(this.options.separator)},setValue:function(a,b,c){a=a||"",a=a.split(this.options.separator),this.setValues(a,b)},getSelectedItems:function(){for(var a=this.getValues(),b=[],c=this.options.data,d=0;d<a.length;d++)for(var e=0;e<c.length;e++){var f=c[e];if(a[d]==f.id)for(var g in f)b.push(g+"="+f[g]+"\n")}return b},refresh:function(){this.destroy(),this.component().remove(),this._create()}})}();