/*! cui 2016-11-08 */
$.component("coral.autocomplete",$.coral.inputbase,{version:"4.0.2",defaultElement:"<input>",castProperties:["source","pageData","buttons","title","rootNode","triggers","showRequiredMark","shortCut","hideRequiredMark","itemattr","onValidSuccess","onValidError"],options:{appendTo:"body",autoFocus:!1,allowRepeat:!1,asyncType:"post",delay:300,scrollTimeOut:100,maxLabelWidth:"auto",pageData:[],multiLineLabel:!1,minLength:0,minHeight:1,panelComponentCls:null,panelWidth:null,height:"auto",multiple:!1,position:{my:"left top",at:"left bottom",collision:"none"},value:"",text:"",forceSelection:!1,defaultValue:"",postMode:"value",required:!1,showStar:!0,separator:",",labelCls:"",buttons:[],rowNum:100,title:null,errMsg:null,errMsgPosition:"leftBottom",panelHeight:"auto",placeholder:"",maxPanelHeight:200,iframePanel:!1,isLabel:!1,source:null,valueField:"value",textField:"label",searchField:"valueField",onValidSuccess:null,onValidError:null,onChange:null,onBlur:null,onClose:null,onFocus:null,onOpen:null,oncancel:null,onResponse:null,onSearch:null,onSelect:null,triggers:null,excluded:!1},requestIndex:0,pending:0,_create:function(){this._prepareInit(),this._initAutocomplete(),this._initState(),this._initSource(),this._initData(),this._bindEvent(),this._setDefaultValue(),this._setDefaultText(),this.liveRegion=$("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("coral-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}}),this.options.multiLineLabel&&($(this.element).easytext({minWidth:10,maxWidth:200,maxChars:60}),this._on(this.document,{click:function(a){this.options.readonly||this.options.isLabel||this._moveInput("last",a)}}))},_prepareInit:function(){this.lastSelectedItem={},this.selectedItems=[],this.isNewMenu=!0},_initAutocomplete:function(){var a="tree"==this.options.render?"coral-autocompletetree":"coral-autocomplete";if(this.className="coral-autocomplete-text coral-combo-default coral-textbox-default tabbable "+this.element[0].className,this.classBorder="",this.hiddenClass="",this.options.iframePanel&&(this.iframePanel=$("<iframe class='coral-autocomplete-iframePanel' style='position:absolute;display:none;'></iframe>").appendTo("body")),this.options.multiLineLabel){var b=this.element[0].nodeName.toLowerCase(),c="textarea"===b,d="input"===b;this.ismultiLineLabel=c?!0:d?!1:this.element.prop("isContentEditable"),this.compClass=a+" coral-textboxlist coral-textbox",this.createInput(),this.valuebox=$(this.textboxWrapper.lastChild),this.textboxWrapper=$(this.textboxWrapper),this.elementBorder=$(this.elementBorder),this.element=$(this.textboxInput),this.elementBorder.css({minHeight:this.options.minHeight+"px",height:this.options.height,overflow:"auto"}),this.valueMethod=this.valuebox[c||d?"val":"text"],this.textMethod=this.element[c||d?"val":"text"],this.textboxlistUl=$("<ul class='coral-textboxlist-ul'><li class='coral-textboxlist-inputLi'></li></ul>"),this.textboxlistUl.appendTo(this.elementBorder),this.element.appendTo(this.textboxlistUl.find(".coral-textboxlist-inputLi")),this.options.buttons.length>0&&this._createButtonPanel(),"undefined"!=typeof this.element.attr("id")?this.options.id=this.element.attr("id"):this.options.id&&this.element.attr("id",this.options.id),"undefined"!=typeof this.element.attr("name")?(this.options.name=this.element.attr("name"),this.valuebox.attr("name",this.options.name),this.element.removeAttr("name")):this.options.name&&this.valuebox.attr("name",this.options.name),this.options.text&&this.setText(this.options.text),""!=$.trim(this.valuebox.val())&&(this.options.value=this.valuebox.val()),this.options.showPopup}else{var b=this.element[0].nodeName.toLowerCase(),c="textarea"===b,d="input"===b;this.ismultiLineLabel=c?!0:d?!1:this.element.prop("isContentEditable"),this.compClass=a+" coral-textbox",this.createInput(),this.valuebox=$(this.textboxWrapper.lastChild),this.elementBorder=$(this.elementBorder),this.textboxWrapper=$(this.textboxWrapper),this.element=$(this.textboxInput),this.textboxWrapper.css({"border-width":"0"}),this.elementBorder.css({minHeight:this.options.minHeight+"px"}),this.valueMethod=this.valuebox[c||d?"val":"text"],this.textMethod=this.element[c||d?"val":"text"],this.options.buttons.length>0&&this._createButtonPanel(),"undefined"!=typeof this.element.attr("id")?this.options.id=this.element.attr("id"):this.options.id&&this.element.attr("id",this.options.id),"undefined"!=typeof this.element.attr("name")?(this.options.name=this.element.attr("name"),this.valuebox.attr("name",this.options.name),this.element.removeAttr("name")):this.options.name&&this.valuebox.attr("name",this.options.name),this.element.attr("placeholder",this.options.placeholder),this.options.placeholder&&""===this.element.val()&&this._showPlaceholder(),this.options.text&&this.setText(this.options.text),""!=$.trim(this.valuebox.val())&&(this.options.value=this.valuebox.val())}this.options.showClose&&this.clearIcon.css("right",this.rightPos?this.rightPos:0)},_initState:function(){(this.element.prop("readonly")||this.options.readonly)&&(this.options.readonly=!0,this.valuebox.prop("readonly",!0),this.element.prop("readonly",!0),this.element.removeClass("tabbable"),this.component().addClass("coral-readonly")),this.options.isLabel&&(this.element.prop("readonly",!0),this.valuebox.prop("readonly",!0),this.element.removeClass("tabbable"),this.component().addClass("coral-isLabel"))},reset:function(){this.setValue(this.originalValue)},_showPlaceholder:function(){if(!$.support.placeholder||this.options.multiLineLabel){var a=this,b=$("<span class='coral-textbox-placeholder-label'>"+a.options.placeholder+"</span>");$(a.element).after(b)}},_hidePlaceholder:function(){if(!$.support.placeholder||this.options.multiLineLabel){var a=this;a.textboxWrapper.find(".coral-textbox-placeholder-label").remove()}},_bindEvent:function(){var a,b,c,d=this;this._on({"mouseenter.coral-textbox-border":function(a){d.options.disabled||d.options.isLabel||d.options.readonly||d.textboxWrapper.addClass("coral-textbox-hover")},"mouseleave.coral-textbox-border":function(a){d.options.disabled||d.options.isLabel||d.options.readonly||d.textboxWrapper.removeClass("coral-textbox-hover")},"click.coral-input-clearIcon":function(a){this.setValue("",!0),this.options.placeholder&&this._showPlaceholder()},keyup:function(a){this.options.readonly||this.options.isLabel||this._trigger("onKeyUp",a,{})},keydown:function(e){if(!(d.options.disabled||d.options.isLabel||d.options.readonly)){if(this.element.prop("readOnly"))return a=!0,c=!0,void(b=!0);a=!1,c=!1,b=!1;var f=$.coral.keyCode;switch(e.keyCode){case f.PAGE_UP:if("tree"==this.options.render)break;a=!0,this._move("previousPage",e);break;case f.PAGE_DOWN:if("tree"==this.options.render)break;a=!0,this._move("nextPage",e);break;case f.LEFT:a=!0,this._moveItem("left",e);break;case f.RIGHT:a=!0,this._moveItem("right",e);break;case f.UP:if("tree"==this.options.render)break;a=!0,this._keyEvent("previous",e);break;case f.DOWN:if("tree"==this.options.render)break;a=!0,this._keyEvent("next",e);break;case f.ENTER:this.menu.active&&(a=!0,e.preventDefault(),this.menu.select(e));break;case f.TAB:this.menu.active&&this.menu.select(e);break;case f.ESCAPE:this.menu.element.is(":visible")&&(this.ismultiLineLabel||this.setValue(this.term,!0),this.close(e),e.preventDefault());break;default:b=!0,this._searchTimeout(e)}var g=this.options;g.shortCut&&$.coral.callFunction(g.shortCut,e,this),this._trigger("onKeyDown",e,{})}},keypress:function(c){if(!(d.options.disabled||d.options.isLabel||d.options.readonly)){if(a)return a=!1,void(this.ismultiLineLabel&&!this.menu.element.is(":visible")||c.preventDefault());if(!b&&"tree"!=this.options.render){var e=$.coral.keyCode;switch(c.keyCode){case e.PAGE_UP:this._move("previousPage",c);break;case e.PAGE_DOWN:this._move("nextPage",c);break;case e.UP:this._keyEvent("previous",c);break;case e.DOWN:this._keyEvent("next",c)}}}},input:function(a){return d.options.disabled||d.options.isLabel||d.options.readonly?void 0:c?(c=!1,void a.preventDefault()):void this._searchTimeout(a)},focus:function(){d.options.disabled||d.options.isLabel||d.options.readonly||(this.selectedItem=null,this.previous=this.getValue(),this.component().addClass("coral-state-focus"),this._hidePlaceholder())},blur:function(a){if(this.component().removeClass("coral-state-focus"),!(d.options.disabled||d.options.isLabel||d.options.readonly)){if(this.cancelBlur)return void delete this.cancelBlur;if(clearTimeout(this.searching),this.close(a),!this.options.multiLineLabel)if(this.options.multiple);else if(this.options.forceSelection)if("tree"==this.options.render);else{var b=$.grep(this.responseItems,function(a){return a[d.options.textField]==d.element.val()});b.length?this.setValue(b[0][d.options.valueField],!0):this.setValue("",!0)}else this.lastSelectedItem[this.options.textField]!=this.element.val()&&this.setValue(this.element.val(),!0);""===this.getValue()&&this._showPlaceholder(),this._trigger("onBlur",a,{item:this.selectedItem})}}}),this._on(this.menu.element,{scroll:function(a){var b=this;viewH=this.menu.element.height(),contentH=this.menu.element[0].scrollHeight,scrollTop=this.menu.element.scrollTop(),contentH-viewH-scrollTop<=15&&this.renderNumber<this.options.pageData.length&&(b.scrollTimer&&clearTimeout(b.scrollTimer),b.scrollTimer=setTimeout(function(){b._renderMenu(b.menu.element,b.options.pageData[b.renderNumber]),b.menu.refresh(),b.renderNumber++},b.options.scrollTimeout))},mousedown:function(a){if(!this.options.readonly&&!this.options.isLabel){a.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var b=this.menu.element[0];$(a.target).closest(".coral-menu-item").length||this._delay(function(){var a=this;this.document.one("mousedown",function(c){c.target===a.element[0]||c.target===b||$.contains(b,c.target)||a.close()})})}},menuonfocus:function(a,b){if(!this.options.readonly&&!this.options.isLabel){var c,d;if(this.isNewMenu&&(this.isNewMenu=!1,a.originalEvent&&/^mouse/.test(a.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){$(a.target).trigger(a.originalEvent)});d=this.options.tempData[b.item.data("key")],!1!==this._trigger("onFocus",a,{item:d})&&a.originalEvent&&/^key/.test(a.originalEvent.type),c=b.item.attr("aria-label")||d[this.options.valueField],c&&$.trim(c).length&&(this.liveRegion.children().hide(),$("<div>").text(c).appendTo(this.liveRegion))}},menuonselect:function(a,b){if(!this.options.readonly&&!this.options.isLabel){var c=this.options.tempData[b.item.data("key")],e=this.previous;if(this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=e,this._delay(function(){this.previous=e,this.selectedItem=c,d.lastSelectedItem=c})),d.lastSelectedItem=c,this.selectedItem=c,!1!==this._trigger("onSelect",a,{item:c})){var c=this.options.tempData[b.item.data("key")];valueField=c[this.options.valueField],textField=c[this.options.textField];var f=d.getValue(),g=d.getText(),h=""==f?[]:f.split(this.options.separator),i=""==g?[]:g.split(this.options.separator);if(d.options.multiple){if("value"==this.options.postMode){if(!this.options.allowRepeat&&$.inArray(valueField,h)>-1)return;h.push(valueField),i.push(textField),this.setText(i.join(this.options.separator)),this.setValue(h.join(this.options.separator),!0)}if("text"==this.options.postMode){if(!this.options.allowRepeat&&$.inArray(textField,i)>-1)return;i.push(textField),d.setValue(i.join(this.options.separator),!0)}if("value-text"==this.options.postMode){if(!this.options.allowRepeat&&$.inArray(valueField+"-"+textField,h+"-"+i)>-1)return;h.push(valueField),i.push(textField),this.setValue(h.join(this.options.separator)+"-"+i.join(this.options.separator),!0)}}else"value"==this.options.postMode&&(this.setText(c[this.options.textField],!0),this.setValue(c[this.options.valueField],!0)),"text"==this.options.postMode&&this.setValue(c[this.options.textField],!0),"value-text"==this.options.postMode&&this.setValue(c[this.options.valueField]+"-"+c[this.options.textField],!0)}this.term=this.getText(),this.close(a)}}}),this.options.multiLineLabel&&this._on({"click .coral-label-close":function(a){this.options.readonly||this.options.isLabel||(this._removeLabel(a),a.stopPropagation(),this._trigger("onLabelClose",a,[]))},"click .coral-textboxlist-item":function(a){a.stopPropagation(),this._trigger("onLabelClick",a,[])},"click .coral-textbox-border":function(a){this.options.readonly||this.options.isLabel||this.element.focus()},"mouseenter .coral-label-close":function(a){$(a.target).addClass("coral-label-close-hover")},"mouseleave .coral-label-close":function(a){$(a.target).removeClass("coral-label-close-hover")},"focus .coral-textboxlist-item":function(a){this.options.readonly||this.options.isLabel||$(a.target).addClass("coral-state-active")},"blur .coral-textboxlist-item":function(a){$(a.target).removeClass("coral-state-active")},"keydown .coral-state-active":function(a){if(!this.options.readonly&&!this.options.isLabel){var b=$.coral.keyCode;switch(a.keyCode){case b.LEFT:this._moveInput("left",a);break;case b.RIGHT:this._moveInput("right",a);break;case b.BACKSPACE:this._removeLabel(a);break;case b.DELETE:this._removeLabel(a)}}}})},_initData:function(){var a=this.options;this.menu=$("<ul>").addClass("coral-autocomplete-panel coral-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),isNaN(a.panelHeight)&&($(".coral-autocomplete-panel").css({"max-height":a.maxPanelHeight+"px"}),$(".coral-autocomplete-iframePanel").css({"max-height":a.maxPanelHeight+"px"}))},_setDefaultValue:function(){return this.options.value?(this.setValue(this.options.value),void(this.originalValue=this.getValue())):void(this.originalValue="")},_setDefaultText:function(){this.options.text&&this.setText(this.options.text)},getLastSelectedItem:function(){return this.lastSelectedItem},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("coral-autocomplete-input").removeAttr("autocomplete").removeAttr("title"),this.menu.element.remove(),this.options.iframePanel&&this.iframePanel.remove(),this.liveRegion.remove()},_setOption:function(a,b){var c=this.options.maxLabelWidth;"auto"!=c&&(c+="px"),this._super(a,b),"isLabel"===a&&"boolean"==typeof b&&(this.element.prop("readonly",b),this.valuebox.prop("readonly",b),this.component().removeClass("coral-readonly"),this.component().toggleClass("coral-isLabel",b),this.element.toggleClass("tabbable",!b),this.textboxlistUl&&(b?this.textboxlistUl.find(".coral-textboxlist-item").css("max-width",""):this.textboxlistUl.find(".coral-textboxlist-item").css("max-width",c))),"readonly"===a&&"boolean"==typeof b&&(this.element.prop("readonly",b),this.valuebox.prop("readonly",b),this.component().removeClass("coral-isLabel"),this.component().toggleClass("coral-readonly",b),this.element.toggleClass("tabbable",!b),this.textboxlistUl&&(b?this.textboxlistUl.find(".coral-textboxlist-item").css("max-width",""):this.textboxlistUl.find(".coral-textboxlist-item").css("max-width",c))),"source"===a&&this._initSource(),"appendTo"===a&&this.menu.element.appendTo(this._appendTo()),"disabled"===a&&b&&this.xhr&&this.xhr.abort(),"value"===a&&this.setValue(b),"placeholder"===a&&(this.element.attr("placeholder",this.options.placeholder),""===this.getValue()&&this._showPlaceholder()),"panelComponentCls"===a&&this.menu.element.addClass(this.options.panelComponentCls)},_appendTo:function(){var a=this.options.appendTo;return a&&(a=a.jquery||a.nodeType?$(a):this.document.find(a).eq(0)),a&&a[0]||(a=this.element.closest(".coral-front")),a.length||(a=this.document[0].body),a},_filter:function(a,b,c){c($.coral.autocomplete.filter(a,b.term,this.options.valueField,this.options.textField,this.options.searchField))},transTempData:function(a){function b(a,c){for(var d=0;d<a.length;d++)a[d].children&&b(a[d].children,c),c.tempData[a[d].id]=a[d]}if(a&&"tree"===this.options.render&&(this.options.tempData={},this.options.textField=this.options.textField||"name",this.options.valueField=this.options.valueField||"id",b(a,this.options)),a&&"tree"!==this.options.render){this.options.tempData={},this.options.textField=this.options.textField||"text",this.options.valueField=this.options.valueField||"value";for(var c=0;c<a.length;c++)this.options.tempData[a[c][this.options.valueField]]=a[c]}},_initSource:function(){var a,b,c=this;$.isArray(this.options.source)?(a=this.options.source,this.transTempData(a),this.source=function(b,d){c._filter(a,b,d)}):"string"==typeof this.options.source?(b=this.options.source,this.source=function(a,d){c.xhr&&c.xhr.abort(),this.element.attr("name")&&(a[this.element.attr("name")]=a.term),c.xhr=$.ajax({url:b,data:a,type:c.options.asyncType,dataType:"json",success:function(a){"tree"!=c.options.render?d(a):($(c.menu.element).tree("reload",a),d(a)),c.transTempData(a)},error:function(){d([])}})}):this.source=this.options.source},_searchTimeout:function(a){clearTimeout(this.searching),this.searching=this._delay(function(){var b=this.term===this._term(),c=this.menu.element.is(":visible"),d=a.altKey||a.ctrlKey||a.metaKey||a.shiftKey;b&&(!b||c||d)||(this.selectedItem=null,this.search(null,a))},this.options.delay)},_term:function(){return this.options.multiLineLabel?this.element.val():this.getText()},_updateTitle:function(a){var b,c=this,d=this.options;b=d.multiLineLabel?c.element.closest("ul"):c.element,1==d.title?b.attr("title",a):0==d.title?b.attr("title",""):b.attr("title",d.title)},search:function(a,b){return a=null!=a?a:this._term(),this.term=this._term(),a.length<this.options.minLength||this.options.minLength>0&&""==$.trim(a)?this.close(b):this._trigger("onSearch",b)!==!1?this._search(a):void 0},_search:function(a){this.pending++,this.element.addClass("coral-autocomplete-loading"),this.cancelSearch=!1,this.source({term:a},this._response())},_response:function(){var a=++this.requestIndex;return $.proxy(function(b){a===this.requestIndex&&this.__response(b),this.pending--,this.pending||this.element.removeClass("coral-autocomplete-loading")},this)},__response:function(a){var b=this;if(this.renderNumber=1,this.options.pageData=[],a&&(a=this._normalize(a)),this._trigger("onResponse",null,{content:a}),!this.options.disabled&&a&&a.length&&!this.cancelSearch){var c=a.length,d=b.options.rowNum,e=Math.ceil(c/d);if(e>1){for(var f=0;e>f;f++)b.options.pageData[f]=a.slice(f*d,(f+1)*d-1);a=b.options.pageData[0]}this._suggest(a),this._trigger("onOpen")}else this._close()},close:function(a){this.cancelSearch=!0,this._close(a)},_close:function(a){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.options.iframePanel&&this.iframePanel.hide(),"tree"!=this.options.render&&this.menu.blur(),this.isNewMenu=!0,this._trigger("onClose",a))},_change:function(a){this.previous!==this.getValue()&&this._trigger("onChange",a,{item:this.selectedItem,oldValue:this.previous,value:this.getValue(),text:this.getText(),lastSelectedItem:this.lastSelectedItem})},_normalize:function(a){return a.length&&a[0][this.options.textField]&&a[0][this.options.valueField]?a:$.map(a,function(a){return"string"==typeof a?{label:a,value:a}:$.extend({},a,{label:a.label||a.value,value:a.value||a.label})})},_suggest:function(a){var b=this.menu.element,c=this.iframePanel||$();"tree"==this.options.render||(this.menu.element.empty(),this._renderMenu(b,a),this.isNewMenu=!0,this.menu.refresh()),this.responseItems=a;var d=b.height();c.css("height",d),b.show(),b.scrollTop(0),c.show();var e=b.siblings(".coral-front:visible").map(function(){return+$(this).css("z-index")}).get(),f=Math.max.apply(null,e);f>=+b.css("z-index")&&(b.css("z-index",f+1),c.css("z-index",f)),this._resizeMenu(),b.position($.extend({of:this.elementBorder},this.options.position)),c.position($.extend({of:this.elementBorder},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var a=this.menu.element,b=this.iframePanel||$();a.outerWidth(Math.max(this.options.panelWidth?this.options.panelWidth:a.width("").outerWidth()+1,this.elementBorder.outerWidth())),b.outerWidth(a.outerWidth())},_renderMenu:function(a,b){var c=this,d=[];$.each(b,function(b,e){d.push(c._renderItemData(a,e))}),a.append(d.join(""))},_renderItemData:function(a,b){return this._renderItem(a,b)},_renderItem:function(a,b){var c,d=b[this.options.textField],e="",f="",g=1==!!b.hidden?"hidden":"",h=$.coral.toFunction(this.options.formatter);$.isFunction(h)&&(d=h.apply(this.element[0],[{item:b}]));var i=$.coral.toFunction(this.options.itemattr);if(e+=' data-key="'+b[this.options.valueField]+'"',$.isFunction(i)){var j=i.apply(this.element[0],[{item:b}]);if(!$.isEmptyObject(j)){j.hasOwnProperty("style")&&(f+=j.style,delete j.style),j.hasOwnProperty("class")&&(g+=" "+j["class"],delete j["class"]);try{delete j.role}catch(k){}for(c in j)j.hasOwnProperty(c)&&(e+=" "+c+"="+j[c])}return"<li class='"+g+"' "+e+" style='"+f+"'>"+d+"</li>"}return"<li class='"+g+"' "+e+">"+d+"</li>"},_move:function(a,b){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(a)||this.menu.isLastItem()&&/^next/.test(a)?(this.options.multiLineLabel||(this.setValue("",!0),this.setText(this.term)),void this.menu.blur()):void this.menu[a](b):void this.search(null,b)},component:function(){return this.textboxWrapper},_setLastSelectedItem:function(){var a=this.options,b=this.getValue(),c=this.getText();this.lastSelectedItem={},this.lastSelectedItem[a.valueField]=b,this.lastSelectedItem[a.textField]=c},_text:function(a){var b=this.options.maxLabelWidth,c=this.options.readonly,d=this.options.isLabel,e=this.options.labelCls;if(!this.options.multiLineLabel)return this.textMethod.apply(this.element,arguments);if(""!=a&&!a){var f=[];return $.each(this.textboxlistUl.find(".coral-textboxlist-item"),function(){f.push($(this).text())}),f.join(",")}var g="";""==a||a instanceof Array||(a=a.split(this.options.separator)),a instanceof Array?("auto"==b||d||c?$.each(a,function(b){a.splice(b,1,"<li tabindex='-1' class='coral-textboxlist-item "+e+"'  title='"+this+"'>"+this+"<span class='coral-label-close cui-icon-cross2'></span></li>")}):$.each(a,function(c){a.splice(c,1,"<li tabindex='-1' class='coral-textboxlist-item "+e+"'  style='  max-width:"+b+"px;' title='"+this+"'>"+this+"<span class='coral-label-close cui-icon-cross2'></span></li>")}),g=a.join("")):g="auto"==b||d||c?"<li tabindex='-1' class='coral-textboxlist-item "+e+"'   title='"+this+"' >"+a+"<span class='coral-label-close  cui-icon-cross2'></span></li>":"<li tabindex='-1' class='coral-textboxlist-item "+e+"'  style='  max-width:"+b+"px;' title='"+this+"' >"+a+"<span class='coral-label-close cui-icon-cross2'></span></li>",""!=a?this.options.multiple?(this.textboxlistUl.find(".coral-textboxlist-item").remove(".coral-textboxlist-item"),this.textboxlistUl.find(".coral-textboxlist-inputLi").before(g)):(this.textboxlistUl.find(".coral-textboxlist-item").remove(".coral-textboxlist-item"),this.textboxlistUl.find(".coral-textboxlist-inputLi").before(g)):this.textboxlistUl.find(".coral-textboxlist-item").remove(".coral-textboxlist-item")},getOldValue:function(){var a=(this.options,[]),b=[],c=0;if(!this.currentValues)return a;for(var b=this.currentValues.split(",");c<b.length;c++){var d=b[c];a.push(d)}return a},setValue:function(a,b){a=a||"";var c,b,d;if("string"!=typeof a?(c=a.value,b=a.changed,d=a.removed):c=a,this.options.multiLineLabel&&(this.element.val(""),this.element.css({width:"10px"})),this.previous=this.getValue(),this.options.multiLineLabel){var e=this.element.closest("li.coral-textboxlist-inputLi"),f=(e.index(),""==this.valuebox.val(c)?[]:this.valuebox.val(c));if(""==$.trim(c))this.setText(c);else if("text"===this.options.postMode)this.setText(c);else if(""!==$.trim(c)&&$.isArray(this.options.source)){for(var g=[],h=this.options.textField,i=c.split(","),j=0;j<i.length;j++){var k=this.options.tempData[i[j]];k?g.push(this.options.tempData[i[j]][h]):g.push(i[j])}g.length&&this.setText(g)}""==c&&(f=[]),this.valuebox.val(c),this.currentValues=c}else{if(""==$.trim(c))this.setText(c);else if("text"===this.options.postMode)this.setText(c);else if(""!==$.trim(c)&&$.isArray(this.options.source)){for(var g=[],h=this.options.textField,i=c.split(","),j=0;j<i.length;j++){var k=this.options.tempData[i[j]];k?g.push(this.options.tempData[i[j]][h]):g.push(i[j])}g.length&&this.setText(g)}this.valuebox.val(c)}""!==c&&this._hidePlaceholder(),b&&this._change(null)},setText:function(a){this._updateTitle(a),this._text(a),this._setLastSelectedItem()},getValue:function(){return this.options.multiLineLabel?this.valuebox.val():this.valueMethod.apply(this.valuebox)},getText:function(){return this._text()},focus:function(){return this.options.disabled||this.options.readonly||this.options.isLabel?!1:void this.element.focus()},_keyEvent:function(a,b){this.ismultiLineLabel&&!this.menu.element.is(":visible")||(this._move(a,b),b.preventDefault())},_removeLabel:function(a){var b=this.element.closest("li.coral-textboxlist-inputLi"),c=$(a.target).closest("li.coral-textboxlist-item"),d=$(a.target).closest("li.coral-textboxlist-item:last");b.insertAfter(d);var e=b.index(),f=c.index(),g=f;f>e&&(g=f-1);var h=this.getText().split(",");h.splice(g,1),c.remove();var i=this.getValue().split(",");i.splice(g,1),this.selectedItems.splice(g,1),this.selectedItem=null,this.setValue(i.join(","),!0),"string"==typeof this.options.source&&this.setText(h.join(",")),this._moveInput("last",a),this.element.val(""),this.element.focus()},_moveInput:function(a,b){var c=this.element.closest("li.coral-textboxlist-inputLi"),d=$(b.target).closest("li.coral-textboxlist-item"),e=$(c).closest("li.coral-textboxlist-inputLi").nextAll("li.coral-textboxlist-item").last();switch(a){case"left":c.insertBefore(d),this.element.val(""),this.element.focus();break;case"right":c.insertAfter(d),this.element.val(""),this.element.focus();break;case"last":c.insertAfter(e),this.element.val("")}},_moveItem:function(a,b){var c=this.element.closest("li.coral-textboxlist-inputLi");"left"==a&&c.prev().length&&0==$(c.find("input")).caret()&&(this.element.val(""),c.prev().focus()),"right"==a&&c.next().length&&$(c.find("input")).caret()==c.find("input").val().length&&(this.element.val(""),c.next().focus())}}),$.extend($.coral.autocomplete,{escapeRegex:function(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(a,b,c,d,e){var f=new RegExp($.coral.autocomplete.escapeRegex(b),"i");return e?$.grep(a,function(a){for(var b=f.test(a[d]||a[c]||a),g=e.split(","),h=0;h<g.length&&(b||!a[g[h]]||!(b=f.test(a[g[h]])));h++);return b}):$.grep(a,function(a){return f.test(a[d]||a[c]||a[e]||a)})}}),$.component("coral.autocomplete",$.coral.autocomplete,{options:{messages:{noResults:"No search results.",results:function(a){return a+(a>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(a){var b;this._superApply(arguments),this.options.disabled||this.cancelSearch||(b=a&&a.length?this.options.messages.results(a.length):this.options.messages.noResults,this.liveRegion.children().hide(),$("<div>").text(b).appendTo(this.liveRegion))}});