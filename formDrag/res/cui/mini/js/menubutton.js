/*! cui 2016-11-08 */
$(document).unbind(".coral-menubutton").bind("mousedown.coral-menubutton mousewheel.coral-menubutton",function(a){$(a.target).closest("span.coral-menubutton,.coral-menubutton-buttons").length||$(".coral-menubutton-buttons").hide()}),$.component("coral.menubutton",$.coral.button,{version:"4.0.2",castProperties:["menuOptions"],options:{id:null,name:null,label:null,cls:null,icons:{primary:null,secondary:"cui-icon-arrow-down3"},width:null,text:!0,disabled:!1,renderType:"menu",menuOptions:{autoDisplay:!1,popup:!0},data:null,url:null,method:"get",position:{my:"left top",at:"left bottom"},onCreate:null,onClick:null,onDblClick:null,onLoad:null},showPanel:function(){var a=this.options,b=$.extend(a.position,{of:this.element}),c=this.uiButtons.siblings(".coral-front:visible").map(function(){return+$(this).css("z-index")}).get(),d=Math.max.apply(null,c);d>=+this.uiButtons.css("z-index")&&this.uiButtons.css("z-index",d+1),this.uiButtons.css({position:"absolute",left:"",top:"","max-height":"300px",overflow:"auto"}).position(b).show()},hidePanel:function(){this.uiButtons.hide()},_create:function(){this._initElements(),this._super()},_getToolbar:function(a){var b=(this.options,$());return this.element.hasClass("ctrl-toolbar-element")&&(b=a?this.element.parents(".coral-toolbar:eq(0)"):this.element.parents(".ctrl-init-toolbar:eq(0)")),b},_hideMenus:function(){$(".coral-tieredmenu").hide()},hideAllMenus:function(){$(".coral-tieredmenu").hide()},showMenu:function(){this.uiMenu.tieredmenu("show")},_initElements:function(){var a=this,b=this.options;this.element.addClass("ctrl-init ctrl-init-menubutton coral-menubutton-element"),this.uiBorder=$('<span class="coral-menubutton-border"></span>'),this.uiBox=$('<span class="coral-menubutton"></span>'),this.uiBox.append(this.uiBorder),this.uiBox.insertAfter(this.element),this.uiBorder.append(this.element),"undefined"!=typeof this.element.attr("id")?this.options.id=this.element.attr("id"):this.options.id?this.element.attr("id",this.options.id):this.options.id=this.element.uniqueId().attr("id"),"undefined"!=typeof this.element.attr("name")?this.options.name=this.element.attr("name"):this.options.name&&this.element.attr("name",this.options.name),this.options.onClick=function(c,d){if("button"==b.renderType&&(a.uiButtons.is(":visible")?a.hidePanel():a.showPanel()),a._getToolbar().length&&a._getToolbar().toolbar("option","autoDisplay")){var e=a._getToolbar(!0);e.length&&e.toggleClass("coral-toolbar-click-active")}},this.options.onMouseEnter=function(c,d){if(a._getToolbar().length&&a._getToolbar().toolbar("option","autoDisplay")&&"button"!=b.renderType){var e=a._getToolbar(!0);e.hasClass("coral-toolbar-click-active")&&($(".coral-tieredmenu:visible").length&&a._hideMenus(),a.uiMenu.tieredmenu("show"))}},this._on(this.element,{buttononclick:function(b,c){a._trigger("onClick",b,c)}}),"button"==b.renderType?(this.uiButtons=$("<div class='coral-menubutton-buttons coral-front'></div>").appendTo($(document.body)),this._loadData()):(this.uiMenu=$('<ul class="coral-menubutton-menu"></ul>').appendTo($(document.body)),this._renderMenu())},_renderMenu:function(){var a=this,b=this.options,c=this.options.menuOptions,d=this.options.data,e=this.options.url,f={};null!=d&&(f.data=d),null!=e&&(f.url=e),c=$.extend({},f,b.menuOptions,{id:this.element.attr("id")+"_tieredmenu",trigger:this.element,of:this.element}),this.uiMenu.tieredmenu(c),a._getToolbar().length&&a._getToolbar().toolbar("option","autoDisplay")&&this.uiMenu.tieredmenu("component").bind("mouseleave",function(){a._hideMenus()}),this._on(this.uiMenu,{tieredmenuonclick:function(b,c){a._trigger("onClick",b,c)}})},_loadData:function(){var a=this,b=this.options;b.url?$.ajax({type:b.method,url:b.url,data:{},dataType:"json",success:function(b){a._initData(b)},error:function(){$.alert("Json Format Error!")}}):b.data&&this._initData(b.data)},_initData:function(a){var b=this;"object"==typeof a&&this._addItems(null,a),b._trigger("onLoad",null,{})},_addItems:function(a,b){if("object"==typeof b){for(var c=this,d=[],e=b.length,f=0;e>f;f++){var g=b[f];$.isEmptyObject(g)||d.push(c._createButton(g))}this._appendItems(a,d),this._initItems(d)}},_createButton:function(a){return{button:$("<button type='button'></button>").addClass("coral-menubutton-button-item"),options:a}},_appendItems:function(a,b){for(var c in b)b[c].button.appendTo(this.uiButtons)},_initItems:function(a){var b=this;for(var c in a){var d=a[c].button,e=a[c].options;d.button(e);var f={};f.buttononclick=function(a,c){b._trigger("onClick",a,c)},b._on(d,f)}},add:function(a){},prepend:function(a){if(!(!a instanceof jQuery)){var b=this,c=a.length;a instanceof Array||(a=[a]);for(var d=c-1;d>-1;d--){var e=a[d];e.css({margin:"",left:"",right:""}).removeClass("coral-menubutton-button-item").addClass("coral-menubutton-button-item").prependTo(b.uiButtons)}}},append:function(a){if(!(!a instanceof jQuery)){var b=this,c=a.length;a instanceof Array||(a=[a]);for(var d=c-1;d>-1;d--){var e=a[d];e.css({margin:"",left:"",right:""}).removeClass("coral-menubutton-button-item").addClass("coral-menubutton-button-item").prependTo(b.uiButtons)}}},pop:function(){var a=this.options;if("button"!=a.renderType)return $();var b=this.uiButtons.find(".coral-menubutton-button-item:eq(0)");return b.length?b.removeClass("coral-menubutton-button-item"):$()},component:function(){return this.uiBox},border:function(){return this.uiBorder},buttons:function(){return this.uiButtons},buttonElements:function(){return this.uiButtons.children()},menu:function(){return this.uiMenu},_bindEvents:function(){},_setOption:function(a,b){"id"!==a&&"name"!==a&&("disabled"===a&&this.element.toggleClass("coral-state-disabled",b),this._super(a,b))},_destroy:function(){var a=this.options;this.uiBox.replaceWith(this.element),"buttons"==a.renderType?this.uiButtons.remove():this.uiMenu.parent().remove(),this.element.children().remove(),this.element.removeClass("ctrl-init ctrl-init-menubutton coral-menubutton-element")}});