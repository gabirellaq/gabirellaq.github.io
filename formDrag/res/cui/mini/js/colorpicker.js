/*! cui 2016-11-08 */
$.component("coral.colorpicker",$.coral.inputbase,{version:$.coral.version,ids:{},charMin:65,tp1:'<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div><div class="custom_color_area"></div></div>',castProperties:["customColorArray"],options:{readonlyInput:!1,readonly:!1,isLabel:!1,disable:!1,isShow:!1,showBgcolor:!0,showClose:!1,onShow:null,onBeforeShow:null,onHide:null,customColorArray:["dddddd","eeeeee","cccccc","eb1139","FF0000","700000","585858","33FF00","330000","009900","990000","FFFF66","FF3366","6666FF","0000CC","00FFFF","FF66CC","FF0099","999999","ffffff","33FFFF","ffffff","ffffff","ffffff","ffffff","ffffff"],onChange:null,onSubmit:null,color:"ff0000",livePreview:!0,flat:!1},fillRGBFields:function(a,b){var c=this.HSBToRGB(a);$(b).data("colorpicker").fields.eq(1).val(c.r).end().eq(2).val(c.g).end().eq(3).val(c.b).end()},fillHSBFields:function(a,b){$(b).data("colorpicker").fields.eq(4).val(a.h).end().eq(5).val(a.s).end().eq(6).val(a.b).end()},fillHexFields:function(a,b){$(b).data("colorpicker").fields.eq(0).val(this.HSBToHex(a)).end()},component:function(){return this.textboxWrapper},_create:function(){var a=this,b=this.options;if("string"==typeof b.color)b.color=a.HexToHSB(b.color);else if(void 0!=b.color.r&&void 0!=b.color.g&&void 0!=b.color.b)b.color=a.RGBToHSB(b.color);else{if(void 0==b.color.h||void 0==b.color.s||void 0==b.color.b)return this;b.color=a.fixHSB(b.color)}var c=$.extend({},b);c.origColor=b.color;var d="collorpicker_"+parseInt(1e3*Math.random());$(this.element).data("colorpickerId",d),this.cal=$(this.tp1).attr("id",d),c.flat?this.cal.appendTo(this.element).show():this.cal.appendTo(document.body),this._initElement(),c.fields=this.cal.find("input"),c.selector=this.cal.find("div.colorpicker_color"),c.selectorIndic=c.selector.find("div div"),c.el=this.element,c.hue=this.cal.find("div.colorpicker_hue div"),c.newColor=this.cal.find("div.colorpicker_new_color"),c.currentColor=this.cal.find("div.colorpicker_current_color"),this.cal.data("colorpicker",c),this._bindEvents(),this.fillRGBFields(c.color,this.cal.get(0)),this.fillHSBFields(c.color,this.cal.get(0)),this.fillHexFields(c.color,this.cal.get(0)),this.setHue(c.color,this.cal.get(0)),this.setSelector(c.color,this.cal.get(0)),this.setCurrentColor(c.color,this.cal.get(0)),this.setNewColor(c.color,this.cal.get(0)),c.flat&&this.cal.css({position:"relative",display:"block"}),a._trigger("onCreate",null,[])},_bindEvents:function(){this.options;this._on(this.cal.find("input"),{keyup:function(a){var b=a.charCode||a.keyCode||-1,c=$(a.target).closest("input")[0];return b>this.charMin&&90>=b||32==b?!1:void(this.cal.data("colorpicker").livePreview===!0&&this._change(c))},change:function(a){var b=$(a.target).closest("input")[0];this._change(b)},blur:function(a){this.cal.data("colorpicker").fields.parent().removeClass("colorpicker_focus")},focus:function(a){var b=$(a.target).closest("input")[0];charMin=b.parentNode.className.indexOf("_hex")>0?70:65,$(b).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus"),$(b).parent().addClass("colorpicker_focus")}}),this._on(this.cal.find("span"),{mousedown:function(a){var b=$(e.target).closest("span")[0],c=$(b).parent().find("input").focus(),d={el:$(b).parent().addClass("colorpicker_slider"),max:b.parentNode.className.indexOf("_hsb_h")>0?360:b.parentNode.className.indexOf("_hsb")>0?100:255,y:a.pageY,field:c,that:this,val:parseInt(c.val(),10),preview:$(this).parent().parent().data("colorpicker").livePreview};$(document).bind("mouseup",d,this._upIncrement),$(document).bind("mousemove",d,this._moveIncrement)}}),this._on(this.cal.find(">div.colorpicker_current_color"),{click:function(a){var b=this.cal,c=this.cal.data("colorpicker").origColor;b.data("colorpicker").color=c,this.fillRGBFields(c,b.get(0)),this.fillHexFields(c,b.get(0)),this.fillHSBFields(c,b.get(0)),this.setSelector(c,b.get(0)),this.setHue(c,b.get(0)),this.setNewColor(c,b.get(0))}}),this._on(this.cal.find("div.colorpicker_color"),{mousedown:function(a){var b=$(a.target).closest("div.colorpicker_color"),c={that:this,cal:b.parent(),pos:b.offset()};c.preview=c.cal.data("colorpicker").livePreview,$(document).bind("mouseup",c,this._upSelector),$(document).bind("mousemove",c,this._moveSelector)},dblclick:function(a){var b=$(a.target).closest("div.colorpicker_color"),c={that:this,cal:b.parent(),pos:b.offset()};c.preview=c.cal.data("colorpicker").livePreview,a.data=c,this._moveSelector(a);var d=this.cal,e=d.data("colorpicker").color;d.data("colorpicker").origColor=e,this.setCurrentColor(e,d.get(0)),this.setValue(this.HSBToHex(e)),this.options.showBgcolor&&this.element.css({"background-color":"#"+this.HSBToHex(e)}),this._trigger("onSubmit",this.HSBToHex(e),this.HSBToRGB(e),d.data("colorpicker").el),this.cal.hide(),this.options.isShow=!1}}),this._on(this.cal.find("div.colorpicker_hue"),{mousedown:function(a){var b=this,c=$(a.target).closest("div.colorpicker_hue"),d={that:b,cal:c.parent(),y:c.offset().top};d.preview=d.cal.data("colorpicker").livePreview,$(document).bind("mouseup",d,b._upHue),$(document).bind("mousemove",d,b._moveHue)}}),this._on(this.cal.find("div.colorpicker_submit"),{mouseenter:function(a){var b=$(a.target).closest("div.colorpicker_submit");b.addClass("colorpicker_focus")},mouseleave:function(a){var b=$(a.target).closest("div.colorpicker_submit");b.removeClass("colorpicker_focus")},click:function(a){var b=this.cal,c=b.data("colorpicker").color;b.data("colorpicker").origColor=c,this.setCurrentColor(c,b.get(0)),this.setValue(this.HSBToHex(c)),this.options.showBgcolor&&this.element.css({"background-color":"#"+this.HSBToHex(c)}),this._trigger("onSubmit",this.HSBToHex(c),this.HSBToRGB(c),b.data("colorpicker").el),this.cal.hide(),this.options.isShow=!1}}),this._on({click:function(a){this.component().addClass("coral-state-focus"),this._show(a)},blur:function(a){this.component().removeClass("coral-state-focus"),this.setValue(this.element.val())},keyup:function(a){var b=this.element.val();this.cal.find(".colorpicker_new_color").css({"background-color":"#"+b})}}),this._on(this.cal.find(".color-div"),{click:function(a){var b=$(a.target).closest(".color-div"),c=b.attr("title");this.cal.find(".custom_show_area").css({"background-color":c}).attr("title",c)}}),this._on(this.cal.find(".custom_show_area"),{click:function(a){var b=this.cal.find(".custom_show_area").attr("title").slice(1);this.setValue(b),this.options.showBgcolor&&this.element.css({"background-color":"#"+b}),this.cal.hide(),this.options.isShow=!1}})},_initElement:function(){var a=this,b=a.options;this.className="coral-textbox-default coral-validation-colorpicker tabbable "+this.element[0].className,this.compClass="coral-colorpicker coral-textbox",this.hiddenClass="",this.classBorder="","hidden"==this.element.attr("type")&&(this.compClass=this.compClass+" hide"),this.createInput(),this.textboxWrapper=$(this.textboxWrapper),this.elementBorder=$(this.elementBorder),this.textboxHidden=$(this.textboxWrapper[0].lastChild),this.element=$(this.textboxInput);var c=$("<div class='custom_show_area' title='#ffffff'></div>");return c.appendTo(".custom_color_area"),b.customColorArray.forEach(function(a,b){var c="#"+a.toLowerCase(),d=$("<div class='color-div' title='"+c+"'></div>");d.appendTo(".custom_color_area").css({"background-color":c,position:"absolute",width:"16px",height:"16px"}),12>=b?d.css({left:18+19*b+"px",top:"10px"}):d.css({left:18+19*(b-13)+"px",top:"36px"})}),""!==$.trim(this.element.val())?this.options.value=this.element.val():this.options.value&&this.element.val(this.options.value),b.width&&this.textboxWrapper.css("width",b.width),b.height&&this._setOption("height",b.height),b.readonlyInput&&this._setReadonlyInput(),b.readonly&&this._setReadonly(),"boolean"==typeof b.isLabel&&b.isLabel?(this._setReadonly(),this.options.readonly=!0,void this.component().addClass("coral-isLabel")):("boolean"==typeof b.disabled&&b.disabled&&this._setOption("disabled",b.disabled),this.options.showClose&&this.clearIcon.css("right",this.rightPos?this.rightPos:0),this.element.attr("placeholder",b.placeholder),void(b.placeholder&&""===this.element.val()&&this._showPlaceholder()))},setValue:function(a){a=null===a||"undefined"==typeof a?"":a,this.textboxHidden.val(a),this.element.val(a),this.options.value=a,this.previous=a,""!==a&&this._hidePlaceholder()},getValue:function(){return this.textboxHidden.val()},_hidePlaceholder:function(){if(!$.support.placeholder){var a=this;a.textboxWrapper.find(".coral-textbox-placeholder-label").remove()}},_showPlaceholder:function(){if(!$.support.placeholder){var a=this,b=$("<span class='coral-textbox-placeholder-label'>"+a.options.placeholder+"</span>");$(a.element).after(b)}},_setReadonlyInput:function(){"undefined"!=typeof this.element.attr("readonly")?this.options.readonlyInput=this.element.prop("readonly"):this.options.readonlyInput&&this.element.prop("readonly",this.options.readonlyInput),this.element.prop("readonly")&&this.component().addClass("coral-readonlyInput")},_setReadonly:function(){this.options.readonlyInput=!0,this._setReadonlyInput(),this.component().removeClass("coral-readonlyInput").addClass("coral-readonly"),this.element.removeClass("tabbable")},_change:function(a,b){var c,d=$(a).parent().parent();a.parentNode.className.indexOf("_hex")>0?d.data("colorpicker").color=c=this.HexToHSB(this.fixHex($(a).val())):a.parentNode.className.indexOf("_hsb")>0?d.data("colorpicker").color=c=this.fixHSB({h:parseInt(d.data("colorpicker").fields.eq(4).val(),10),s:parseInt(d.data("colorpicker").fields.eq(5).val(),10),b:parseInt(d.data("colorpicker").fields.eq(6).val(),10)}):d.data("colorpicker").color=c=this.RGBToHSB(this.fixRGB({r:parseInt(d.data("colorpicker").fields.eq(1).val(),10),g:parseInt(d.data("colorpicker").fields.eq(2).val(),10),b:parseInt(d.data("colorpicker").fields.eq(3).val(),10)})),b&&(this.fillRGBFields(c,d.get(0)),this.fillHexFields(c,d.get(0)),this.fillHSBFields(c,d.get(0))),this.setSelector(c,d.get(0)),this.setHue(c,d.get(0)),this.setNewColor(c,d.get(0)),this._trigger("onChange",c,this.HSBToHex(c),this.HSBToRGB(c))},_upIncrement:function(a){var b=a.data.that;return b._change(a.data.field.get(0),!0),a.data.el.removeClass("colorpicker_slider").find("input").focus(),$(document).unbind("mouseup",b._upIncrement),$(document).unbind("mousemove",b._moveIncrement),!1},_moveIncrement:function(a){var b=a.data.that;return a.data.field.val(Math.max(0,Math.min(a.data.max,parseInt(a.data.val+a.pageY-a.data.y,10)))),a.data.preview&&b._change(a.data.field.get(0),!0),!1},setSelector:function(a,b){$(b).data("colorpicker").selector.css("backgroundColor","#"+this.HSBToHex({h:a.h,s:100,b:100})),$(b).data("colorpicker").selectorIndic.css({left:parseInt(150*a.s/100,10),top:parseInt(150*(100-a.b)/100,10)})},setHue:function(a,b){$(b).data("colorpicker").hue.css("top",parseInt(150-150*a.h/360,10))},setCurrentColor:function(a,b){$(b).data("colorpicker").currentColor.css("backgroundColor","#"+this.HSBToHex(a))},setNewColor:function(a,b){$(b).data("colorpicker").newColor.css("backgroundColor","#"+this.HSBToHex(a))},_moveHue:function(a){var b=a.data.that;return b._change(a.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,a.pageY-a.data.y)))/150,10)).get(0),a.data.preview),!1},_upHue:function(a){var b=a.data.that;return b.fillRGBFields(a.data.cal.data("colorpicker").color,a.data.cal.get(0)),b.fillHexFields(a.data.cal.data("colorpicker").color,a.data.cal.get(0)),$(document).unbind("mouseup",b._upHue),$(document).unbind("mousemove",b._moveHue),!1},_moveSelector:function(a){var b=a.data.that;return b._change(a.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,a.pageY-a.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,a.pageX-a.data.pos.left))/150,10)).get(0),a.data.preview),!1},_upSelector:function(a){var b=a.data.that;return b.fillRGBFields(a.data.cal.data("colorpicker").color,a.data.cal.get(0)),b.fillHexFields(a.data.cal.data("colorpicker").color,a.data.cal.get(0)),$(document).unbind("mouseup",b._upSelector),$(document).unbind("mousemove",b._moveSelector),!1},enterSubmit:function(a){$(this).addClass("colorpicker_focus")},leaveSubmit:function(a){$(this).removeClass("colorpicker_focus")},_hide:function(a){var b=this.cal?this:a.data.that;b.isChildOf(b.cal.get(0),a.target,b.cal.get(0))||(0!=b._trigger("onHide",b.cal.get[0])&&(b.cal.hide(),b.options.isShow=!1),$(document).unbind("mousedown",b._hide))},_show:function(a){if(!this.options.flat){var b=this.cal,c=this,d=this.element.parent();this.setColor(this.getValue()),this._trigger("onBeforeShow",a,b.get(0));var e=$(this.element).offset(),f=this.getViewport(),g=e.top+this.element.offsetHeight,h=e.left;return g+176>f.t+f.h&&(g-=this.element.offsetHeight+176),h+356>f.l+f.w&&(h-=356),c.options.isShow||(0!=this._trigger("onShow",a,b.get(0))&&(b.show(),this.options.isShow=!0),function i(){var a=c;a.options.isShow&&(b.css({left:$.coral.getLeft(b,d),top:$.coral.getTop(b,d)}),a.scrollTimer=setTimeout(i,200))}()),$(document).bind("mousedown",{cal:b,that:c},this._hide),!1}},isChildOf:function(a,b,c){if(a==b)return!0;if(a.contains)return a.contains(b);if(a.compareDocumentPosition)return!!(16&a.compareDocumentPosition(b));for(var d=b.parentNode;d&&d!=c;){if(d==a)return!0;d=d.parentNode}return!1},getViewport:function(){var a="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(a?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(a?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(a?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(a?document.documentElement.clientHeight:document.body.clientHeight)}},fixHSB:function(a){return{h:Math.min(360,Math.max(0,a.h)),s:Math.min(100,Math.max(0,a.s)),b:Math.min(100,Math.max(0,a.b))}},fixRGB:function(a){return{r:Math.min(255,Math.max(0,a.r)),g:Math.min(255,Math.max(0,a.g)),b:Math.min(255,Math.max(0,a.b))}},fixHex:function(a){var b=6-a.length;if(b>0){for(var c=[],d=0;b>d;d++)c.push("0");c.push(a),a=c.join("")}return a},HexToRGB:function(a){var a=parseInt(a.indexOf("#")>-1?a.substring(1):a,16);return{r:a>>16,g:(65280&a)>>8,b:255&a}},HexToHSB:function(a){return this.RGBToHSB(this.HexToRGB(a))},RGBToHSB:function(a){var b={h:0,s:0,b:0},c=Math.min(a.r,a.g,a.b),d=Math.max(a.r,a.g,a.b),e=d-c;return b.b=d,b.s=0!=d?255*e/d:0,0!=b.s?a.r==d?b.h=(a.g-a.b)/e:a.g==d?b.h=2+(a.b-a.r)/e:b.h=4+(a.r-a.g)/e:b.h=-1,b.h*=60,b.h<0&&(b.h+=360),b.s*=100/255,b.b*=100/255,b},HSBToRGB:function(a){var b={},c=Math.round(a.h),d=Math.round(255*a.s/100),e=Math.round(255*a.b/100);if(0==d)b.r=b.g=b.b=e;else{var f=e,g=(255-d)*e/255,h=(f-g)*(c%60)/60;360==c&&(c=0),60>c?(b.r=f,b.b=g,b.g=g+h):120>c?(b.g=f,b.b=g,b.r=f-h):180>c?(b.g=f,b.r=g,b.b=g+h):240>c?(b.b=f,b.r=g,b.g=f-h):300>c?(b.b=f,b.g=g,b.r=g+h):360>c?(b.r=f,b.g=g,b.b=f-h):(b.r=0,b.g=0,b.b=0)}return{r:Math.round(b.r),g:Math.round(b.g),b:Math.round(b.b)}},RGBToHex:function(a){var b=[a.r.toString(16),a.g.toString(16),a.b.toString(16)];return $.each(b,function(a,c){1==c.length&&(b[a]="0"+c)}),b.join("")},HSBToHex:function(a){return this.RGBToHex(this.HSBToRGB(a))},showPicker:function(){$(this.element).data("colorpickerId")&&this._show()},hidePicker:function(){$(this).data("colorpickerId")&&this._hide()},setColor:function(a){if("string"==typeof a)a=this.HexToHSB(a);else if(void 0!=a.r&&void 0!=a.g&&void 0!=a.b)a=this.RGBToHSB(a);else{if(void 0==a.h||void 0==a.s||void 0==a.b)return this;a=this.fixHSB(a)}if($(this.element).data("colorpickerId")){var b=this.cal;b.data("colorpicker").color=a,b.data("colorpicker").origColor=a,this.fillRGBFields(a,b.get(0)),this.fillHSBFields(a,b.get(0)),this.fillHexFields(a,b.get(0)),this.setHue(a,b.get(0)),this.setSelector(a,b.get(0)),this.setCurrentColor(a,b.get(0)),this.setNewColor(a,b.get(0))}}});