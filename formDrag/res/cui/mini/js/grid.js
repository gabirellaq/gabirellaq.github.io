/*! cui 2016-11-08 */
$.grid=$.grid||{};var grid=$.component("coral.grid",{version:"4.0.1",castProperties:["rowEditButtons","data","subGridOptions","initData","subGridRowExpanded","shortCut","rowList","pager","pagerTemplate","celloptions","colModel","picTemplate","rowattr","cellattr"],options:{},grid:{},diff:2,getScrollBarWidth:function(){var a=document.createElement("p");a.style.width="100%",a.style.height="200px";var b=document.createElement("div");b.style.position="absolute",b.style.top="0px",b.style.left="0px",b.style.visibility="hidden",b.style.width="200px",b.style.height="150px",b.style.overflow="hidden",b.appendChild(a),document.body.appendChild(b);var c=a.offsetWidth;b.style.overflow="scroll";var d=a.offsetWidth;return c==d&&(d=b.clientWidth),document.body.removeChild(b),c-d+this.diff},_destroy:function(){var a="",b=$(this.element).attr("id");this.pagers&&(a=$(this.pagers).empty().addClass(b)),$(this.element).empty(),this.element.removeClass("ctrl-init ctrl-init-grid"),this.element.removeClass("coral-grid"),this.element.removeClass(this.options.cls),this.component().replaceWith(this.element).append(a)},_create:function(){var a=this.options,b=this,c=this.element.uniqueId().attr("id");a.id=c;var d={_index:{},altRows:!1,altclass:" coral-priority-secondary ",ajaxGridOptions:{},asyncType:"post",autoSave:!1,autoValid:!0,autoWidth:!0,allowSaveOnError:!0,cls:"",caption:"",colModel:[],colNames:[],cellLayout:1,cellEdit:!1,subGridWidth:22,cellsubmit:"clientArray",clicksToEdit:2,data:[],datatype:"json",direction:"ltr",allowCellSelect:!1,deselectAfterSort:!0,emptyrecords:"无数据",expandColumn:null,height:150,idPrefix:"",initData:!1,customPicgrid:$.noop(),gridview:!1,grouping:!1,groupingView:{groupField:[],groupOrder:[],groupText:[],groupColumnShow:[],groupSummary:[],showSummaryOnHide:!1,sortitems:[],sortnames:[],summary:[],summaryval:[],plusicon:"cui-icon-plus3",minusicon:"cui-icon-minus3",displayField:[],groupSummaryPos:[],formatDisplayField:[],_locgr:!1},subGridOptions:{plusicon:"cui-icon-arrow-right3",minusicon:"cui-icon-arrow-down3",openicon:""},groupHeaders:[],groupHeader:!1,search:!1,remoteFilter:!1,fitStyle:"auto",forceFit:!1,hoverrows:!0,lastsort:0,loadonce:!0,loadui:"enable",loadtext:"加载中，请耐心等候 ...",minWidth:!1,multiselect:!1,multiselectWidth:30,multiboxonly:!1,multikey:"",clickRowToSelect:!0,subGridRowExpanded:null,model:"grid",page:1,pager:"",pagerStyle:"flex",pginput:!0,records:0,rninput:!0,rowEditButtons:[],pgbuttons:!0,showGridHeader:!0,enableHighlight:!1,picTemplate:"picTemplate",postData:{},prmNames:{page:"P_pageNumber",rows:"P_pagesize",sort:"P_orders",order:"sord",search:"_search",nd:"nd",id:"id",oper:"oper",editoper:"edit",addoper:"add",deloper:"del",subgridid:"id",npage:null,totalrows:"totalrows"},rowNum:20,rowNumMax:200,rownumbers:!1,rownumWidth:35,rownumName:"",rowList:[10,20,30],savedRow:[],scrollOffset:this.getScrollBarWidth(),selarrrow:[],singleselect:!1,sortorder:"asc",treeGrid:!1,treeGridModel:"adjacency",treeReader:{},treeANode:-1,tree_root_level:0,generalLevel:!1,onSortableColumns:!1,sortableColumnsOptions:{},onSortableRows:!1,beforeSortableRows:!1,afterSortableRows:!1,editableRows:!1,onSortableStart:!1,onSortableStop:!1,onSortableReceive:!1,onSortableRemove:!1,onSortableLoad:!1,connectGridId:null,containSortOrder:!1,sortSeparator:" ",shrinkToFit:!0,toppager:!1,toolbar:[!1,""],url:"",useProp:!0,viewsortcols:[!1,"vertical",!0],viewrecords:!0,minIndex:null,maxIndex:null,preIndex:null,beforePopulate:null};a=$.extend(!0,{},d,$.grid.defaults,this.options),"pic"==a.model&&(a.model="card"),this.options=a,this.options.isValid=!0,a.postData=$.coral.toFunction(a.postData),a.localReader=$.extend(!0,{root:"data",page:"pageNumber",total:"totalPages",records:"total",repeatitems:!1,cell:"cell",id:"id",userData:"userData",subgrid:{root:"data",repeatitems:!0,cell:"cell"}},a.localReader),a.jsonReader=$.extend(!0,{root:"data",page:"pageNumber",total:"totalPages",records:"total",repeatitems:!1,cell:"cell",id:"id",userData:"userData"},a.jsonReader),this.options.pivotData&&this.options.pivotData.length&&this.jqPivot(this.options.pivotData,this.options.pivotOption,this.options.gridOption,this.options.ajaxOption),this.options.data.length&&(this.normalizeData(),this.refreshIndex()),this.id=c;var e={groupHeader:[],headers:[],cols:[],footers:[],dragStart:function(a,c,d){var e=this;this.resizing={idx:a,startX:c.clientX,sOL:d[0]},e.columnsView.style.cursor="col-resize",this.curGbox=$("#rs_m"+$.grid.coralID(b.options.id),"#"+$.grid.coralID(b.options.id)),this.curGbox.css({display:"block",left:d[0],top:d[1],height:d[2]}),b._trigger("onResizeStart",c,[{index:a}]),document.onselectstart=function(){return!1}},dragMove:function(c){if(this.resizing){var d,e,f=c.clientX-this.resizing.startX,g=this.headers[this.resizing.idx],h="ltr"===b.options.direction?g.width+f:g.width-f;$("#test").html(f),h>33&&(this.curGbox.css({left:this.resizing.sOL+f}),b.options.forceFit===!0?(d=this.headers[this.resizing.idx+a.nv],e="ltr"===b.options.direction?d.width-f:d.width+f,e>33&&(g.newWidth=h,d.newWidth=e)):(this.newWidth="ltr"===b.options.direction?b.options.tblwidth+f:b.options.tblwidth-f,g.newWidth=h))}},dragEnd:function(){if(this.columnsView.style.cursor="default",this.resizing){var c=this.resizing.idx,e=this.headers[c].newWidth||this.headers[c].width;e=parseInt(e,10),this.resizing=!1,$("#rs_m"+$.grid.coralID(b.options.id)).css("display","none"),b.options.colModel[c].width=e,this.headers[c].width=e,this.headers[c].el.style.width=e+"px",this.cols[c].style.width=e+"px",$("table:first",this.rowsView).hasClass("coral-grid-btable-frozen")&&($("tr.jqgfirstrow>td:eq("+c+")",$("table:first",this.rowsView))[0].style.width=e+"px");var f=$("tr.jqg-first-row-header>th:eq("+c+")",$("table:first",this.columnsView));f.length>0&&(f[0].style.width=e+"px"),this.footers.length>0&&(this.footers[c].style.width=e+"px"),b.options.forceFit===!0?(e=this.headers[c+a.nv].newWidth||this.headers[c+a.nv].width,this.headers[c+a.nv].width=e,this.headers[c+a.nv].el.style.width=e+"px",this.cols[c+a.nv].style.width=e+"px",this.footers.length>0&&(this.footers[c+a.nv].style.width=e+"px"),b.options.colModel[c+a.nv].width=e,f=$("tr.jqg-first-row-header>th:eq("+(c+a.nv)+")",$("table:first",this.columnsView)),f.length>0&&(f[0].style.width=e+"px")):(b.options.tblwidth=this.newWidth||b.options.tblwidth,$("table",this.rowsView).css("width",b.options.tblwidth+"px"),$("table:first",this.columnsView).css("width",b.options.tblwidth+"px"),this.columnsView.scrollLeft=this.rowsView.scrollLeft,b.options.footerrow&&($("table:first",this.sDiv).css("width",d.tblwidth+"px"),this.sDiv.scrollLeft=this.rowsView.scrollLeft)),b._trigger("onResizeStop",null,[{newWidth:e,index:c,headers:this.headers}])}this.curGbox=null,document.onselectstart=function(){return!0}},selectionPreserver:function(a){var b=a.options,c=b.selrow,d=b.selarrrow?$.makeArray(b.selarrrow):null,e=a.grid.rowsView.scrollLeft,f=function(){var g;if(b.selrow=null,b.selarrrow=[],b.multiselect&&d&&d.length>0)for(g=0;g<d.length;g++)d[g]!=c&&$(a.element).grid("setSelection",d[g],!1,null);c&&$(a.element).grid("setSelection",c,!1,null),a.grid.rowsView.scrollLeft=e,$(a.element).unbind(".selectionPreserver",f)};$(a.element).bind("gridoncomplete.selectionPreserver",f)}};this.grid=e;var f=this.element.find(">div").filter(function(){return!$(this).hasClass(b.options.id)}),g=$("<div class='coral-grid-rows'></div>");if(0==f.length&&(this.element.prepend("<div></div>"),f=this.element.find(">div").filter(function(){return!$(this).hasClass(b.id)})),b.gridRows=g,b.gridColumns=f,b._analyzeColumns(f),f.addClass("coral-grid-columns").after(g),e.rowsView=document.createElement("div"),$(e.rowsView).addClass("coral-grid-rows-view").appendTo(g),$("<span class='coral-grid-noRecordsTips' id='noRecordsTips_"+$.grid.coralID(b.options.id)+"'>"+b.options.emptyrecords+"</span>").appendTo($(e.rowsView)),e.columnsView=document.createElement("div"),$(e.columnsView).addClass("coral-state-default coral-grid-columns-view").appendTo(f).append("<div class='coral-grid-topRightCell'></div>"),b.pic=$("<ul class='coral-pic'></ul>"),f.addClass("coral-grid-columns").after(b.pic),b.options.grouping===!0&&(b.options.scroll=!1,b.options.rownumbers=!1,b.options.treeGrid=!1,b.options.gridview=!0),this.options.treeGrid===!0){try{$(b.element).grid("setTreeGrid")}catch(h){}"local"!=b.options.datatype&&(b.options.localReader={id:"_id_"})}if(this.options.subGrid)try{$(b.element).grid("setSubGrid")}catch(i){}this.options.multiselect&&(this.options.singleselect=!1),this.options.keyName||(this.options.keyName=!1);for(var j=0;j<this.options.colModel.length;j++)this.options.colModel[j]=$.extend(!0,{},this.options.cmTemplate,this.options.colModel[j].template||{},this.options.colModel[j]),this.options.keyName===!1&&this.options.colModel[j].key===!0&&(this.options.keyName=this.options.colModel[j].name);this.options.multiselect?(this.options.colNames.unshift("<input role='checkbox' id='cb_"+this.options.id+"' class='cbox' type='checkbox'/>"),this.options.colModel.unshift({name:"cb",width:b.options.multiselectWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,align:"center",fixed:!0})):this.options.singleselect&&(this.options.colNames.unshift(""),this.options.colModel.unshift({name:"cb",width:b.options.multiselectWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,align:"center",fixed:!0})),this.options.rownumbers&&(this.options.colNames.unshift(b.options.rownumName),this.options.colModel.unshift({name:"rn",width:b.options.rownumWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,align:"center",fixed:!0})),b._transToGrid(),b._transToPicgrid(),b._transPagers(),b._cvH=$(e.columnsView).height(),"fill"!==a.fitStyle,b._setGridHeight(b.options.height),"grid"==a.model?b.pic.hide():"card"==a.model&&(b.gridRows.hide(),b.gridColumns.hide()),b.setFrozenColumns(),this.component().addClass(a.componentCls),this._populate(),b._setUpEvent(),$(window).unload(function(){b=null}),this._on(this.document,{mousedown:function(a){if(this.options.autoSave&&this._closeOnDocumentClick(a)&&this.restoreAll(a),this._closeOnDocumentClick(a)){$(this.rows.namedItem(this.options.selrow)).removeClass("coral-grid-cell-focus");for(var b=0;b<this.rows.length;b++){var c=$(this.rows[b]).find("td");$(c).hasClass("coral-grid-cell-focus")&&$(c).removeClass("coral-grid-cell-focus")}}}}),1==this.options.showGridHeader&&"card"!=b.options.model?this.showGridHeader():this.hideGridHeader()},_closeOnDocumentClick:function(a){return!$(a.target).closest(".coral-grid").length},_transPagers:function(){var a=this;this.pagers=$("."+this.id),1==this.options.pager?(this.options.pager=$("<div id='pager_0_"+this.id+"'></div>"),this.options.pager.addClass("coral-grid-pager").removeClass(a.id).appendTo(this.element),a._setPager(this.options.pager[0].id,"")):(this.pagers.each(function(b){$(this).addClass("coral-grid-pager").removeClass(a.id).attr("id","pager_"+b++ +"_"+a.id)}),this.pagers&&this.pagers.each(function(b){a._setPager(a.pagers[b].id,"")})),a.options.pager="."+a.id},toolbar:function(){return $(".pager-toolbar",this.element)},_transToPicgrid:function(){var a=this;a.pic.css({height:230,overflow:"auto"})},_transToGrid:function(){var a=this;this.options;-1==$.inArray(a.options.multikey,a._sortkeys)&&(a.options.multikey=!1),a.options.sortorder=a.options.sortorder.toLowerCase(),this.element.addClass("coral-grid"),this.element.addClass(a.options.cls),a._transGridView()},_transGridView:function(){var a,b,c,d,e,f,g,h=this,i=this.options,j=this.grid,k=i.rownumbers===!0?1:0,l=i.multiselect===!0?1:i.singleselect===!0?1:0,m=i.subGrid===!0?1:0,n=i.direction,o="<thead><tr class='coral-grid-labels' role='rowheader'>",p="",q="";if(i.shrinkToFit===!0&&i.forceFit===!0)for(a=i.colModel.length-1;a>=0;a--)if(!i.colModel[a].hidden){i.colModel[a].resizable=!1;break}for($.each(this.options.colModel,function(){"undefined"==typeof this.hidden&&(this.hidden=!1)}),g="<span class='s-ico' style='display:none'><span sort='asc' class='coral-grid-ico-sort coral-icon-asc"+p+" coral-state-disabled cui-icon-arrow-up5 coral-sort-"+n+"'></span>",g+="<span sort='desc' class='coral-grid-ico-sort coral-icon-desc"+q+" coral-state-disabled cui-icon-arrow-down5 coral-sort-"+n+"'></span></span>",a=0;a<i.colNames.length;a++){var r=h.options.headertitles?' title="'+$.grid.stripHtml(h.options.colNames[a])+'"':"",s=i.colModel[a].columnSortable?"coral-columnSortable-disabled":"";o+="<th id='"+i.id+"_"+i.colModel[a].name+"' role='columnheader' class='coral-state-default "+s+" coral-th-column coral-th-"+n+"'"+r+">",c=i.colModel[a].index||i.colModel[a].name,o+=k+m+l>a?"<div id='jqgh_"+i.id+"_"+i.colModel[a].name+"' "+b+">"+i.colNames[a]:"<div id='jqgh_"+i.id+"_"+i.colModel[a].name+"'  title='"+i.colNames[a]+"'"+b+">"+i.colNames[a],i.colModel[a].width?i.colModel[a].width=parseInt(i.colModel[a].width,10):i.colModel[a].width=150,"boolean"!=typeof i.colModel[a].title&&(i.colModel[a].title=!0),c==i.sortname&&(i.lastsort=a),o+=g+"</div></th>"}o+="</tr></thead>",g=null;var t=$("<table class='coral-grid-htable' role='grid' aria-labelledby='gbox_"+this.id+"' cellspacing='0' cellpadding='0' border='0'></table>").append(o);h.gridColumns.find(".coral-grid-columns-view").append(t),$("thead tr:first th",j.columnsView).hover(function(){$(this).addClass("coral-state-hover")},function(){$(this).removeClass("coral-state-hover")}),h._setMultiselect();var u;if("undefined"!=typeof i.width)if("string"==typeof i.width&&"auto"==i.width){var v=$(h.element).innerWidth();h.options.width=v>0?v:"nw",u=v}else u=i.width;h._trigger("beforePopulate",null,[]),this._setColWidth(),$(h.element).append("<div class='coral-grid-resize-mark' id='rs_m"+h.options.id+"'>&#160;</div>"),o=$("thead:first",h.element).get(0);var w="";h.options.footerrow&&(w+="<table role='grid' style='width:"+h.options.tblwidth+"px' class='ui-jqgrid-ftable' cellspacing='0' cellpadding='0' border='0'><tbody><tr role='row' class='ui-widget-content footrow'>");var x=$("tr:first",o),y="<tr class='jqgfirstrow' role='row' style='height:auto'>";if($("th",x).each(function(a){d=i.colModel[a].width,"undefined"==typeof i.colModel[a].resizable&&(i.colModel[a].resizable=!0),i.colModel[a].resizable?(e=document.createElement("span"),$(e).html("&#160;").addClass("coral-grid-resize coral-grid-resize-"+n),$(e).css("cursor","col-resize"),$(this).addClass(i.resizeclass)):e="",$(this).css("width",d+"px").prepend(e);var b="";i.colModel[a].hidden&&($(this).css("display","none"),b="display:none;"),y+="<td role='gridcell' style='height:0px;width:"+d+"px;"+b+"'></td>",j.headers[a]={width:d,el:this},f=i.colModel[a].sortable,"boolean"!=typeof f&&(i.colModel[a].sortable=!0,f=!0);var c=i.colModel[a].name;"cb"!=c&&"subgrid"!=c&&"rn"!=c&&i.viewsortcols[2]&&$(">div",this).addClass("coral-grid-sortable"),f&&(i.viewsortcols[0]?($("div span.s-ico",this).show(),a==i.lastsort&&$("div span.coral-icon-"+i.sortorder,this).removeClass("coral-state-disabled")):a==i.lastsort&&($("div span.s-ico",this).show(),$("div span.coral-icon-"+i.sortorder,this).removeClass("coral-state-disabled"))),i.footerrow&&(w+="<td role='gridcell' "+h._formatCol(a,0,"",null,"",!1)+">&#160;</td>")}).mousedown(function(a){if(1==$(a.target).closest("th>span.coral-grid-resize").length){var b=h._getColumnHeaderIndex(this);return i.forceFit===!0&&(i.nv=h._nextVisible(b)),j.dragStart(b,a,h._getOffset(b)),!1}}).click(function(a){if(i.disableClick)return i.disableClick=!1,!1;var b,c,d="th>div.coral-grid-sortable";i.viewsortcols[2]||(d="th>div>span>span.coral-grid-ico-sort");var e=$(a.target).closest(d);if(1==e.length){var f=h._getColumnHeaderIndex(this);return i.viewsortcols[2]||(b=!0,c=e.attr("sort")),h._sortData($("div",this)[0].id,f,b,c,this),!1}}),h.options.onSortableColumns&&$.fn.sortable)try{$(h.element).grid("sortableColumns",x)}catch(z){}h.options.footerrow&&(w+="</tr></tbody></table>"),y+="</tr>";var A=$("<table id='"+h.options.id+"_table' class='coral-grid-btable' role='grid' cellspacing='0' cellpadding='0' border='0'></table>").append(y);h.gridRows.find(".coral-grid-rows-view").append(A),this.rows=h.gridRows.find(".coral-grid-btable")[0].rows,this.element.prepend("<div class='coral-grid-view'></div>");var B;if(h.options.footerrow&&(j.sDiv=$("<div class='ui-jqgrid-sdiv'></div>")[0],B=$("<div class='ui-jqgrid-hbox'></div>"),$(j.sDiv).append(B).width(j.width).insertAfter(h.gridColumns),$(B).append(w),j.footers=$(".ui-jqgrid-ftable",j.sDiv)[0].rows[0].cells,h.options.rownumbers&&(j.footers[0].className="ui-state-default jqgrid-rownum")),B=null,h.options.caption.length>0&&(j.caption=document.createElement("div"),j.caption.className="coral-grid-caption",$(j.caption).html(h.options.caption),this.element.prepend(j.caption)),$(j.columnsView).add(j.rowsView).parent().appendTo(this.element.find(".coral-grid-view")),i.shrinkToFit===!0&&i.forceFit===!0?($("table:first",j.rowsView).css("width",h.grid.width+"px"),$("table:first",j.columnsView).css("width",h.grid.width+"px")):i.shrinkToFit===!1&&($("table:first",j.rowsView).css("width",h.options.tblwidth+"px"),$("table:first",j.columnsView).css("width",h.options.tblwidth+"px")),h._setOption("width",u),this.grid.cols=this.rows[0].cells,i.groupHeader){this.setGroupHeaders({useColSpanStyle:!0,groupHeaders:i.groupHeaders});var C=$("tr.jqg-third-row-header",o);if(h.options.sortable&&$.fn.sortable)try{$(h.element).grid("sortableColumns",C)}catch(z){}}o=null,t=null,A=null},_sortkeys:["shiftKey","altKey","ctrlKey"],_getColumnHeaderIndex:function(a){var b,c=this,d=c.grid.headers,e=$.grid.getCellIndex(a);for(this.grid.rightfhDiv&&(e=d.length-e-1),b=0;b<d.length;b++)if(a===d[b].el){e=b;break}return e},_analyzeColumns:function(a){var b=0,c=this.options;for(this.options.colModel.length<=0&&a.children().each(function(a){var b=$.parser.parseOptions(this,null,["data"]);if("undefined"!=typeof b.name)c.colModel.push(b),c.colNames.push(b.label||$(this).html());else if("undefined"!=typeof b.header){var d,e=0;$(this).children().each(function(a){var b=$.parser.parseOptions(this,null,["data"]);c.colModel.push(b),c.colNames.push(b.label||$(this).html()),e++,0==a&&(d=b)}),c.groupHeaders.push({startColumnName:d.name,numberOfColumns:e,titleText:b.header})}}),b=0;b<this.options.colModel.length;b++){var d=this.options.colModel[b];"combobox"!=d.formatter&&"combotree"!=d.formatter&&"combogrid"!=d.formatter||("combotree"==d.formatter&&(d.formatoptions.dataStructure="tree"),0!=d.revertCode&&(d.revertCode=!0)),"combobox"!=d.edittype&&"combotree"!=d.edittype&&"autocomplete"!=d.edittype&&"combogrid"!=d.edittype||("combotree"==d.edittype&&(d.editoptions.dataStructure="tree"),d.formatter=d.formatter||"convertCode"),this.transTempData(d)}if(0===this.options.colNames.length)for(b=0;b<this.options.colModel.length;b++)this.options.colNames[b]=this.options.colModel[b].label||this.options.colModel[b].name;return this.options.colNames.length!==this.options.colModel.length?void alert("errors! colNames not equals to colModel!"):void a.children().not(".coral-grid-columns-view").remove()},_updateMultiSelectIndexsOption:function(a){var b=a.minIndex,c=a.maxIndex,d=a.preIndex,e=a.curIndex;return null==b&&(b=c=d=null==d?e:d),b>=e?(b=e,c=d):e>b&&c>e?(b=Math.min(e,d),c=Math.max(e,d)):e>c&&(c=e,b=d),{minIndex:b,maxIndex:c,preIndex:d}},_addShiftKeySelect:function(a,b){var c=this,d=c.options;if(b.rowId){var e=$(c.element),f=!1,g=e.find(".coral-grid-btable")[0].rows,h=g.namedItem(b.rowId).rowIndex;if(a.shiftKey){var i=c._updateMultiSelectIndexsOption({maxIndex:d.maxIndex,minIndex:d.minIndex,preIndex:d.preIndex,curIndex:h});d.minIndex=i.minIndex,d.maxIndex=i.maxIndex,d.preIndex=i.preIndex,e.grid("resetSelection");for(var j=d.minIndex;j<=d.maxIndex;j++){var k=!1;j==d.maxIndex&&(k=!0),e.grid("setSelection",g[j].id,k)}document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),f=!0}else d.minIndex=d.maxIndex=null,d.preIndex=h;return f}},_setUpEvent:function(){var a,b,c,d,e,f=this,g=this.grid,h=this.options;f.options.cellEdit===!1&&f.options.hoverrows===!0&&$(f.element).bind("mouseover",function(a){var b=!("card"!=f.options.model);b?(e=$(a.target,f.pic).closest("li.gridPanel").find(".rowgrid"),"coral-subgrid"!==$(e).attr("class")&&$(e).addClass("coral-state-hover")):(e=$(a.target,f.rows).closest("tr.jqgrow"),"coral-subgrid"!==$(e).attr("class")&&$(e).addClass("coral-state-hover"))}).bind("mouseout",function(a){var b=!("card"!=f.options.model);e=b?$(a.target,f.pic).closest("li.gridPanel ").find(".rowgrid"):$(a.target,f.rows).closest("tr.jqgrow"),$(e).removeClass("coral-state-hover")}),$(g.rowsView).scroll(function(a){if(h.scroll){var b=$(g.rowsView)[0].scrollTop;void 0===g.scrollTop&&(g.scrollTop=0),b!=g.scrollTop&&(g.scrollTop=b,g.timer&&clearTimeout(g.timer),g.timer=setTimeout(g.populateVisible,h.scrollTimeout))}$(g.columnsView)[0].scrollLeft=$(g.rowsView)[0].scrollLeft;$(g.rowsView)[0].scrollTop;$(".coral-grid-btable-frozen").css("left",-$(g.rowsView)[0].scrollLeft+"px");var c=$(".row-editable",f.element);$(f.element).grid("getInd",f.editRowIndex,!0);c.length>0&&f.editButtonsPos(f.editRowIndex,c),h.footerrow&&(g.sDiv.scrollLeft=$(g.rowsView)[0].scrollLeft)}),$(".coral-grid-btable",f.element).add(f.pic).click(function(a){var g,i=!("card"!=f.options.model);if(d=a.target,e=i?$(d,f.pic).closest("li.gridPanel"):$(d,f.rows).closest("tr.jqgrow"),f.options.allowCellSelect){for(var j=0;j<this.rows.length;j++)$(this.rows[j]).find("td").hasClass("coral-grid-cell-focus")&&$(this.rows[j]).find("td").removeClass("coral-grid-cell-focus");"TD"==d.tagName?$(d).addClass("coral-grid-cell-focus"):$(d).closest("td").addClass("coral-grid-cell-focus")}if(0===$(e).length||e[0].className.indexOf("coral-state-disabled")>-1||$(d,f.element).closest("table.coral-grid-btable").length<0)return this;var k=$(d).hasClass("cbox"),l=$(f.element).triggerHandler("gridBeforeSelectRow",[e[0].id,a]);if(l=f._trigger("beforeSelectRow",a,[{rowId:e[0].id}]),l=l!==!1&&"stop"!==l,"A"!=d.tagName&&("INPUT"!=d.tagName&&"TEXTAREA"!=d.tagName&&"OPTION"!=d.tagName&&"SELECT"!=d.tagName||k)&&l===!0){if(g=e[0].id,c=$(d).closest("td,th").html(),!i){if(b=$.grid.getCellIndex(d),f._addShiftKeySelect(a,{rowId:e[0].id}))return;f._trigger("onSelectCell",a,[{rowId:g,rowIndex:e[0].rowIndex,cellIndex:b,cellHtml:c}])}if(f.options.editableRows&&1==f.options.clicksToEdit&&h.editrow!=g&&(f.restoreRow(h.editrow),f.rowEditButtons&&f.rowEditButtons.remove()),f.options.editableRows&&1==f.options.clicksToEdit&&!k&&(h.editrow=e[0].id,f.editRow(e[0].id,!0)),f.options.cellEdit===!0&&1==f.options.clicksToEdit){var m=f.options.colModel[b].editable,n=f.options.multiselect||f.options.singleselect;if(n&&k&&f.options.clickRowToSelect||n&&!m&&!f.options.multikey)$(f.element).grid("setSelection",g,!0,a);else if(!i)try{$(f.element).grid("editCell",e[0].rowIndex,b,!0)}catch(o){}}else f.options.multikey?a[f.options.multikey]?$(f.element).grid("setSelection",g,!0,a):(f.options.multiselect||f.options.singleselect)&&k?($(f.element).grid("setSelection",g,!0,a),k||f._cancelCheckAll()):(f.options.multiboxonly=!0,f.selectMultikey(f,a,g)):f.selectMultikey(f,a,g)}}),this._on({keydown:function(a){var b,c,g,h,i,j,k,l,m=$.coral.keyCode,n=f.options;if(!n.filterToolbar){switch(a.keyCode){case m.UP:if(a.preventDefault(),d=$(a.target),e=$(d,f.rows).closest("tr.jqgrow"),g=this.rows.namedItem(e[0].id+""),n.allowCellSelect){for(var o=0;o<$(g).find("td").length;o++){var p=$(g).find("td")[o];$(p).hasClass("coral-grid-cell-focus")&&(j=$.grid.getCellIndex(p),k=$(p))}if(this.options.iColFocus=j,i=$(g).prevAll(":visible:eq(0)").find("td")[j],b=$(g).prevAll(":visible:eq(0):not(.jqgfirstrow)"),this.options.focusrow=b[0].id,this.options.iRowFocus=b[0].rowIndex,!b||0==b.length)return;k.removeClass("coral-grid-cell-focus"),$(i).addClass("coral-grid-cell-focus"),b.focus()}break;case m.DOWN:if(a.preventDefault(),d=$(a.target),e=$(d,f.rows).closest("tr.jqgrow"),g=this.rows.namedItem(e[0].id+""),n.allowCellSelect){for(var o=0;o<$(g).find("td").length;o++){var p=$(g).find("td")[o];$(p).hasClass("coral-grid-cell-focus")&&(j=$.grid.getCellIndex(p),k=$(p))}if(this.options.iColFocus=j,h=$(g).nextAll(":visible:eq(0)").find("td")[j],c=$(g).nextAll(":visible:eq(0)"),this.options.focusrow=c[0].id,this.options.iRowFocus=c[0].rowIndex,!c||0==c.length)return;k.removeClass("coral-grid-cell-focus"),$(h).addClass("coral-grid-cell-focus"),c.focus()}break;case m.RIGHT:a.preventDefault(),d=$(a.target),e=$(d,f.rows).closest("tr.jqgrow"),g=this.rows.namedItem(e[0].id+"");for(var o=0;o<$(g).find("td").length;o++){var p=$(g).find("td")[o];$(p).hasClass("coral-grid-cell-focus")&&(l=$.grid.getCellIndex(p),k=$(p))}if(h=$(g).find("td")[l+1],this.options.focusrow=e[0].id,this.options.iRowFocus=e[0].rowIndex,!$(h)||0==$(h).length)return;for(;!$(h).is(":visible")&&l<$(g).find("td").length;)l++,h=$(g).find("td")[l+1];this.options.iColFocus=l+1,k.removeClass("coral-grid-cell-focus"),$(h).addClass("coral-grid-cell-focus"),$(h).focus();break;case m.LEFT:a.preventDefault(),d=$(a.target),e=$(d,f.rows).closest("tr.jqgrow"),g=this.rows.namedItem(e[0].id+"");for(var o=0;o<$(g).find("td").length;o++){var p=$(g).find("td")[o];$(p).hasClass("coral-grid-cell-focus")&&(j=$.grid.getCellIndex(p),k=$(p))}if(i=$(g).find("td")[j-1],this.options.focusrow=e[0].id,this.options.iRowFocus=e[0].rowIndex,!$(i)||0==$(i).length)return;for(;!$(i).is(":visible");){if(0==j)return;j--,i=$(g).find("td")[j-1]}this.options.iColFocus=j-1,k.removeClass("coral-grid-cell-focus"),$(i).addClass("coral-grid-cell-focus"),$(i).focus()}f.options.shortCut&&$.coral.callFunction(n.shortCut,event,this)}}}),$(f.element).dblclick(function(a){if(d=a.target,e=$(d,f.rows).closest("tr.jqgrow"),0!==$(e).length){f.options.editableRows&&h.editrow!=e[0].id&&(f.restoreRow(h.editrow),f.rowEditButtons&&f.rowEditButtons.remove());var b=e[0].rowIndex,c=$.grid.getCellIndex(d);if(f.options.editableRows&&2==f.options.clicksToEdit&&(h.editrow=e[0].id,f.editRow(e[0].id,!0)),f.options.cellEdit===!0&&2==f.options.clicksToEdit){b=e[0].rowIndex;try{$(f.element).grid("editCell",b,c,!0)}catch(g){}}f._trigger("onDblClickRow",null,[{rowId:e[0].id,rowIndex:b,cellIndex:c}])}}).bind("contextmenu",function(c){d=c.target,e=$(d,f.rows).closest("tr.jqgrow"),0!==$(e).length&&(f.options.multiselect||$(f.element).grid("setSelection",e[0].id,!0,c),a=e[0].rowIndex,b=$.grid.getCellIndex(d),f._trigger("onRightClickRow",null,[{rowId:e[0].id,rowIndex:a,cellIndex:b}]))}),$(g.columnsView).mousemove(function(a){return g.resizing?(g.dragMove(a),!1):void 0}),$(".coral-grid-labels",g.columnsView).bind("selectstart",function(){return!1}),$(document).mouseup(function(){return g.resizing?(g.dragEnd(),!1):!0}),this._off($(".coral-paginator-page")),this._on({"click.coral-paginator-page":function(a){var b=f._intNum($(a.target).html(),1);return f.options.page=b,f._clearVals(this.id)?(f._populate(),!1):!1}})},selectMultikey:function(a,b,c){var d=b.target,e=$(d).hasClass("cbox");if(a.options.multiselect&&a.options.multiboxonly)if(e)$(a.element).grid("setSelection",c,!0,b);else{var f=a.options.frozenColumns?a.options.id+"_frozen":"";a.options.clickRowToSelect&&($(a.options.selarrrow).each(function(b,c){var d=a.rows.namedItem(c);$(d).removeClass("coral-state-highlight"),$("#jqg_"+$.grid.coralID(a.options.id)+"_"+$.grid.coralID(c))[a.options.useProp?"prop":"attr"]("checked",!1),f&&($("#"+$.grid.coralID(c),"#"+$.grid.coralID(f)).removeClass("coral-state-highlight"),$("#jqg_"+$.grid.coralID(a.options.id)+"_"+$.grid.coralID(c),"#"+$.grid.coralID(f))[a.options.useProp?"prop":"attr"]("checked",!1))}),a.options.selarrrow=[],$(a.element).grid("setSelection",c,!0,b))}else(e||a.options.clickRowToSelect)&&$(a.element).grid("setSelection",c,!0,b)},restoreAll:function(){this.options.editableRows&&(this.restoreRow(this.options.editrow),this.rowEditButtons&&this.rowEditButtons.remove()),this.options.savedRow.length>0&&!$(this.element).grid("saveCell",this.options.savedRow[0].id,this.options.savedRow[0].ic)},setSelectAll:function(a){var b,c,d=this,e="card"===this.options.model;if(b=e?d.element.find(".coral-pic>li"):d.rows,this.options.multiselect){var f,g=[],h=d.options.frozenColumns===!0?d.options.id+"_frozen":"";a?($(b).each(function(a){if(c=e?a>=0:a>0,c>0&&!$(this).hasClass("coral-subgrid")&&!$(this).hasClass("jqgroup")&&!$(this).hasClass("coral-state-disabled")){var f=$.inArray(this.id,d.options.selarrrow);-1===f&&(e?($(b).find("#jqg_"+$.grid.coralID(d.options.id)+"_"+$.grid.coralID(this.id))[d.options.useProp?"prop":"attr"]("checked",!0),$(b).find(".rowgrid").addClass("coral-state-highlight").attr("aria-selected","true")):($(b).find("#jqg_"+$.grid.coralID(d.options.id)+"_"+$.grid.coralID(this.id))[d.options.useProp?"prop":"attr"]("checked",!0),d._setHeadCheckBox(!0),$(this).addClass("coral-state-highlight").attr("aria-selected","true"),h&&($("#jqg_"+$.grid.coralID(d.options.id)+"_"+$.grid.coralID(d.rows[a].id),d.grid.fbDiv)[d.options.useProp?"prop":"attr"]("checked",!0),$("#"+$.grid.coralID(d.rows[a].id),d.grid.fbDiv).addClass("coral-state-highlight"),d.grid.fhDiv?($("#jqg_"+$.grid.coralID(d.options.id)+"_"+$.grid.coralID(d.rows[a].id),d.grid.fbDiv)[d.options.useProp?"prop":"attr"]("checked",!0),$("#"+$.grid.coralID(d.rows[a].id),d.grid.fbDiv).addClass("coral-state-highlight")):d.grid.rightfhDiv&&($("#jqg_"+$.grid.coralID(d.options.id)+"_"+$.grid.coralID(d.rows[a].id),d.grid.rightfbDiv)[d.options.useProp?"prop":"attr"]("checked",!0),$("#"+$.grid.coralID(d.rows[a].id),d.grid.rightfbDiv).addClass("coral-state-highlight")))),d.options.selarrrow.push(this.id),d.options.selrow=this.id)}}),f=!0,g=[]):(d.options.selarrrow=[],$(b).each(function(a){c=e?a>=0:a>0,c&&($(this).hasClass("coral-subgrid")||$(this).hasClass("coral-state-disabled")||(e?($(b).find("#jqg_"+$.grid.coralID(d.options.id)+"_"+$.grid.coralID(this.id))[d.options.useProp?"prop":"attr"]("checked",!1),$(b).find(".rowgrid").removeClass("coral-state-highlight").attr("aria-selected","false")):($(b).find("#jqg_"+$.grid.coralID(d.options.id)+"_"+$.grid.coralID(this.id))[d.options.useProp?"prop":"attr"]("checked",!1),d._setHeadCheckBox(!1),$(this).removeClass("coral-state-highlight").attr("aria-selected","false"),h&&(d.grid.fhDiv?($("#jqg_"+$.grid.coralID(d.options.id)+"_"+$.grid.coralID(d.rows[a].id),d.grid.fbDiv)[d.options.useProp?"prop":"attr"]("checked",!1),$("#"+$.grid.coralID(d.rows[a].id),d.grid.fbDiv).removeClass("coral-state-highlight")):d.grid.rightfhDiv&&($("#jqg_"+$.grid.coralID(d.options.id)+"_"+$.grid.coralID(d.rows[a].id),d.grid.rightfbDiv)[d.options.useProp?"prop":"attr"]("checked",!1),$("#"+$.grid.coralID(d.rows[a].id),d.grid.rightfbDiv).removeClass("coral-state-highlight")))),g.push(this.id)))}),d.options.selrow=null,f=!1),d._trigger("onSelectAll",null,[{aRowIds:f?d.options.selarrrow:g,status:f}])}},_setMultiselect:function(){var a=this;if(this.options.multiselect){$("#cb_"+$.grid.coralID(a.options.id),this.grid.columnsView).bind("click",function(b){a.setSelectAll(this.checked)})}},_refresh:function(a,b){},reload:function(a){var b=this,c=(this.grid,{}),d=!1,e=[];if("undefined"==typeof a&&(a="json"===this.options.orgdatatype?this.options.url:this.options.data),a||this.options.url?!a&&this.options.url&&(a=this.options.url):a=[],"string"!=typeof a?(c=a,c.data?e=c.data:c.url?(a=c.url,d=!0):a instanceof Array?e=a:c.url||c.data||this.options.url?c.url||c.data||!this.options.url||(a=this.options.url,d=!0):e=this.options.data):d=!0,b.options.treeGrid===!0&&(b.options.datatype=b.options.treedatatype),c&&c.current&&b.grid.selectionPreserver(b),"local"==b.options.datatype?($(b.element).grid("resetSelection"),b.options.data.length&&(b.normalizeData(),b.refreshIndex())):b.options.treeGrid||(b.options.selrow=null,b.options.multiselect&&(b.options.selarrrow=[],b._setHeadCheckBox(!1)),b.options.savedRow=[]),b.options.scroll&&emptyRows(b.grid.rowsView,!0,!1),c&&c.page){var f=c.page;f>b.options.lastpage&&(f=b.options.lastpage),1>f&&(f=1),b.options.page=f,b.grid.prevRowHeight?b.grid.rowsView.scrollTop=(f-1)*b.grid.prevRowHeight*b.options.rowNum:b.grid.rowsView.scrollTop=0;
}if(b.grid.prevRowHeight&&b.options.scroll)delete b.options.lastpage,b._populateVisible();else{var g=b.options.search;1==b.options.localonce?b.options.search=!0:d?(b.options.datatype="json",delete b.options.orgdatatype,b.options.url=a):(b.options.datatype="local",delete b.options.orgdatatype,b.options.data=e),b._populate(),b.options.search=g,b.options.localonce=!1}return!1},resetFrozen:function(){this._hasHorizontalScrollBar()?($(this.grid.rightfbDiv).show(),$(this.grid.rightfhDiv).show()):($(this.grid.rightfbDiv).hide(),$(this.grid.rightfhDiv).hide())},refresh:function(a){var b,c=this,d=this.options,e=d.fitStyle,f=this.element.parent();if(b=f.height(),c.resetFrozen(),this.element.siblings(":visible").each(function(){var a=$(this),c=a.css("position");"absolute"!==c&&"fixed"!==c&&(b-=a.outerHeight(!0))}),$("#"+c.element[0].id).length&&("fill"===e?($.coral.fitParent(this.component(),!0),$(c.element).grid("option","height",b),$(c.element).grid("option","width",c.element.innerWidth()>0?c.element.innerWidth():0)):"width"===e?($.coral.fitParent(this.component(),!1),$(c.element).grid("option","width",c.element.innerWidth()>0?c.element.innerWidth():0),$(c.element).grid("option","height",c.options.height)):"height"===e?($.coral.fitParent(this.component(),!0),$(c.element).grid("option","height",b)):"auto"===e&&($.coral.fitParent(this.component(),!1),$(c.element).grid("option","height",c.options.height)),c.refreshPager(),c._noRecordsTipsPositon(),c.options.frozenColumns===!0&&c.resizeFrozen(),this.element.find(".loading-overlay").length))switch(this.options.loadui){case"disable":break;case"enable":case"block":$(this.element).loading("refresh")}},refreshPager:function(){var a=this;this.pagers&&(this.pagers.each(function(b){var c=$(".paginator-left",a.element).outerWidth()+5,d=$("#"+a.pagers[b].id).width();$(".toolbarpanel",a.element).css({left:c+"px",position:"absolute",top:0,width:d-c+"px"})}),a.options.pager="."+a.id,$(".ctrl-init-toolbar",a.element).length&&$(".ctrl-init-toolbar",a.element).toolbar("refresh"))},setSelectionAll:function(){$("#cb_"+this.options.id).prop("checked")||$("#cb_"+this.options.id).trigger("click")},setSelection:function(a,b,c){function d(a){var b=$(k.grid.rowsView)[0].clientHeight,c=$(k.grid.rowsView)[0].scrollTop,d=k.rows[a].offsetTop,e=k.rows[a].clientHeight;d+e>=b+c?$(k.grid.rowsView)[0].scrollTop=d-(b+c)+e+c:b+c>d&&c>d&&($(k.grid.rowsView)[0].scrollTop=d)}var e,f,g,h,i,j,k=this,l="card"===this.options.model;void 0!==a&&(b=b!==!1,f=l?this.element.find(".coral-pic #"+a)[0]:this.rows.namedItem(a+""),!f||!f.className||f.className.indexOf("coral-state-disabled")>-1||(this.options.scrollrows===!0&&(g=this.rows.namedItem(a).rowIndex,g>=0&&d(g)),this.options.frozenColumns===!0&&(j=this.options.id+"_frozen"),this.options.multiselect?(this._setHeadCheckBox(!1),this.options.selrow=f.id,h=$.inArray(this.options.selrow,this.options.selarrrow),-1===h?(l?"coral-subgrid"!==f.className&&$(f).find(".rowgrid").addClass("coral-state-highlight").attr("aria-selected","true"):"coral-subgrid"!==f.className&&$(f).addClass("coral-state-highlight").attr("aria-selected","true"),e=!0,this.options.selarrrow.push(this.options.selrow)):(l?"coral-subgrid"!==f.className&&$(f).find(".rowgrid").removeClass("coral-state-highlight").attr("aria-selected","false"):"coral-subgrid"!==f.className&&$(f).removeClass("coral-state-highlight").attr("aria-selected","false"),e=!1,this.options.selarrrow.splice(h,1),i=this.options.selarrrow[0],this.options.selrow=void 0===i?null:i),this.rows.length-1===this.options.selarrrow.length&&this._setHeadCheckBox(!0),$("#jqg_"+$.grid.coralID(this.options.id)+"_"+$.grid.coralID(f.id),$(f))[this.options.useProp?"prop":"attr"]("checked",e),j&&(l?-1===h?$("#"+$.grid.coralID(a),"#"+$.grid.coralID(j)).find(".rowgrid").addClass("coral-state-highlight"):$("#"+$.grid.coralID(a),"#"+$.grid.coralID(j)).find(".rowgrid").removeClass("coral-state-highlight"):-1===h?$("#"+$.grid.coralID(a),"#"+$.grid.coralID(j)).addClass("coral-state-highlight"):$("#"+$.grid.coralID(a),"#"+$.grid.coralID(j)).removeClass("coral-state-highlight"),$("#jqg_"+$.grid.coralID(this.options.id)+"_"+$.grid.coralID(a),"#"+$.grid.coralID(j))[this.options.useProp?"prop":"attr"]("checked",e)),b&&this._trigger("onSelectRow",c,[{rowId:f.id,status:e}])):"coral-subgrid"!==f.className&&(this.options.selrow!=f.id?(l?(this.element.find("#"+this.options.selrow+">ul").removeClass("coral-state-highlight").attr({"aria-selected":"false",tabindex:"-1"}),$(f).find(".rowgrid").addClass("coral-state-highlight").attr({"aria-selected":"true",tabindex:"0"}),j&&($("#"+$.grid.coralID(this.options.selrow),"#"+$.grid.coralID(j)).find(".rowgrid").removeClass("coral-state-highlight"),$("#"+$.grid.coralID(a),"#"+$.grid.coralID(j)).find(".rowgrid").addClass("coral-state-highlight"))):($(this.rows.namedItem(this.options.selrow)).removeClass("coral-state-highlight ").attr({"aria-selected":"false",tabindex:"-1"}),$(f).addClass("coral-state-highlight").attr({"aria-selected":"true",tabindex:"0"}),j&&($("#"+$.grid.coralID(this.options.selrow),"#"+$.grid.coralID(j)).removeClass("coral-state-highlight"),$("#"+$.grid.coralID(a),"#"+$.grid.coralID(j)).addClass("coral-state-highlight "))),e=!0,$("#jqg_"+$.grid.coralID(this.options.id)+"_"+$.grid.coralID(f.id),$(f))[this.options.useProp?"prop":"attr"]("checked",e),j&&$("#jqg_"+$.grid.coralID(this.options.id)+"_"+$.grid.coralID(a),"#"+$.grid.coralID(j))[this.options.useProp?"prop":"attr"]("checked",e)):e=!1,this.options.selrow=f.id,b&&this._trigger("onSelectRow",c,[{rowId:f.id,status:e}]))))},_setHeadCheckBox:function(a){var b=this;$("#cb_"+$.grid.coralID(b.options.id),b.grid.columnsView)[b.options.useProp?"prop":"attr"]("checked",a);var c=b.options.frozenColumns?b.options.id+"_frozen":"";c&&$("#cb_"+$.grid.coralID(b.options.id),b.grid.fhDiv)[b.options.useProp?"prop":"attr"]("checked",a)},setFrozenRows:function(a){function b(a){var b=d.rowsView2.find(".coral-grid-btable")[0].rows[0];(a?d.rowsView1:d.rowsView2).children("table.coral-grid-btable-frozen").append($(b).clone())}function c(b){var c=d.rowsView2.find(".coral-grid-btable tr").filter(function(b){return 0==b?!1:a>=b?!0:void 0});d.rowsView2.find(".coral-grid-btable")[0].rows[1];(b?d.rowsView1:d.rowsView2).children("table.coral-grid-btable-frozen").append(c)}var d=this,e=d.grid;d.destroyFrozenRows(),d.rowsView2=$(e.rowsView),d.rowsView2.children("table.coral-grid-btable-frozen").length||($(d.rowsView2).prepend('<table class="coral-grid-btable-frozen" cellspacing="0" cellpadding="0"></table>'),d.rowsView2.children("table.coral-grid-btable-frozen").css({position:"absolute",left:0,top:$(e.columnsView).height()+"px"}));var f=d.element.find(".coral-grid-rows-view").height();b(!1),c(!1);var g=d.rowsView2.find("table.coral-grid-btable-frozen").outerHeight();d.rowsView2.css({"margin-top":g+"px",height:f-g+"px"}),d.rowsView2.find(".coral-grid-btable-frozen").css({left:-$(e.rowsView)[0].scrollLeft+"px",width:d.rowsView2.find(".coral-grid-btable").width()+"px","table-layout":"fixed"})},destroyFrozenRows:function(){function a(a){var b=c.rowsView2.find("table.coral-grid-btable-frozen tr").filter(function(a){return 0!=a});(a?c.rowsView1:c.rowsView2).children("table.coral-grid-btable-frozen")[0].rows[1];$(c.rowsView2.find(".coral-grid-btable tbody:first tr:first")[0]).after(b)}function b(a){(a?c.rowsView1:c.rowsView2).children("table.coral-grid-btable-frozen").remove()}var c=this,d=c.grid;c.rowsView2=$(d.rowsView),c.rowsView2.children("table.coral-grid-btable-frozen").length||($(c.rowsView2).prepend('<table class="coral-grid-btable-frozen" cellspacing="0" cellpadding="0"></table>'),c.rowsView2.children("table.coral-grid-btable-frozen").css({position:"absolute",left:0,top:0}));var e=c.element.find(".coral-grid-rows-view").height(),f=c.rowsView2.find("table.coral-grid-btable-frozen").outerHeight();a(!1),b(!1),c.rowsView2.css({"margin-top":0,height:e+f+"px"})},showHideCol:function(a,b){var c,d=this,e=!1,f=$.support.boxSizing?0:this._intNum(this.options.cellLayout,0);if(d.grid){"string"==typeof a&&(a=[a]),b="none"!=b?"":"none";var g=""===b,h=d.options.groupHeader&&("object"==typeof d.options.groupHeader||$.isFunction(d.options.groupHeader));h&&$(d.element).grid("destroyGroupHeader",!1),$(this.options.colModel).each(function(h){-1!==$.inArray(this.name,a)&&this.hidden===g&&(d.options.frozenColumns===!0&&this.frozen===!0,$("tr",d.grid.columnsView).each(function(){$(this.cells[h]).css("display",b)}),$(d.rows).each(function(){$(this).hasClass("jqgroup")||$(this.cells[h]).css("display",b)}),d.options.footerrow&&$("tr.footrow td:eq("+h+")",d.grid.sDiv).css("display",b),c=this.widthOrg?this.widthOrg:parseInt(this.width,10),"none"===b?d.options.tblwidth-=c+f:d.options.tblwidth+=c+f,this.hidden=!g,e=!0,d._trigger("onShowHideCol",null,[{show:g,name:this.name,index:h}]))}),e===!0&&(d.options.shrinkToFit!==!0||isNaN(d.options.height)||(d.options.tblwidth+=parseInt(d.options.scrollOffset,10)),d._setGridWidth(d.options.shrinkToFit===!0?d.options.tblwidth:d.options.width)),h&&$(d.element).grid("setGroupHeaders",d.options.groupHeader)}},hideCol:function(a){return $(this.element).grid("showHideCol",a,"none")},showCol:function(a){return $(this.element).grid("showHideCol",a,"")},remapColumns:function(a,b,c){function d(b){var c;c=b.length?$.makeArray(b):$.extend({},b),$.each(a,function(a){b[a]=c[this]})}function e(b,c){$(">tr"+(c||""),b).each(function(){var b=this,c=$.makeArray(b.cells);$.each(a,function(){var a=c[this];a&&b.appendChild(a)})})}var f=this;d(f.options.colModel),d(f.options.colNames),d(f.grid.headers),e($("thead:first",f.grid.columnsView),c&&":not(.coral-grid-labels)"),b&&e($("#"+$.grid.coralID(f.options.id)+" tbody:first"),".jqgfirstrow, tr.jqgrow, tr.jqfoot"),f.options.footerrow&&e($("tbody:first",f.grid.sDiv)),f.options.remapColumns&&(f.options.remapColumns.length?d(f.options.remapColumns):f.options.remapColumns=$.makeArray(a)),f.options.lastsort=$.inArray(f.options.lastsort,a),f.options.treeGrid&&(f.options.expColInd=$.inArray(f.options.expColInd,a))},sortableColumns:function(a){function b(){c.options.disableClick=!0}var c=this,d=$.grid.coralID(c.options.id),e={tolerance:"pointer",axis:"x",cancel:".coral-columnSortable-disabled",scrollSensitivity:"1",helper:function(a,b){return b.clone()},items:">th:not(:has(#jqgh_"+d+"_cb,#jqgh_"+d+"_rn,#jqgh_"+d+"_subgrid),:hidden, .coral-columnSortable-disabled)",placeholder:{element:function(a){var b="undefined"==typeof a.attr("rowspan")?"1":"2",c="undefined"==typeof a.attr("colspan")?"1":"2",d=$(document.createElement(a[0].nodeName)).addClass(a[0].className+" coral-sortable-placeholder coral-state-highlight").removeClass("coral-sortable-helper").attr("rowspan",b).attr("colspan",c)[0];return d},update:function(a,b){b.height(a.currentItem.innerHeight()-parseInt(a.currentItem.css("paddingTop")||0,10)-parseInt(a.currentItem.css("paddingBottom")||0,10)),b.width(a.currentItem.innerWidth()-parseInt(a.currentItem.css("paddingLeft")||0,10)-parseInt(a.currentItem.css("paddingRight")||0,10))}},update:function(a,b){var d=$(b.item).parent(),e=$(">th",d),f=c.options.colModel,g={},h=c.options.id+"_";b.itemId=[],$.each(f,function(a){g[this.name]=a});var i=[],j=[];e.each(function(){var a=$(">div",this).get(0).id.replace(/^jqgh_/,"").replace(h,"");a in g&&(i.push(g[a]),j.push(a))}),$.each(b.item,function(a){b.itemId.push(b.item[a].id.replace(/^jqgh_/,"").replace(h,""))}),b.prevItemId=$(b.item[0]).prev("th").attr("id").replace(/^jqgh_/,"").replace(h,""),b.nextItemId=$(b.item[0]).next("th").attr("id").replace(/^jqgh_/,"").replace(h,""),b.targetId=b.position.left>b.originalPosition.left?b.prevItemId:b.nextItemId,$(c.element).grid("remapColumns",i,!0,!0),b.permutation=i,b.permutationOfId=j,c._trigger("onSortableColumns",a,[b]),setTimeout(function(){c.options.disableClick=!1},50)}};if($.extend(e,c.options.sortableColumnsOptions),e.beforesortablecolumns){var f=e.beforesortablecolumns;e.start=function(a,c){b(),f.call(this,a,c)}}else e.start=b;c.options.sortableColumnsOptions.exclude&&(e.items+=":not("+c.options.sortableColumnsOptions.exclude+")"),a.sortable(e).data("sortable").floating=!0},setCaption:function(a){this.options.caption=a,$("span.coral-grid-title, span.coral-grid-title-rtl",this.grid.caption).html(a),$(this.grid.cDiv).show()},setLabel:function(a,b,c,d){var e=this,f=-1;if(e.grid&&"undefined"!=typeof a&&($(e.options.colModel).each(function(b){return this.name==a?(f=b,!1):void 0}),f>=0)){var g=$("tr.coral-grid-labels th:eq("+f+")",e.grid.columnsViews);if(b){var h=$(".s-ico",g);$("[id^=jqgh_]",g).empty().html(b).append(h),e.options.colNames[f]=b}c&&("string"==typeof c?$(g).addClass(c):$(g).css(c)),"object"==typeof d&&$(g).attr(d)}},setCell:function(a,b,c,d,e,f){var g,h,i=this,j=-1;if(i.grid&&(isNaN(b)?$(i.options.colModel).each(function(a){return this.name==b?(j=a,!1):void 0}):j=parseInt(b,10),j>=0)){var k=i.rows.namedItem(a),l=$(i.element).grid("getRowData",a);if(k){var m=$("td:eq("+j+")",k);if((""!==c||f===!0)&&(g=i._formatter(a,c,j,l,"edit"),h=i.options.colModel[j].title?{title:$.grid.stripHtml(g)}:{},i.options.treeGrid&&$(".tree-wrap",$(m)).length>0?$("span",$(m)).html(g).attr(h):$(m).html(g).attr(h),$.fn.afterFmatter.call(i),"local"==i.options.datatype)){var n,o=i.options.colModel[j];n=i.options._index[a],"undefined"!=typeof n&&(i.options.data[n][o.name]=c)}"string"==typeof d?$(m).addClass(d):d&&$(m).css(d),"object"==typeof e&&$(m).attr(e)}}},sortableDisable:function(){$("tbody:first",this.grid.rowsView).sortable("disable")},sortableEnable:function(){$("tbody:first",this.grid.rowsView).sortable("enable")},getCell:function(a,b){var c=!1,d=this,e=-1;if(d.grid){if(isNaN(b)?$(d.options.colModel).each(function(a){return this.name===b?(e=a,!1):void 0}):e=parseInt(b,10),e>=0){var f=d.rows.namedItem(a);if(f)try{c=1==d.options.enableHighlight?$.unformat.call(d,$("td:eq("+e+")",f),{rowId:f.id,colModel:d.options.colModel[e]},e,!0):$.unformat.call(d,$("td:eq("+e+")",f),{rowId:f.id,colModel:d.options.colModel[e]},e)}catch(g){c=$.grid.htmlDecode($("td:eq("+e+")",f).html())}}return c}},getCol:function(a,b,c){var d,e,f,g,h=[],i=0;b="boolean"!=typeof b?!1:b,"undefined"==typeof c&&(c=!1);var j=this,k=-1;if(j.grid){if(isNaN(a)?$(j.options.colModel).each(function(b){return j.options.colModel[b].name===a?(k=b,!1):void 0}):k=parseInt(a,10),k>=0){var l=j.rows.length,m=0;if(l&&l>0){for(;l>m;){if($(j.rows[m]).hasClass("jqgrow")){try{d=1==j.options.enableHighlight?$.unformat.call(j,$(j.rows[m].cells[k]),{rowId:j.rows[m].id,colModel:j.options.colModel[k]},k,!0):$.unformat.call(j,$(j.rows[m].cells[k]),{rowId:j.rows[m].id,colModel:j.options.colModel[k]},k)}catch(n){d=$.grid.htmlDecode(j.rows[m].cells[k].innerHTML)}c?(g=parseFloat(d),i+=g,0===m?(e=g,f=g):(e=Math.min(e,g),f=Math.max(f,g))):b?h.push({id:j.rows[m].id,value:d}):h.push(d)}m++}if(c)switch(c.toLowerCase()){case"sum":h=i;break;case"avg":h=i/l;break;case"count":h=l;break;case"min":h=e;break;case"max":h=f}}}return h}},getCellComponent:function(a,b,c,d,e,f){var g=this;if(g.grid)return this.element.find("#"+a).find("[aria-describedby$="+b+"]").find(".ctrl-init")},_formatter:function(a,b,c,d,e){var f,g=this.options.colModel[c];if("undefined"!=typeof g.formatter){var h={rowId:a,colModel:g,gid:this.options.id,pos:c,model:this.options.model},i=$.coral.toFunction(g.formatter);f=$.isFunction(i)?i.apply(this.element[0],[b,h,d,e]):$.fmatter?$.fn.fmatter.call(this,g.formatter,b,h,d,e):this._cellVal(b)}else f=this._cellVal(b);return f},_getOffset:function(a){var b,c=this,d={},e=$.support.boxSizing?0:c.options.cellLayout;for(d[0]=d[1]=d[2]=0,b=0;a>=b;b++)c.options.colModel[b].hidden!==!1&&"undefined"!=typeof c.options.colModel[b].hidden||(d[0]+=c.options.colModel[b].width+e);return d[0]=d[0]-c.grid.rowsView.scrollLeft,d[2]+=$(c.grid.rowsView).height()+$(c.grid.columnsView).height(),d},_sortData:function(a,b,c,d,e){var f=this;if(this.options.colModel[b].sortable){f.options.b_sortdata=!0;var g;if(!(this.options.savedRow.length>0)){if(c||(this.options.lastsort==b?"asc"==this.options.sortorder?this.options.sortorder="desc":"desc"==this.options.sortorder&&(this.options.sortorder="asc"):this.options.sortorder=this.options.colModel[b].firstsortorder||"asc",this.options.page=1),d){if(this.options.lastsort==b&&this.options.sortorder==d&&!c)return;f.options.sortorder=d}var h=this.grid.headers[this.options.lastsort].el,i=this.options.frozenColumns?e:this.grid.headers[b].el;if($("span.coral-grid-ico-sort",h).addClass("coral-state-disabled"),$(h).attr("aria-selected","false"),this.options.frozenColumns&&(this.grid.fhDiv?(this.grid.fhDiv.find("span.coral-grid-ico-sort").addClass("coral-state-disabled"),this.grid.fhDiv.find("th").attr("aria-selected","false")):this.grid.rightfhDiv&&(this.grid.rightfhDiv.find("span.coral-grid-ico-sort").addClass("coral-state-disabled"),this.grid.rightfhDiv.find("th").attr("aria-selected","false"))),$("span.coral-icon-"+this.options.sortorder,i).removeClass("coral-state-disabled"),$(i).attr("aria-selected","true"),this.options.viewsortcols[0]||(this.options.lastsort!=b?(this.options.frozenColumns&&(this.grid.fhDiv?this.grid.fhDiv.find("span.s-ico").hide():this.grid.rightfhDiv&&this.grid.rightfhDiv.find("span.s-ico").hide()),$("span.s-ico",h).hide(),$("span.s-ico",i).show()):""===this.options.sortname&&$("span.s-ico",i).show()),a=a.substring(5+this.options.id.length+1),this.options.sortname=this.options.colModel[b].index||a,g=this.options.sortorder,"stop"===f._trigger("onSortCol",null,[{id:a,colIndex:b,sortorder:g}]))return void(this.options.lastsort=b);if("local"==this.options.datatype?this.options.deselectAfterSort&&$(this.element).grid("resetSelection"):(this.options.selrow=null,this.options.multiselect&&f._setHeadCheckBox(!1),this.options.selarrrow=[],this.options.savedRow=[]),this.options.scroll){var j=this.grid.rowsView.scrollLeft;emptyRows(this.grid.rowsView,!0,!1),this.grid.columnsView.scrollLeft=j}this.options.subGrid&&"local"==this.options.datatype&&$("td.sgexpanded","#"+$.grid.coralID(this.options.id)).each(function(){$(this).trigger("click")}),this._populate(),this.options.lastsort=b,this.options.sortname!=a&&b&&(this.options.lastsort=b),f.options.b_sortdata=!1}}},_intNum:function(a,b){return a=parseInt(a,10),isNaN(a)?b?b:0:a},_beginReq:function(){var a=$("#noRecordsTips_"+$.grid.coralID(this.options.id));if(a.is(":visible")&&a.hide(),this.refresh(),this.grid.columnsView.loading=!0,!this.options.hiddengrid)switch(this.options.loadui){case"disable":break;case"enable":$(this.element).loading({position:"overlay",text:this.options.loadtext});break;case"block":$("#lui_"+$.grid.coralID(this.options.id)).show(),$(this.element).loading({position:"overlay",text:this.options.loadtext})}},_endReq:function(){var a=this;switch(this._delay(function(){a.refreshPager()},300),this.grid.columnsView.loading=!1,this.options.loadui){case"disable":break;case"enable":$(this.element).loading("hide");break;case"block":$("#lui_"+$.grid.coralID(this.options.id)).hide(),$(this.element).loading("hide")}this.element.find(".coral-grid-htable,.coral-grid-btable").css({"table-layout":"fixed"}),0==$(a.grid.rowsView).find(".jqgrow").length?(a._noRecordsTipsPositon(),$("#noRecordsTips_"+$.grid.coralID(a.options.id)).css("display","inline-block"),$(a.grid.fhDiv).css("display","none"),$(a.grid.fhDiv).css("display","none")):($("#noRecordsTips_"+$.grid.coralID(a.options.id)).css("display","none"),$(a.grid.fhDiv).css("display","block"),$(a.grid.fhDiv).css("display","block"))},_noRecordsTipsPositon:function(){var a=this,b=this.element.width(),c=this.gridRows.height(),d=($("#noRecordsTips_"+$.grid.coralID(a.options.id)).width(),$("#noRecordsTips_"+$.grid.coralID(a.options.id)).height());$("#noRecordsTips_"+$.grid.coralID(a.options.id)).css({"margin-top":(c-d)/2+"px","margin-left":b/2+"px"})},_setColWidth:function(){var a,b,c,d,e=this,f=this.grid,g=0,h=$.support.boxSizing?0:this._intNum(this.options.cellLayout,0),i=0,j=this._intNum(this.options.scrollOffset,0),k=!1,l=0,m=0;$.each(this.options.colModel,function(){if(e.options.grouping&&e.options.autowidth){var a=$.inArray(this.name,e.options.groupingView.groupField);a>=0&&e.options.groupingView.groupColumnShow.length>a&&(this.hidden=!e.options.groupingView.groupColumnShow[a])}this.widthOrg=b=e._intNum(this.width,0),this.hidden!==!1&&"undefined"!=typeof this.hidden||(g+=b+h,this.fixed?l+=b+h:i++,m++)}),isNaN(e.options.width)?e.options.width=f.width=g:f.width=e.options.width,e.options.tblwidth=g,e.options.shrinkToFit===!1&&e.options.forceFit===!0&&(e.options.forceFit=!1),e.options.shrinkToFit===!0&&i>0&&(c=f.width-h*i-l,isNaN(this.options.height)||(c-=j,k=!0),g=0,$.each(e.options.colModel,function(d){this.hidden!==!1&&"undefined"!=typeof this.hidden||this.fixed||(b=Math.round(c*this.width/(e.options.tblwidth-h*i-l)),this.width=b,g+=b,a=d)}),d=0,k?f.width-l-(g+h*i)!==j&&(d=f.width-l-(g+h*i)-j):k||1===Math.abs(f.width-l-(g+h*i))||(d=f.width-l-(g+h*i)-1),e.options.colModel[a].width+=d,e.options.tblwidth=g+d+h*i+l,e.options.tblwidth>e.options.width&&(e.options.colModel[a].width-=e.options.tblwidth-parseInt(e.options.width,10),e.options.tblwidth=e.options.width),e.options.tblwidth)},_nextVisible:function(a){var b,c=a,d=a;for(b=a+1;b<this.options.colModel.length;b++)if(this.options.colModel[b].hidden!==!0){d=b;break}return d-c},_formatCol:function(a,b,c,d,e,f){var g=this;if("card"==g.options.model)return"";var h,i=g.grid,j=g.options.colModel[a],k=j.align,l='style="',m=j.cls,n=j.name,o=[],p="";k&&(l+="text-align:"+k+";"),j.hidden===!0&&(l+="display:none;");var q=$.coral.toFunction(j.cellattr);if(0===b?l+="width: "+i.headers[a].width+"px;":$.isFunction(q)&&(h=q.apply(g.element[0],[{rowId:e,value:c,rawObject:d,colModel:j,rowData:f}]),h&&"string"==typeof h&&(h=h.replace(/style/i,"style").replace(/title/i,"title"),h.indexOf("title")>-1&&(j.title=!1),h.indexOf("class")>-1&&(m=void 0),o=h.split("style"),2===o.length?(o[1]=$.trim(o[1].replace("=","")),0!==o[1].indexOf("'")&&0!==o[1].indexOf('"')||(o[1]=o[1].substring(1)),l+=o[1].replace(/'/gi,'"')):l+='"')),d){var r=void 0==d[n]?"":d[n];r=$.grid.htmlEncode(r),p+="data-org='"+r+"'"}return o.length||(o[0]="",l+='"'),l+=(void 0!==m?' class="'+m+'"':"")+(j.title&&c?' title="'+$.grid.stripHtml(c)+'"':""),l+=' aria-describedby="'+g.options.id+"_"+n+'"',l+o[0]+p},findTextByValue:function(a,b){var c=b.colModel.editoptions.data;if(!c)return a;for(var d=0;d<c.length;d++)if(c[d].text==a)return c[d].value;return a},_cellVal:function(a){return void 0===a||null===a||""===a?"":this.options.autoencode?$.grid.htmlEncode(a):a+""},_addCell:function(a,b,c,d,e,f){if("card"==this.options.model){var g,h;return g=this._formatter(a,b,c,e,"add"),h=this._formatCol(c,d,g,e,a,f),'<div role="gridcell" '+h+">"+g+"</div>"}var g,h,i;if(g=this._formatter(a,b,c,e,"add"),h=this._formatCol(c,d,g,e,a,f),this.options.enableHighlight&&this.options.postData.filters)for(var j=$.grid.parse(this.options.postData.filters).rules,k=0;k<j.length;k++)i=new RegExp(""+j[k].data,"gmi"),""!=j[k].data&&(g=g.replace(i,'<span class="coral-keyword-highlight">'+j[k].data+"</span>"));return'<td role="gridcell" '+h+">"+g+"</td>"},_orderedCols:function(a){var b=this,c=b.options.remapColumns;return c&&c.length||(c=$.map(b.options.colModel,function(a,b){return b})),a&&(c=$.map(c,function(b){return a>b?null:b-a})),c},emptyRows:function(a,b,c){var d=this,e=!("card"!=d.options.model);if(e)$("#"+$.grid.coralID(d.options.id)+" .coral-pic").children().remove();else{if(d.options.deepempty)$("#"+$.grid.coralID(d.options.id)+" tbody:first tr:gt(0)").remove();else if(d.options.filterToolbar){var f=d.gridRows.find(".coral-grid-btable")[0].rows.length>0?d.gridRows.find(".coral-grid-btable")[0].rows[0]:null;$("#"+$.grid.coralID(d.options.id+"_table")+" tbody:first").empty().append(f)}else{var f=$("#"+$.grid.coralID(d.options.id)+" tbody:first tr:first")[0];$("#"+$.grid.coralID(d.options.id)+" tbody:first").empty().append(f)}b&&d.options.scroll&&($(">div:first",a).css({height:"auto"}).children("div:first").css({height:0,display:"none"}),a.scrollTop=0),c===!0&&d.options.treeGrid===!0&&(d.options.data=[],d.options._index={})}},normalizeData:function(){var a,b,c,d,e,f,g,h,i,j,k,l=this.options,m=l.data,n=m.length,o=l.localReader,p=l.colModel,q=o.cell,r=(l.multiselect===!0?1:0)+(l.subGrid===!0?1:0)+(l.rownumbers===!0?1:0),s=l.scroll?$.jgrid.randId():1;if("local"===l.datatype&&o.repeatitems===!0)for(i=this._orderedCols(r),j=this._reader("local"),d=l.keyName===!1?$.isFunction(o.id)?o.id.call(ts,m):o.id:l.keyName,a=0;n>a;a++){for(c=m[a],e=$.grid.getAccessor(c,d),void 0===e&&("number"==typeof d&&null!=p[d+r]&&(e=$.grid.getAccessor(c,p[d+r].name)),void 0===e&&(e=s+a,q&&(f=$.grid.getAccessor(c,q)||c,e=null!=f&&void 0!==f[d]?f[d]:e,f=null))),h={},h[o.id]=e,q&&(c=$.grid.getAccessor(c,q)||c),k=$.isArray(c)?i:j,b=0;b<k.length;b++)g=$.grid.getAccessor(c,k[b]),h[p[b+r].name]=g;$.extend(!0,m[a],h)}},refreshIndex:function(){var a,b,c,d=this,e=d.options.data.length;for(a=d.options.keyName===!1||d.options.loadonce===!0?d.options.localReader.id:d.options.keyName,b=0;e>b;b++)c=$.grid.getAccessor(d.options.data[b],a),d.options._index[c]=b},constructPanel:function(a,b,c,d,e){var f="-1",g="",h=b?"display:none;":"",i="gridPanel coral-row-"+this.options.direction+c;return'<li role="row" id="'+a+'" tabindex="'+f+'" class="'+i+'"'+(""===h?"":' style="'+h+'"')+g+">"},constructTr:function(a,b,c,d,e,f){var g,h,i="-1",j="",k=b?"display:none;":"",l="coral-component-content jqgrow coral-row-"+this.options.direction+c+(f?" coral-state-highlight":"");if(this.options.treeGrid){var m=this.options.treeReader.parent_id_field;null!==e[m]&&"null"!=String(e[m]).toLowerCase()&&(l+=" treeGridRow ")}var n=$.coral.toFunction(this.options.rowattr);if(h=$.isFunction(n)?n.apply(this.element[0],[{rowId:a,rowData:d,currentObj:e}]):{},!$.isEmptyObject(h)){h.hasOwnProperty("id")&&(a=h.id,delete h.id),h.hasOwnProperty("tabindex")&&(i=h.tabindex,delete h.tabindex),h.hasOwnProperty("style")&&(k+=h.style,delete h.style),h.hasOwnProperty("class")&&(l+=" "+h["class"],delete h["class"]);try{delete h.role}catch(o){}for(g in h)h.hasOwnProperty(g)&&(j+=" "+g+"="+h[g])}return'<tr role="row" id="'+a+'" tabindex="'+i+'" class="'+l+'"'+(""===k?"":' style="'+k+'"')+j+">"},_clearVals:function(a){var b,c=this;return(b=c._trigger("onPaging",null,[{pgButton:a}]))?(c.options.selrow=null,c.options.editrow=null,c.options.multiselect&&(c.options.selarrrow=[],c._setHeadCheckBox(!1)),c.options.savedRow=[],!0):!1},_getPagination:function(){},_setPager:function(a,b){var c=this,d="<span class='paginator-left'>{viewrecords}</span><span class='paginator-center'>{prev}{links}{next}{pginput}{navbar}{description}</span><span class='paginator-right'><em>每页</em>{rninput}<em>条</em></span>",e="<div class='paginator-left'>{viewrecords}{rowlist}{first}{prev}{pginput}{next}{last}{navbar}{description}</div><div class='toolbarpanel'>{toolbar}</div>";b+="_"+a;var f=!1;$.isFunction(c.options.pagerTemplate)&&(f=c.options.pagerTemplate.call(c));var g=this.options.direction,h=["first"+b,"prev"+b,"next"+b,"last"+b];"rtl"==g&&h.reverse();var i,j,k,l,m,n="",o="",p="",q="",r="",s="",t="",u="<span class='coral-paginator-pages'></span>",v="<em class='page-item'>第</em><input type='text' class='coral-pg-input'/><em class='page-item'>页</em>",w="<button class='reload-button' id='_reloadGrid' type='button' data-options='customData:{gridId:\""+c.options.id+'"},label:"刷新",text: false,icons: "cui-icon-loop3",onClick: function( e, ui ){$( "#'+c.options.id+'" ).grid( "reload" );}\'>reload</button>',x="<span id='"+h[0]+"' class='page-item coral-paginator-first coral-state-default coral-corner-all' tabindex='0'><span class='cui-icon-first2' title='第一页'></span></span>",y="<span id='"+h[3]+"' class='page-item coral-paginator-last coral-state-default coral-corner-all' tabindex='0'><span class='cui-icon-last2' title='最后一页'></span></span>",z="<span id='"+h[2]+"' class='page-item coral-paginator-next coral-corner-all' tabindex='0'><span class='cui-icon-arrow-right3' title='下一页'></span></span>",A="<span id='"+h[1]+"' class='page-item coral-paginator-prev coral-corner-all' tabindex='0'><span class='cui-icon-arrow-left3' title='前一页'></span></span>",B="<span>|</span>",C="<span class='page-item pager-navbar'></span>",D="<span class='pager-toolbar'></span>",E="<span class='pager-description'></span>";for(i="pg_"+a,j=a+"_left",k=a+"_center",l=a+"_right",o+="<input type='text' class='coral-rn-input' val=''/>",c.options.rninput&&c.options.rowList.length>0,p+="<select class='coral-pg-selbox' role='listbox'>",m=0;m<c.options.rowList.length;m++)p+='<option role="option" value="'+c.options.rowList[m]+'"'+(c.options.rowNum==c.options.rowList[m]?' selected="selected"':"")+">"+c.options.rowList[m]+"</option>";p+="</select>",c.options.viewrecords&&(q+="<span class='page-item coral-paging-info'></span>",r+="<span class='page-item coral-paging-totalpage'></span>"),c.options.pginput===!0&&(n="<td dir='"+g+"'>"+$.grid.format(c.options.pgtext||"","<input class='coral-pg-input' type='text' size='2' maxlength='7' value='0' role='textbox'/>","<span id='sp_1_"+$.grid.coralID(a)+"'></span>")+"</td>"),"flex"==c.options.pagerStyle?(f&&(d=f),t="<span id='"+h[1]+"' class='page-item coral-paginator-prev coral-corner-all' tabindex='0'><span class='cui-icon-arrow-left3'>p</span></span><span class='coral-paginator-pages'></span><span id='"+h[2]+"' class='page-item coral-paginator-next coral-corner-all' tabindex='0'><span class='cui-icon-arrow-right3'>p</span></span><em class='page-item'>第</em><input type='text' class='coral-pg-input'/><em class='page-item'>页</em>",s=d.replace(/\{viewrecords\}/g,q).replace(/\{navbar\}/g,C).replace(/\{reload\}/g,w).replace(/\{-\}/g,B).replace(/\{first\}/g,x).replace(/\{last\}/g,y).replace(/\{next\}/g,z).replace(/\{totalPage\}/g,r).replace(/\{prev\}/g,A).replace(/\{links\}/g,u).replace(/\{pginput\}/g,v).replace(/\{toolbar\}/g,D).replace(/\{description\}/g,E).replace(/\{rowlist\}/g,p).replace(/\{rninput\}/g,o),$("#"+$.grid.coralID(a)).addClass("coral-pager-flex"),$("#"+$.grid.coralID(a)).append("<div id='"+i+"' class='coral-paginator' role='group'>"+s+"</div>"),c._bindpager(a,b)):"tradition"==c.options.pagerStyle&&(f&&(e=f),t="<span id='"+h[0]+"' class='page-item coral-paginator-first coral-state-default coral-corner-all' tabindex='0'><span class='cui-icon-first2'></span></span><span id='"+h[1]+"' class='page-item coral-paginator-prev coral-corner-all' tabindex='0'><span class='cui-icon-arrow-left3'></span></span><em class='page-item'>第</em><input type='text' class='coral-pg-input'/><em class='page-item'>页</em><span id='"+h[2]+"' class='page-item coral-paginator-next coral-corner-all' tabindex='0'><span class='cui-icon-arrow-right3'></span></span><span id='"+h[3]+"' class='page-item coral-paginator-last coral-state-default coral-corner-all' tabindex='0'><span class='cui-icon-last2'></span></span>",s=e.replace(/\{viewrecords\}/g,q).replace(/\{navbar\}/g,C).replace(/\{reload\}/g,w).replace(/\{-\}/g,B).replace(/\{first\}/g,x).replace(/\{last\}/g,y).replace(/\{next\}/g,z).replace(/\{prev\}/g,A).replace(/\{links\}/g,u).replace(/\{totalPage\}/g,r).replace(/\{pginput\}/g,v).replace(/\{toolbar\}/g,D).replace(/\{description\}/g,E).replace(/\{rowlist\}/g,p).replace(/\{rninput\}/g,o),$("#"+$.grid.coralID(a)).addClass("coral-pager-tradition"),$("#"+$.grid.coralID(a)).append("<div id='"+i+"' class='coral-paginator' role='group'>"+s+"</div>"),c._bindpagerTradition(a,b));var F=$.parser.parseOptions($("#"+$.grid.coralID(a))[0],null);c.options.toolbarOptions=F.toolbarOptions,c.options.description=F.description;c.options.navbarOptions||{};F.toolbarOptions=F.toolbarOptions||{},$(".reload-button",c.element).button({componentCls:"page-item pg"}),$(".pager-toolbar",c.element).length&&$(".pager-toolbar",c.element).toolbar(F.toolbarOptions),c.options.description&&$(".pager-description",c.element).html(c.options.description)},_bindpagerTradition:function(a,b){var c=this;$("input.coral-pg-input",$("#"+$.grid.coralID(a))).textbox({
componentCls:"page-item pg",onKeyPress:function(a,b){var d=a.charCode?a.charCode:a.keyCode?a.keyCode:0;if(13==d){var e=c._intNum(c.options.lastpage,1),f=c._intNum(b.text,1);return f>e?(c.options.page=e,$(this).textbox("setValue",c.options.page)):c.options.page=b.text>0?b.text:c.options.page,c._clearVals("user")?(c._populate(),!1):!1}return this},onBlur:function(){var a=(c._intNum(c.options.lastpage,1),$(this).textbox("getValue"));a!==c.options.page&&$(this).textbox("setValue",c.options.page)}}),$("input.coral-rn-input",$("#"+$.grid.coralID(a))).textbox({componentCls:"page-item rn",onKeyPress:function(a,b){var d=a.charCode?a.charCode:a.keyCode?a.keyCode:0;return 13==d?(c.options.rowNum=b.text>0?b.text<c.options.rowNumMax?b.text:c.options.rowNumMax:c.options.rowNum,c._clearVals("records")?(c._populate(),!1):!1):this}}),$(".coral-pg-selbox",$("#"+$.grid.coralID(a))).combobox({componentCls:"page-item rn",panelHeight:"auto",showClose:!1,panelRenderOnShow:!1,onChange:function(a,b){return c.options.page=Math.round(c.options.rowNum*(c.options.page-1)/b.value-.5)+1,c.options.rowNum=b.value,c._clearVals("records")?(c._populate(),!1):!1}}),$("#first"+$.grid.coralID(b)+", #prev"+$.grid.coralID(b)+", #next"+$.grid.coralID(b)+", #last"+$.grid.coralID(b)).click(function(){var a=c._intNum(c.options.page,1),d=c._intNum(c.options.lastpage,1),e=!1,f=!0,g=!0,h=!0,i=!0;if(0===d||1===d?(f=!1,g=!1,h=!1,i=!1):d>1&&a>=1?1===a?(f=!1,g=!1):a===d&&(h=!1,i=!1):d>1&&0===a&&(h=!1,i=!1,a=d-1),this.id==="first"+b&&f&&(c.options.page=1,e=!0),this.id==="prev"+b&&g&&(c.options.page=a-1,e=!0),this.id==="next"+b&&h&&(c.options.page=a+1,e=!0),this.id==="last"+b&&i&&(c.options.page=d,e=!0),e){if(!c._clearVals(this.id))return!1;c._populate()}return!1})},_bindpager:function(a,b){var c=this;$("input.coral-pg-input",$("#"+$.grid.coralID(a))).textbox({componentCls:"page-item pg",onKeyPress:function(a,b){var d=a.charCode?a.charCode:a.keyCode?a.keyCode:0;if(13==d){var e=c._intNum(c.options.lastpage,1),f=c._intNum(b.text,1);return f>e?(c.options.page=e,$(this).textbox("setValue",c.options.page)):c.options.page=b.text>0?b.text:c.options.page,c._clearVals("user")?(c._populate(),!1):!1}return this},onBlur:function(){var a=(c._intNum(c.options.lastpage,1),$(this).textbox("getValue"));a!==c.options.page&&$(this).textbox("setValue",c.options.page)}}),$("input.coral-rn-input",$("#"+$.grid.coralID(a))).textbox({componentCls:"page-item rn",onKeyPress:function(a,b){var d=a.charCode?a.charCode:a.keyCode?a.keyCode:0;return 13==d?(c.options.rowNum=b.text>0?b.text<c.options.rowNumMax?b.text:c.options.rowNumMax:c.options.rowNum,c._clearVals("records")?(c._populate(),!1):!1):this}}),$(".coral-pg-selbox",$("#"+$.grid.coralID(a))).combobox({componentCls:"page-item rn",panelHeight:"auto",showClose:!1,panelRenderOnShow:!1,onChange:function(a,b){return c.options.page=Math.round(c.options.rowNum*(c.options.page-1)/b.newValue-.5)+1,c.options.rowNum=b.newValue,c._clearVals("records")?(c._populate(),!1):!1}}),$(".coral-textbox-btn-ico-search",$("#"+$.grid.coralID(a))).click(function(a){return c.options.page=$(this).prev().val()>0?$(this).prev().val():c.options.page,c._clearVals("user")?(c._populate(),!1):!1}),this._off($(".coral-paginator-page")),this._on({"click.coral-paginator-page":function(a){var b=a.target;$(b).hasClass("coral-state-disabled")?b.style.cursor="default":($(b).addClass("coral-state-hover"),b.style.cursor="pointer")}}),this._on({"mouseenter.coral-paginator-page":function(a){var b=a.target;$(b).hasClass("coral-state-disabled")?b.style.cursor="default":($(b).addClass("coral-state-hover"),b.style.cursor="pointer")},"mouseleave.coral-paginator-page":function(a){var b=a.target;$(b).hasClass("coral-state-disabled")||($(b).removeClass("coral-state-hover"),b.style.cursor="default")}}),$("#first"+$.grid.coralID(b)+", #prev"+$.grid.coralID(b)+", #next"+$.grid.coralID(b)+", #last"+$.grid.coralID(b)).click(function(){var a=c._intNum(c.options.page,1),d=c._intNum(c.options.lastpage,1),e=!1,f=!0,g=!0,h=!0,i=!0;if(0===d||1===d?(f=!1,g=!1,h=!1,i=!1):d>1&&a>=1?1===a?(f=!1,g=!1):a===d&&(h=!1,i=!1):d>1&&0===a&&(h=!1,i=!1,a=d-1),this.id==="first"+b&&f&&(c.options.page=1,e=!0),this.id==="prev"+b&&g&&(c.options.page=a-1,e=!0),this.id==="next"+b&&h&&(c.options.page=a+1,e=!0),this.id==="last"+b&&i&&(c.options.page=d,e=!0),e){if(!c._clearVals(this.id))return!1;c._populate()}return!1})},_updatepager:function(a,b){var c,d,e,f,g,h,i,j,k,l,m=this,n="",o=m.options.pager?"_"+$.grid.coralID(m.options.pager.substr(1)):"",p=m.options.toppager?"_"+m.options.toppager.substr(1):"";if(e=parseInt(m.options.page,10)-1,0>e&&(e=0),e*=parseInt(m.options.rowNum,10),g=e+m.options.reccount,m.options.scroll){var q=$("tbody:first > tr:gt(0)",m.grid.rowsView);e=g-q.length,m.options.reccount=q.length;var r=q.outerHeight()||m.grid.prevRowHeight;if(r){var s=e*r,t=parseInt(m.options.records,10)*r;$(">div:first",m.grid.rowsView).css({height:t}).children("div:first").css({height:s,display:s?"":"none"})}m.grid.rowsView.scrollLeft=m.grid.columnsView.scrollLeft}if(m.options.treeGrid){var q=$("tbody:first > tr:not(.treeGridRow,.jqgfirstrow)",m.grid.rowsView);m.options.reccount=q.length,g=e+m.options.reccount}if(n=$(m.element).find(".coral-grid-pager"),n.length>0){if(i=$.grid.formatter.integer||{},c=m._intNum(m.options.page),d=m._intNum(m.options.lastpage),$(".selbox",n)[this.options.useProp?"prop":"attr"]("disabled",!1),$(".coral-pg-input",n).length>0&&($(".coral-pg-input",n).val(m.options.page),j=m.options.toppager?"#sp_1"+o+",#sp_1"+p:"#sp_1"+o,$(j).html($.fmatter?$.fmatter.util.NumberFormat(m.options.lastpage,i):m.options.lastpage)),m.options.rninput===!0&&$(".coral-rn-input",n).val(m.options.rowNum),m.options.viewrecords&&(0===m.options.reccount?($(".coral-paging-info",n).html(""),$(".coral-paging-totalpage",n).html("")):(f=e+1,h=m.options.records,k=m.options.reccount,l=h%k==0?parseInt(h/k):parseInt(h/k)+1,$.fmatter&&(f=$.fmatter.util.NumberFormat(f,i),g=$.fmatter.util.NumberFormat(g,i),h=$.fmatter.util.NumberFormat(h,i),k=$.fmatter.util.NumberFormat(k,i),l=$.fmatter.util.NumberFormat(l,i)),$(".coral-paging-info",n).html($.grid.format(m.options.recordtext,f,g,h)),$(".coral-paging-totalpage",n).html($.grid.format(m.options.pagetext,l)))),m.options.pgbuttons===!0){var u=[],v=[];m.pagers.each(function(){u.push("#first_"+this.id),u.push("#prev_"+this.id),v.push("#next_"+this.id),v.push("#last_"+this.id)}),0>=c&&(c=d=0),1==c||0===c?($(u.join(",")).addClass("coral-state-disabled").removeClass("coral-state-hover"),m.options.toppager&&$("#first_t"+p+", #prev_t"+p).addClass("coral-state-disabled").removeClass("coral-state-hover")):($(u.join(",")).removeClass("coral-state-disabled"),m.options.toppager&&$("#first_t"+p+", #prev_t"+p).removeClass("coral-state-disabled")),c==d||0===c?($(v.join(",")).addClass("coral-state-disabled").removeClass("coral-state-hover"),m.options.toppager&&$("#next_t"+p+", #last_t"+p).addClass("coral-state-disabled").removeClass("coral-state-hover")):($(v.join(",")).removeClass("coral-state-disabled"),m.options.toppager&&$("#next_t"+p+", #last_t"+p).removeClass("coral-state-disabled")),0==d&&$(v.join(",")).addClass("coral-state-disabled").removeClass("coral-state-hover")}m._paginators()}a===!0&&m.options.rownumbers===!0&&$("td.grid-rownum",m.rows).each(function(a){$(this).html(e+1+a)}),b&&m.options.jqgdnd&&$(m.element).grid("gridDnD","updateDnD"),m._trigger("onComplete",null,[]),m._trigger("afterComplete",null,[])},_paginators:function(){var a,b=this,c=b._intNum(b.options.page,1),d=b._intNum(b.options.lastpage,1),e=3,f=c>2?c+2-e:1,g="";a=e+f>d?d+1:e+f,f>3&&d+2>=a&&(f=a-e),c>2&&d>e&&(f>=2&&(g+="<span class='coral-paginator-page coral-state-default coral-corner-all'  tabindex='0'>1</span>"),f>=3&&(g+="<span class='coral-paginator-page coral-state-default coral-corner-all'  tabindex='0'>2</span>"),3!=f&&1!=f&&2!=f&&(g+="<span class='coral-page-pointer'>...</span>"));for(var h=f;a>h;h++)g+=c==h?"<span class='coral-paginator-page coral-state-default coral-state-active coral-corner-all'  tabindex='0'>"+h+"</span>":"<span class='coral-paginator-page coral-state-default coral-corner-all'  tabindex='0'>"+h+"</span>";a==d?g+="<span class='coral-paginator-page coral-state-default coral-corner-all'>"+d+"</span>":d>=a&&(g+="<span class='coral-page-pointer'>...</span><span class='coral-paginator-page coral-state-default coral-corner-all'>"+d+"</span>"),$(".coral-paginator-pages",b.element).html(g)},_populate:function(a){var b,c=this,d=!("card"!=c.options.model),e=c.grid,f=c.options.scroll&&a===!1,g={},h=c.options.prmNames;c.options.page<=0&&(c.options.page=1),null!==h.search&&(g[h.search]=c.options.search),null!==h.nd&&(g[h.nd]=(new Date).getTime()),null!==h.rows&&(g[h.rows]=c.options.rowNum),null!==h.page&&(g[h.page]=c.options.page),null!==h.sort&&(g[h.sort]=c.options.sortname),null!==h.order&&(g[h.order]=c.options.sortorder),null!==c.options.rowTotal&&null!==h.totalrows&&(g[h.totalrows]=c.options.rowTotal);var i=function(a){if(c._trigger("onLoad",null,[a]),c.options.afterSortableRows&&$.fn.sortable)try{$(c.element).grid("sortableRows")}catch(b){}if(c.options.onSortableLoad&&$.fn.sortable)try{var d=[];if(null==c.options.connectGridId)d="#"+c.element[0].id+" tbody:first";else{for(var e=c.options.connectGridId.split(","),f=0;f<e.length;f++){var g=e[f];d.push("#"+g+" tbody:first")}d=d.join(", ")}$("#"+c.element[0].id).grid("sortableGrid",{connectWith:d})}catch(b){}},j=0;if(a=a||1,a>1?null!==h.npage?(g[h.npage]=a,j=a-1,a=1):i=function(b){c.options.page++,e.columnsView.loading=!1,c._trigger("onLoad",null,[b]),c._populate(a-1)}:null!==h.npage&&delete c.options.postData[h.npage],c.options.grouping){this.groupingSetup();var k,l=c.options.groupingView,m="";for(k=0;k<l.groupField.length;k++){var n=l.groupField[k];$.each(c.options.colModel,function(a,b){b.name===n&&b.index&&(n=b.index)}),m+=n+" "+l.groupOrder[k]+", "}g[h.sort]=m+g[h.sort]}c.options.containSortOrder&&g[h.sort]&&g[h.order]&&(g[h.sort]=g[h.sort]+c.options.sortSeparator+g[h.order]),$.extend(c.options.postData,g);var o=c.options.scroll?c.rows.length-1:1,p=c._trigger("beforeRequest",null,[]);if(p!==!1&&"stop"!==p){if($.isFunction(c.options.datatype))return void c.options.datatype.call(c,c.options.postData,"load_"+c.options.id);b=c.options.datatype.toLowerCase(),c.options.b_sortdata&&c.options.b_sortdata===!0||!c.options.orgdatatype||(b=c.options.orgdatatype,c.options.datatype=b),!c.options.remoteFilter&&c.isFilterAction&&(b="local"),c.options.localonce&&(b="local"),c.options.initData&&(b="initinlocal");var q=function(g,h,k){c.options.orgdatatype=b;var l,m;if(l="local"==c.options.orgdatatype?c.options.localReader:c.options.jsonReader,m=$.grid.getAccessor(g,l.root),c.options.generalLevel===!0||"true"==c.options.generalLevel){var n=c.transformToTreeFormat(m);c.options.data=c.recurrenceNode(n),c.options.data=c.transformToArrayFormat(c.options.data),m=c.options.data}return c._trigger("beforeProcessing",null,[{content:g,state:h,xhr:k}])?(c._addJSONData(g,e.rowsView,o,a>1,j),(c.options.loadonce||c.options.treeGrid)&&(c.options.datatype="local",c.options.orgpage=c.options.page),d||c._hasScrollOffset(),i&&i.call(c,g),c._trigger("afterLoad",null,[{content:g}]),f&&e.populateVisible(),1===a&&c._endReq(),0==m.length&&1!=parseInt(c.options.page)&&parseInt(c.options.lastpage)<parseInt(c.options.page)&&$(c.element).grid("reload",{page:c.options.lastpage}),g=null,void c.refresh()):void c._endReq()};switch(b){case"initinlocal":b="json",q(c.options.initData,null,null),this.options.initData=!1;break;case"json":case"jsonp":this.xhr&&this.xhr.abort(),this.xhr=$.ajax(this._ajaxSettings()),this.xhr.success(function(a,b,c){q(a,b,c)}).error(function(b,d,e){c._trigger("onLoadError",null,[{xhr:b,st:d,err:e}]),1===a&&c._endReq(),b=null,c.refresh()}).complete(function(a,b){a===c.xhr&&(c.xhr=null)});break;case"local":case"clientside":c._beginReq(),c.options.datatype="local";var r=c._addLocalData();this._addJSONData(r,e.rowsView,o,a>1,j),c.options.b_sortdata||(c.refresh(),i&&i.call(c,r),c._trigger("AfterLoad",null,[r]),f&&e.populateVisible()),c._endReq(),c.options.frozenColumns&&c._setFrozenHeight()}}},_setFrozenHeight:function(){var a=this,b="",c=0,d=0,e=0;this.grid.fhDiv&&(c=this.grid.fhDiv.height(),this.grid.fbDiv.css("top",c),$("tr",a.grid.fbDiv).slice(1).each(function(){b=$(this).attr("id"),d=parseFloat($("td:first",this).height()),e=parseFloat($("#"+b,a.gridRows).find("td:first").height()),e>d?$("td",this).each(function(){$(this).height(e)}):d>e&&$("td",$("#"+b,a.gridRows)).each(function(){$(this).height(d)})})),this.grid.rightfhDiv&&(c=this.grid.rightfhDiv.height(),this.grid.rightfbDiv.css("top",c),$("tr",a.grid.rightfbDiv).slice(1).each(function(){b=$(this).attr("id"),d=parseFloat($("td:first",this).height()),e=parseFloat($("#"+b,a.gridRows).find("td:first").height()),e>d?$("td",this).each(function(){$(this).height(e)}):d>e&&$("td",$("#"+b,a.gridRows)).each(function(){$(this).height(d)})}))},_ajaxSettings:function(){var a=this,b=this.options;return $.extend({url:b.url,type:b.asyncType,beforeSend:function(b,c){var d=!0;return d=a._trigger("beforeSend",null,{xhr:b,settings:c}),void 0===d&&(d=!0),d===!1?!1:void a._beginReq()},data:$.isFunction(b.serializeGridData)?b.serializeGridData.call(this,b.postData):b.postData,dataType:"json"},$.grid.ajaxOptions,b.ajaxGridOptions)},_reader:function(a){var b,c,d=this,e=[],f=0;for(c=0;c<this.options.colModel.length;c++)b=this.options.colModel[c],"cb"!==b.name&&"subgrid"!==b.name&&"rn"!==b.name&&(e[f]="local"==a?b.name:"xml"==a||"xmlstring"===a?b.xmlmap||b.name:b.jsonmap||b.name,d.options.keyName!==!1&&b.key===!0&&(d.options.keyName=e[f]),f++);return e},_addMulti:function(a,b,c,d){var e=this,f=!("card"!=e.options.model),g='<input role="checkbox" type="checkbox" id="jqg_'+e.options.id+"_"+a+'" class="cbox" name="jqg_'+e.options.id+"_"+a+'"'+(d?'checked="checked"':"")+"/>",h=e._formatCol(b,c,"",null,a,!0);return f?g:'<td role="gridcell" '+h+">"+g+"</td>"},_addSingle:function(a,b,c){var d=this,e=!("card"!=d.options.model),f='<input role="radio" type="radio" id="jqg_'+d.options.id+"_"+a+'" class="cbox" name="jqg_'+d.options.id+'"/>',g=d._formatCol(b,c,"",null,a,!0);return e?f:'<td role="gridcell" '+g+">"+f+"</td>"},_addRowNum:function(a,b,c,d){var e=(parseInt(c,10)-1)*parseInt(d,10)+1+b,f=this._formatCol(a,b,e,null,b,!0);return'<td role="gridcell" class="coral-state-default grid-rownum" '+f+">"+e+"</td>"},_customPanel:function(a,b,c){var d=this,e={},f="",g="",h="",i="";if(e=$.coralApply($.coral.toFunction(d.options.picTemplate),d.element[0],[{rowData:a,ni:b,muti:c,getData:!0}]),"undefined"==typeof e)return"";var j=e.src;j||(j="src"),f=e.coreData||(a.src?"<img src='"+a.src+"'/>":""),g=e.itemData||"",h=e.toolbarsData||"",i=e.buttonsData||"";var k=[];return k.push("<ul class='rowgrid coral-component-content coral-corner-all'>"),""!=f&&(k.push("<li class='gridModel1 gridModel'>"),k.push(f),k.push("<div class='valigh-fix'></div>"),h.length>0&&k.push("<div class='gridtoolbars'><div class='bgopacity'>&#160;</div>"+h+"</div>"),k.push("</li>")),g.length>0&&(k.push("<li class='gridModel2 gridModel'>"),k.push("<div class='griditem'>"+g+"</div>"),k.push("</li>")),(e.muti&&c.length>0||i.length>0)&&(k.push("<li class='gridModel3 gridModel'>"),(g.length>0||i.length>0)&&(k.push("<ul class='griditem'>"),c.length>0&&e.muti&&k.push("<li class='gridCheckbox'>"+c+"</li>"),i.length>0&&k.push("<li class='gridbuttons'>"+i+"</li>"),k.push("</ul>")),k.push("</li>")),k.push("</ul>"),k.join("")},_addJSONData:function(a,b,c,d,e){var f=this,g=!("card"!=f.options.model),h=new Date;if(a){-1!==f.options.treeANode||f.options.scroll?c=c>1?c:1:(f.emptyRows(b,!1,!0),c=1);var i,j,k="_id_",l="local"!=f.options.datatype&&f.options.loadonce||"jsonstring"==f.options.datatype;l&&(f.options.data=[],f.options._index={},f.options.localReader.id=k),f.options.reccount=0,"local"==f.options.datatype?(i=f.options.localReader,j="local"):(i=f.options.jsonReader,j="json");var m,n,o,p,q,r,s,t,u,v,w,x,y=this,z=0,A=[],B=f.options.multiselect?1:0,C=f.options.subGrid?1:0,D=f.options.rownumbers===!0?1:0,E={},F=[],G=[],H=[],I=f.options.altRows===!0?" "+f.options.altclass:"";0==B&&(B=f.options.singleselect?1:0),f.options.page=$.grid.getAccessor(a,i.page)||0,x=$.grid.getAccessor(a,i.total),f.options.lastpage=void 0===x?1:x,f.options.records=$.grid.getAccessor(a,i.records)||0,f.options.total=$.grid.getAccessor(a,i.total)||0,f.options.userData=$.grid.getAccessor(a,i.userData)||{},i.repeatitems||(p=A=f._reader(j)),t=f.options.keyName===!1?$.isFunction(i.id)?i.id.call(f,a):i.id:f.options.keyName,A.length>0&&!isNaN(t)&&(f.options.remapColumns&&f.options.remapColumns.length&&(t=$.inArray(t,f.options.remapColumns)),t=A[t]),s=$.grid.getAccessor(a,i.root),s||(s=[]),r=s.length,n=0,r>0&&f.options.page<=0&&(f.options.page=1);var J,K,L=parseInt(f.options.rowNum,10),M=f.options.scroll?$.grid.randId():1,N=!1;e&&(L*=e+1),"local"!==f.options.datatype||f.options.deselectAfterSort||(N=!0);var O,P=$.isFunction(f.options.afterInsertRow),Q=[],R=!1;for(f.options.grouping&&(R=f.options.groupingView.groupCollapse===!0,O=this.groupingPrepare);r>n;){if(q=s[n],v=$.grid.getAccessor(q,t),void 0===v&&(v=M+n,0===A.length&&i.cell)){var S=$.grid.getAccessor(q,i.cell);v=void 0!==S?S[t]||v:v,S=null}v=f.options.idPrefix+v,J=1===c?0:c,w=(J+n)%2==1?I:"",N&&(K=f.options.multiselect?-1!==$.inArray(v,f.options.selarrrow):v===f.options.selrow);var T=F.length;G.length;for(F.push(""),D&&F.push(f._addRowNum(0,n,f.options.page,f.options.rowNum)),B&&(f.options.singleselect?(F.push(f._addSingle(v,D,n,K)),H.push(f._addSingle(v,D,n,K))):(F.push(f._addMulti(v,D,n,K)),H.push(f._addMulti(v,D,n,K)))),C&&F.push($(f.element).grid("addSubGridCell",B+D,n+c)),i.repeatitems&&(i.cell&&(q=$.grid.getAccessor(q,i.cell)),p||(p=this._orderedCols(B+C+D))),o=0;o<p.length;o++)m=$.grid.getAccessor(q,p[o]),E[f.options.colModel[o+B+C+D].name]=m,F.push(this._addCell(v,m,o+B+C+D,n+c,q,E));if("card"==f.options.model?(G[T]=f.constructPanel(v,R,w,E,q),G.push(f._customPanel(E,D,H)),G.push("</li>")):(F[T]=f.constructTr(v,R,w,E,q,K),F.push("</tr>")),f.options.grouping&&(Q.push(F),f.options.groupingView._locgr||O.call(y,E,n),F=[]),(l||f.options.treeGrid===!0)&&(E[k]=v,f.options.data.push(E),f.options._index[v]=f.options.data.length-1),f.options.gridview===!1&&(g?$("#"+$.grid.coralID(f.options.id)+" .coral-pic").append(G.join("")):$("#"+$.grid.coralID(f.options.id)+" .coral-grid-btable tbody:first").append(F.join("")),$(f).triggerHandler("gridAfterInsertRow",[v,E,q]),P&&f.options.afterInsertRow.call(f,v,E,q),F=[],G=[],H=[]),E={},z++,n++,z==L)break}if(f.options.gridview===!0&&(u=f.options.treeANode>-1?f.options.treeANode:0,f.options.grouping?l||(this.groupingRender(Q,f.options.colModel.length,f.options.page,L),Q=null):f.options.treeGrid===!0&&u>0?$(f.rows[u]).after(F.join("")):f.options.filterToolbar?$("#"+$.grid.coralID(f.options.id+"_table")+" tbody:first").append(F.join("")):$("#"+$.grid.coralID(f.options.id)+" tbody:first").append(F.join(""))),$.fn.afterFmatter.call(f),f.options.subGrid===!0)try{$(f.element).grid("addSubGrid",B+D)}catch(U){}if(f.options.totaltime=new Date-h,z>0&&0===f.options.records&&(f.options.records=r),F=null,f.options.treeGrid===!0)try{$(f.element).grid("setTreeNode",u+1,z+u+1)}catch(V){}if(f.options.treeGrid||f.options.scroll||g||(f.grid.rowsView.scrollTop=0),f.options.reccount=z,f.options.treeANode=-1,f.options.userDataOnFooter&&$(f.element).grid("footerData",f.options.userData,!0),l&&!f.options.orgdatatype&&(f.options.records=r,f.options.lastpage=Math.ceil(r/L)),d||f._updatepager(!1,!0),l){for(;r>z&&s[z];){if(q=s[z],v=$.grid.getAccessor(q,t),void 0===v&&(v=M+z,0===A.length&&i.cell)){var W=$.grid.getAccessor(q,i.cell);v=W[t]||v,W=null}if(q){for(v=f.options.idPrefix+v,i.repeatitems&&(i.cell&&(q=$.grid.getAccessor(q,i.cell)),p||(p=f._orderedCols(B+C+D))),o=0;o<p.length;o++)m=$.grid.getAccessor(q,p[o]),E[f.options.colModel[o+B+C+D].name]=m;E[k]=v,f.options.grouping&&O.call(y,E,z),f.options.data.push(E),f.options._index[v]=f.options.data.length-1,E={}}z++}f.options.grouping&&(this.groupingRender(Q,f.options.colModel.length,f.options.page,L),Q=null)}}},_addLocalData:function(){function a(b){var c,d,e,g,i,j=0;if(void 0!==b.groups){for(d=b.groups.length&&"OR"===b.groupOp.toString().toUpperCase(),d&&o.orBegin(),c=0;c<b.groups.length;c++){j>0&&d&&o.or();try{a(b.groups[c])}catch(k){alert(k)}j++}d&&o.orEnd()}if(void 0!==b.rules){if(j>0){var l=o.select();o=$.grid.from(l),f.options.ignoreCase&&(o=o.ignoreCase())}try{for(e=b.rules.length&&"OR"===b.groupOp.toString().toUpperCase(),e&&o.orBegin(),c=0;c<b.rules.length;c++)i=b.rules[c],g=b.groupOp.toString().toUpperCase(),n[i.op]&&i.field&&(j>0&&g&&"OR"===g&&(o=o.or()),o=n[i.op](o,g)(i.field,i.data,h[i.field])),j++;e&&o.orEnd()}catch(m){alert(m)}}}var b,c,d,e,f=this,g=!1,h={},i=[],j=[];if($.isArray(f.options.data)){var k,l,m=f.options.grouping?f.options.groupingView:!1;if($.each(f.options.colModel,function(){if(d=this.sorttype||"text","date"==d||"datetime"==d?(this.formatter&&"string"==typeof this.formatter&&"date"==this.formatter?(c=this.formatoptions&&this.formatoptions.srcformat?this.formatoptions.srcformat:$.grid.formatter.date.srcformat,e=this.formatoptions&&this.formatoptions.newformat?this.formatoptions.newformat:$.grid.formatter.date.newformat):c=e=this.datefmt||"Y-m-d",h[this.name]={stype:d,srcfmt:c,newfmt:e}):h[this.name]={stype:d,srcfmt:"",newfmt:""},f.options.grouping)for(l=0,k=m.groupField.length;k>l;l++)if(this.name===m.groupField[l]){var a=this.name;this.index&&(a=this.index),i[l]=h[a],j[l]=a}g||this.index!=f.options.sortname&&this.name!=f.options.sortname||(b=this.name,g=!0)}),f.options.treeGrid)return void $(f.element).grid("sortTree",b,f.options.sortorder,h[b].stype,h[b].srcfmt);var n={eq:function(a){return a.equals},ne:function(a){return a.notEquals},lt:function(a){return a.less},le:function(a){return a.lessOrEquals},gt:function(a){return a.greater},ge:function(a){return a.greaterOrEquals},cn:function(a){return a.contains},nc:function(a,b){return"OR"===b?a.orNot().contains:a.andNot().contains},bw:function(a){return a.startsWith},bn:function(a,b){return"OR"===b?a.orNot().startsWith:a.andNot().startsWith},en:function(a,b){return"OR"===b?a.orNot().endsWith:a.andNot().endsWith},ew:function(a){return a.endsWith},ni:function(a,b){return"OR"===b?a.orNot().equals:a.andNot().equals},"in":function(a){return a.equals},nu:function(a){return a.isNull},nn:function(a,b){return"OR"===b?a.orNot().isNull:a.andNot().isNull}},o=$.grid.from(f.options.data);if(f.options.ignoreCase&&(o=o.ignoreCase()),f.options.search===!0){var p=f.options.postData.filters;if(p)"string"==typeof p&&(p=$.grid.parse(p)),a(p);else try{o=n[f.options.postData.searchOper](o)(f.options.postData.searchField,f.options.postData.searchString,h[f.options.postData.searchField])}catch(q){}}if(f.options.grouping)for(l=0;k>l;l++)o.orderBy(j[l],m.groupOrder[l],i[l].stype,i[l].srcfmt);b&&f.options.sortorder&&g&&f.options.sortname&&("DESC"==f.options.sortorder.toUpperCase()?o.orderBy(f.options.sortname,"d",h[b].stype,h[b].srcfmt):o.orderBy(f.options.sortname,"a",h[b].stype,h[b].srcfmt));var r=o.select(),s=f._trigger("afterFilter",null,[{queryResults:o.select(),getData:!0}]).result;s&&(r=s);var t=parseInt(f.options.rowNum,10),u=r.length,v=parseInt(f.options.page,10),w=Math.ceil(u/t),x={};if((f.options.search||f.options.resetsearch)&&f.options.grouping&&f.options.groupingView._locgr){f.options.groupingView.groups=[];var y,z,A,B=f.groupingPrepare;if(f.options.footerrow&&f.options.userDataOnFooter){for(z in f.options.userData)f.options.userData.hasOwnProperty(z)&&(f.options.userData[z]=0);A=!0}for(y=0;u>y;y++){if(A)for(z in f.options.userData)f.options.userData[z]+=parseFloat(r[y][z]||0);B.call($(this),r[y],y,t)}}return r=-1==f.options.rowNum?r.slice((v-1)*t,v*u):r.slice((v-1)*t,v*t),o=null,h=null,f.options.orgdatatype?(x[f.options.localReader.total]=f.options.lastpage,x[f.options.localReader.page]=f.options.orgpage,x[f.options.localReader.records]=f.options.records):(x[f.options.localReader.total]=w,x[f.options.localReader.page]=v,x[f.options.localReader.records]=u),x[f.options.localReader.root]=r,x[f.options.localReader.userData]=f.options.userData,r=null,x}},getColProp:function(a){var b={},c=this;if(!c.grid)return!1;for(var d=c.options.colModel,e=0;e<d.length;e++)if(d[e].name==a){b=d[e];break}return b},transTempData:function(a){function b(a,c){for(var d=0;d<a.length;d++)a[d].children&&b(a[d].children,c),c.tempData[a[d].id]=a[d]}var c,d;if(a.editoptions&&a.editoptions.data&&"tree"===a.editoptions.dataStructure&&(a.editoptions.tempData={},c=a.editoptions.textField||"name",d=a.editoptions.valueField||"id",b(a.editoptions.data,a.editoptions)),a.formatoptions&&a.formatoptions.data&&"tree"===a.formatoptions.dataStructure&&(a.formatoptions.tempData={},c=a.formatoptions.textField||"name",d=a.formatoptions.valueField||"id",b(a.formatoptions.data,a.formatoptions)),a.formatoptions&&a.formatoptions.data&&"tree"!==a.formatoptions.dataStructure){a.formatoptions.tempData={},c=a.formatoptions.textField||"text",d=a.formatoptions.valueField||"value";for(var e=0;e<a.formatoptions.data.length;e++)a.formatoptions.tempData[a.formatoptions.data[e][d]]=a.formatoptions.data[e]}if(a.editoptions&&a.editoptions.data&&"tree"!==a.editoptions.dataStructure){a.editoptions.tempData={},c=a.editoptions.textField||"text",d=a.editoptions.valueField||"value";for(var e=0;e<a.editoptions.data.length;e++)a.editoptions.tempData[a.editoptions.data[e][d]]=a.editoptions.data[e]}return a},setColProp:function(a,b){if(b=this.transTempData(b),this.grid&&b)for(var c=this.options.colModel,d=0;d<c.length;d++)if(c[d].name==a){$.extend(this.options.colModel[d],b);break}},destroyGroupHeader:function(a){"undefined"==typeof a&&(a=!0);var b,c,d,e,f,g,h,i=this,j=i.grid,k=$("table.coral-grid-htable thead",j.columnsView),l=i.options.colModel;if(j){for($(this.element).unbind(".setGroupHeaders"),b=$("<tr>",{role:"rowheader"}).addClass("coral-grid-labels"),e=j.headers,c=0,d=e.length;d>c;c++){h=l[c].hidden?"none":"",f=$(e[c].el).width(e[c].width).css("display",h);try{f.removeAttr("rowSpan")}catch(m){f.attr("rowSpan",1)}b.append(f),g=f.children("span.coral-grid-resize"),g.length>0&&(g[0].style.height=""),f.children("div")[0].style.top=""}$(k).children("tr.coral-grid-labels").remove(),$(k).prepend(b),a===!0&&$(i.element).grid("option",{groupHeader:null})}},setGroupHeaders:function(a){a=$.extend({useColSpanStyle:!1,groupHeaders:[]},a||{}),this.options.groupHeader=a;var b,c,d,e,f,g,h,i,j,k,l,m,n,o=this,p=0,q=o.options.colModel,r=q.length,s=o.grid.headers,t=$("table.coral-grid-htable",o.grid.columnsView),u=t.children("thead").children("tr.coral-grid-labels:last").addClass("jqg-second-row-header"),v=t.children("thead"),w=t.find(".jqg-first-row-header");void 0===w[0]?w=$("<tr>",{role:"row","aria-hidden":"true"}).addClass("jqg-first-row-header").css("height","auto"):w.empty();var x,y=function(a,b){for(var c=0,d=b.length;d>c;c++)if(b[c].startColumnName===a)return c;return-1};for(o.element.find(".coral-grid-columns-view>table").prepend(v),d=$("<tr>",{role:"rowheader"}).addClass("coral-gird-labels jqg-third-row-header"),b=0;r>b;b++)if(f=s[b].el,g=$(f),c=q[b],h={height:"0px",width:s[b].width+"px",display:c.hidden?"none":""},$("<th>",{role:"gridcell"}).css(h).addClass("coral-first-th-"+o.options.direction).appendTo(w),f.style.width="",i=y(c.name,a.groupHeaders),i>=0){for(j=a.groupHeaders[i],k=j.numberOfColumns,l=j.titleText,m=0,i=0;k>i&&r>b+i;i++)q[b+i].hidden||m++;e=$("<th>").attr({role:"columnheader"}).addClass("coral-state-default coral-th-column-header coral-th-"+o.options.direction).css({"border-top":"0px none"}).html(l),m>0&&e.attr("colspan",String(m)),o.options.headertitles&&e.attr("title",e.text()),0===m&&e.hide(),g.before(e),d.append(f),p=k-1}else 0===p?a.useColSpanStyle?g.attr("rowspan","2"):($("<th>",{role:"columnheader"}).addClass("coral-state-default coral-th-column-header coral-th-"+o.options.direction).css({display:c.hidden?"none":"","border-top":"0px none"}).insertBefore(g),d.append(f)):(d.append(f),p--);n=$(o.element).find(".coral-grid-htable").children("thead"),n.prepend(w),d.insertAfter(u),t.append(n),a.useColSpanStyle&&(t.find("span.coral-gird-resize").each(function(){var a=$(this).parent();a.is(":visible")&&(this.style.cssText="height: "+a.height()+"px !important; cursor: col-resize;")}),t.find("div.coral-gird-sortable").each(function(){var a=$(this),b=a.parent();b.is(":visible")&&b.is(":has(span.coral-gird-resize)")&&a.css("top",(b.height()-a.outerHeight())/2+"px")})),x=n.find("tr.jqg-first-row-header"),$(o.element).bind("gridonresizestop.setGroupHeaders",function(a,b,c){x.find("th").eq(c).width(b)})},getGridParam:function(a){var b=this;if(b&&b.grid)return a?"undefined"!=typeof b.options[a]?b.options[a]:null:b.p},setGridParam:function(a){this.grid&&"object"==typeof a&&$.extend(!0,this.options,a)},_setOption:function(a,b){var c=this,d=this.options;this.grid&&$.extend(!0,d[a],b),"height"==a&&(c._setGridHeight(b),c._hasScrollOffset()),"width"==a&&(c._setGridWidth(b),c._hasScrollOffset()),"model"==a&&("grid"==b?(c.pic.hide(),c.gridRows.show(),c.gridColumns.show()):"card"==b&&(c.gridRows.hide(),c.gridColumns.hide(),c.pic.show())),"datatype"==a&&(this.options.orgdatatype=b),this._super(a,b)},_hasScrollOffset:function(){var a=this,b=this.grid;return"hidden"!=b.rowsView.style.overflow&&"no"!=b.rowsView.scroll&&b.rowsView.scrollHeight>b.rowsView.offsetHeight?($(b.columnsView).css("padding-right",a.options.scrollOffset+"px"),!0):($(b.columnsView).css("padding-right",""),$(b.rowsView).css("padding-right",""),!1)},_hasHorizontalScrollBar:function(){var a=this,b=this.grid;a.rightFrozenWidth;return"hidden"!=b.rowsView.style.overflow&&"no"!=b.rowsView.scroll&&b.rowsView.scrollWidth-b.rowsView.clientWidth>0},_setGridWidth:function(a,b){if(this.grid&&0!=a&&this.rows){var c,d,e,f,g=this,h=this.grid,i=0,j=$.support.boxSizing?0:g.options.cellLayout,k=0,l=!1,m=g.options.scrollOffset,n=0,o=0;if("boolean"!=typeof b&&(b=g.options.shrinkToFit),!isNaN(a)){a=parseInt(a,10),g.grid.width=g.options.width=a,g.options.footerrow&&$(g.grid.sDiv).css("width",a+"px"),b===!1&&g.options.forceFit===!0&&(g.options.forceFit=!1),$.each(g.options.colModel,function(){this.hidden!==!1&&"undefined"!=typeof this.hidden||(c=this.widthOrg?this.widthOrg:parseInt(this.width,10),i+=c+j,this.fixed?n+=c+j:k++,o++)});var p=!1;if(g.options.minWidth&&i>$(g.element).width()&&(p=!0),b===!0||p){if(0===k)return;g.options.tblwidth=i,e=a-j*k-n,isNaN(g.options.height)||($(g.grid.rowsView)[0].clientHeight<$(g.grid.rowsView)[0].scrollHeight||1===g.rows.length)&&(l=!0,e-=m),i=0;var q=g.grid.cols.length>0;if($.each(g.options.colModel,function(a){if((this.hidden===!1||"undefined"==typeof this.hidden)&&!this.fixed){if(c=this.widthOrg?this.widthOrg:parseInt(this.width,10),p||(c=Math.round(e*c/(g.options.tblwidth-j*k-n))),0>c)return;this.width=c,i+=c,g.grid.headers[a].width=c,g.grid.headers[a].el.style.width=c+"px";var b=$("tr.jqg-first-row-header>th:eq("+a+")",$("table:first",g.grid.columnsView));b.length>0&&(b[0].style.width=c+"px"),g.options.footerrow&&(g.grid.footers[a].style.width=c+"px"),q&&(g.grid.cols[a].style.width=c+"px"),d=a}}),!d)return;if(f=0,p?f=g.options.colModel[d].width:(l?a-n-(i+j*k)!==m&&(f=a-n-(i+j*k)-m):1!==Math.abs(a-n-(i+j*k))&&(f=a-n-(i+j*k)),g.options.colModel[d].width+=f-1),g.options.tblwidth=i+f+j*k+n,g.options.tblwidth>a){var r=g.options.tblwidth-parseInt(a,10);g.options.tblwidth=a,c=g.options.colModel[d].width=g.options.colModel[d].width-r}else c=g.options.colModel[d].width;g.grid.headers[d].width=c,g.grid.headers[d].el.style.width=c+"px",q&&(g.grid.cols[d].style.width=c+"px"),g.options.footerrow&&(g.grid.footers[d].style.width=c+"px")}$(h.rowsView).width(a),$(h.columnsView).width(a),g.options.tblwidth&&($("table:first",h.rowsView).css("width",g.options.tblwidth+"px"),$("table:first",h.columnsView).css("width",g.options.tblwidth+"px"),g.grid.columnsView.scrollLeft=g.grid.rowsView.scrollLeft,
g.options.footerrow&&$("table:first",g.grid.sDiv).css("width",g.options.tblwidth+"px"))}}},_setGridHeight:function(a){var b=this,c=b.grid;!("card"!=b.options.model);if(b.grid){var d=$(b.grid.rowsView);b.options.frozenColumns===!0&&$("#"+$.grid.coralID(b.options.id)+"_frozen").parent().height(d.height()-16);var e="auto";"auto"===String(a).toLowerCase()?(a="auto",e="auto",b.pic.css({height:"auto"}),d.css({height:"auto"})):(e=a-b.element.find(".coral-grid-pager").height()-$(c.caption).height(),b.pic.css({height:e+(isNaN(e)?"":"px")}),e=a-$(c.columnsView).outerHeight(!0)-b.element.find(".coral-grid-pager").outerHeight(!0)-$(c.caption).height(),d.css({height:e+(isNaN(e)?"":"px")})),b.options.height=a,b.options.scroll&&b.grid.populateVisible()}},getDataIDs:function(){var a,b=[],c=0,d=0,e=!("card"!=this.options.model);if(e){var f=this.element.find("ul.coral-pic").children("li.gridPanel");if(a=f.length,a&&a>0)for(;a>c;)b[c]=f[c].id,c++}else if(a=this.rows.length,a&&a>0)for(;a>c;)$(this.rows[c]).hasClass("jqgrow")&&(b[d]=this.rows[c].id,d++),c++;return b},setRowData:function(a,b,c){var d,e,f=this,g=!0;if(!this.grid)return!1;var h,i,j=this,k=typeof c,l={};if(i=j.rows.namedItem(a),!i)return!1;if(b)try{if($(this.options.colModel).each(function(c){d=this.name,void 0!==b[d]&&(l[d]=this.formatter&&"string"==typeof this.formatter&&"date"==this.formatter?$.unformat.date.call(j,b[d],this):b[d],h=j._formatter(a,b[d],c,b,"edit"),e=this.title?{title:$.grid.stripHtml(h)}:{},j.options.treeGrid===!0&&d==j.options.expandColumn?$("td:eq("+c+") > span:first",i).html(h).attr(e):$("td:eq("+c+")",i).html(h).attr(e),$.fn.afterFmatter.call(f))}),"local"==j.options.datatype){var m=$.grid.stripPref(j.options.idPrefix,a),n=j.options._index[m];if(j.options.treeGrid)for(var o in j.options.treeReader)l.hasOwnProperty(j.options.treeReader[o])&&delete l[j.options.treeReader[o]];"undefined"!=typeof n&&(j.options.data[n]=$.extend(!0,j.options.data[n],l)),l=null}}catch(p){g=!1}return g&&("string"===k?$(i).addClass(c):"object"===k&&$(i).css(c),j._trigger("aftercomplete")),g},delRowData:function(a){var b,c,d,e=!1,f=this,g=!("card"!=f.options.model);if(!g){if(b=f.rows.namedItem(a),!b)return!1;d=b.rowIndex,$(b).remove(),f.options.records--,f.options.reccount--,f._updatepager(!0,!1),e=!0,f.options.multiselect&&(c=$.inArray(a,f.options.selarrrow),-1!=c&&f.options.selarrrow.splice(c,1)),a==f.options.selrow&&(f.options.selrow=null),a==f.options.editrow&&(f.options.editrow=null,f.rowEditButtons&&f.rowEditButtons.remove());var h=$.each(f.options.savedRow,function(a,b){return b.id==d?(c=a,!0):void 0});if(h.length&&-1!=c&&f.options.savedRow.splice(c,1),"local"==f.options.datatype){var i=$.grid.stripPref(f.options.idPrefix,a),j=f.options._index[i];"undefined"!=typeof j&&(f.options.data.splice(j,1),f.refreshIndex())}if(f.options.altRows===!0&&e){var k=f.options.altclass;$(f.rows).each(function(a){a%2==1?$(this).addClass(k):$(this).removeClass(k)})}return f.getDataIDs().length||f._cancelCheckAll(),this.options.frozenColumns&&this._setFrozenHeight(),e}if(b=f.pic.children("#"+a)[0],!b)return!1;if($(b).remove(),f.options.records--,f.options.reccount--,f._updatepager(!0,!1),e=!0,f.options.multiselect&&(c=$.inArray(a,f.options.selarrrow),-1!=c&&f.options.selarrrow.splice(c,1)),a==f.options.selrow&&(f.options.selrow=null),"local"==f.options.datatype){var i=$.grid.stripPref(f.options.idPrefix,a),j=f.options._index[i];"undefined"!=typeof j&&(f.options.data.splice(j,1),f.refreshIndex())}},_cancelCheckAll:function(){var a=this;a.options.multiselect&&$("#cb_"+$.grid.coralID(a.options.id),a.grid.columnsView)[a.options.useProp?"prop":"attr"]("checked",!1)},resetSelection:function(a){var b,c,d,e=this;e.options.frozenColumns===!0&&(d=e.options.id+"_frozen"),"undefined"!=typeof a?(c=a===e.options.selrow?e.options.selrow:a,$("#"+$.grid.coralID(e.options.id)+" tbody:first tr#"+$.grid.coralID(c)).removeClass("coral-state-highlight").attr("aria-selected","false"),d&&$("#"+$.grid.coralID(c),"#"+$.grid.coralID(d)).removeClass("coral-state-highlight"),e.options.multiselect&&($("#jqg_"+$.grid.coralID(e.options.id)+"_"+$.grid.coralID(c),"#"+$.grid.coralID(e.options.id))[e.options.useProp?"prop":"attr"]("checked",!1),d&&$("#jqg_"+$.grid.coralID(e.options.id)+"_"+$.grid.coralID(c),"#"+$.grid.coralID(d))[e.options.useProp?"prop":"attr"]("checked",!1),e._setHeadCheckBox(!1)),c=null):e.options.multiselect?($(e.options.selarrrow).each(function(a,c){b=e.rows.namedItem(c),$(b).removeClass("coral-state-highlight").attr("aria-selected","false"),$("#jqg_"+$.grid.coralID(e.options.id)+"_"+$.grid.coralID(c))[e.options.useProp?"prop":"attr"]("checked",!1),d&&($("#"+$.grid.coralID(c),"#"+$.grid.coralID(d)).removeClass("coral-state-highlight"),$("#jqg_"+$.grid.coralID(e.options.id)+"_"+$.grid.coralID(c),"#"+$.grid.coralID(d))[e.options.useProp?"prop":"attr"]("checked",!1))}),e._setHeadCheckBox(!1),e.options.selarrrow=[]):e.options.selrow&&($("#"+$.grid.coralID(e.options.id)+" tbody:first tr#"+$.grid.coralID(e.options.selrow)).removeClass("coral-state-highlight").attr("aria-selected","false"),d&&$("#"+$.grid.coralID(e.options.selrow),"#"+$.grid.coralID(d)).removeClass("coral-state-highlight"),e.options.selrow=null),e.options.cellEdit===!0&&parseInt(e.options.iCol,10)>=0&&parseInt(e.options.iRow,10)>=0&&($("td:eq("+e.options.iCol+")",e.rows[e.options.iRow]).removeClass("edit-cell coral-state-highlight"),$(e.rows[e.options.iRow]).removeClass("selected-row coral-state-hover")),e.options.savedRow=[]},getRowData:function(a){var b,c,d,e,f={},g=!1,h=0,i=this,j=!("card"!=i.options.model);if(j){if("undefined"==typeof a)g=!0,b=[],c=i.pic.children("li").length;else{if(e=i.pic.children("#"+a)[0],!e)return f;c=2}for(var k="_id_";c>h;){if(g&&(e=i.pic.children("li")[h]),$(e).hasClass("gridPanel")){for(var l=0;l<i.options.data.length;l++)i.options.data[l][k]==e.id&&(f=i.options.data[l]);g&&(b.push(f),f={})}h++}}else{if("undefined"==typeof a)g=!0,b=[],c=i.rows.length;else{if(e=i.rows.namedItem(a),!e)return f;c=2}for(;c>h;)g&&(e=i.rows[h]),$(e).hasClass("jqgrow")&&($('td[role="gridcell"]',e).each(function(a){if(d=i.options.colModel[a].name,"cb"!==d&&"subgrid"!==d&&"rn"!==d)if(i.options.treeGrid===!0&&d==i.options.expandColumn)f[d]=$.grid.htmlDecode($("span:first",this).html());else try{1==i.options.enableHighlight?f[d]=$.unformat.call(i,this,{rowId:e.id,colModel:i.options.colModel[a]},a,!0):f[d]=$.unformat.call(i,this,{rowId:e.id,colModel:i.options.colModel[a]},a,"get")}catch(b){f[d]=$.grid.htmlDecode($(this).html())}}),g&&(b.push(f),f={})),h++}return b?b:f},addRowData:function(a,b,c,d){c||(c="last");var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=!1,v="";if(b){$.isArray(b)?(o=!0,p=a):(b=[b],o=!1);var w=this,x=b.length,y=!("card"!=w.options.model);k=w.options.rownumbers===!0?1:0,i=w.options.multiselect===!0?1:w.options.singleselect===!0?1:0,j=w.options.subGrid===!0?1:0,o||("undefined"!=typeof a?a+="":(a=$.grid.randId(),w.options.keyName!==!1&&(p=w.options.keyName,"undefined"!=typeof b[0][p]&&(a=b[0][p]+"")))),q=w.options.altclass;for(var z=0,A="",B={},C=!!$.isFunction(w.options.afterInsertRow);x>z;){if(r=b[z],f=[],h=[],g=[],o){try{a=r[p]+""}catch(D){a=$.grid.randId()}A=w.options.altRows===!0&&(w.rows.length-1)%2===0?q:""}for(A+=" new-row ",t=a,a=w.options.idPrefix+a,k&&(v=w._formatCol(0,1,"",null,a,!0),f[f.length]='<td role="gridcell" aria-describedby="'+w.options.id+'_rn" class="coral-state-default grid-rownum" '+v+">0</td>"),i&&(n=this.options.singleselect?'<input role="radio" type="radio" id="jqg_'+w.options.id+"_"+a+'" name="jqg_'+w.options.id+'" class="cbox"/>':'<input role="checkbox" type="checkbox" id="jqg_'+w.options.id+"_"+a+'" name="jqg_'+w.options.id+"_"+a+'" class="cbox"/>',v=w._formatCol(k,1,"",null,a,!0),f[f.length]='<td role="gridcell" aria-describedby="'+w.options.id+'_cb" '+v+">"+n+"</td>",h.push(n)),j&&(f[f.length]=$(w).grid("addSubGridCell",i+k,1)),m=i+j+k;m<w.options.colModel.length;m++)s=w.options.colModel[m],e=s.name,B[e]=r[e],n=w._formatter(a,$.grid.getAccessor(r,e),m,r),v=w._formatCol(m,1,n,r,a,!0),f[f.length]='<td role="gridcell" aria-describedby="'+w.options.id+"_"+e+'" '+v+">"+n+"</td>";if(y?(g.unshift(w.constructPanel(a,!1,A,B,B)),g.push(w._customPanel(B,k,h)),g.push("</li>")):(f.unshift(w.constructTr(a,!1,A,B,B,!1)),f[f.length]="</tr>"),y)$("#"+$.grid.coralID(w.options.id)+" .coral-pic").append(g.join(""));else if(0===w.rows.length)$("table:first",w.grid.rowsView).append(f.join(""));else switch(c){case"last":$(w.rows[w.rows.length-1]).after(f.join("")),l=w.rows.length-1;break;case"first":$(w.rows[0]).after(f.join("")),l=1;break;case"after":l=w.rows.namedItem(d),l&&($(w.rows[l.rowIndex+1]).hasClass("coral-subgrid")?$(w.rows[l.rowIndex+1]).after(f):$(l).after(f.join(""))),l++;break;case"before":l=w.rows.namedItem(d),l&&($(l).before(f.join("")),l=l.rowIndex),l--}w.options.subGrid===!0&&$(w).grid("addSubGrid",i+k,l),w.options.records++,w.options.reccount++,w._trigger("afterInsertRow",null,[{rowId:a,data:r}]),C&&w.options.afterInsertRow.call(w,a,r,r),z++,"local"==w.options.datatype&&(B[w.options.localReader.id]=t,w.options._index[t]=w.options.data.length,w.options.data.push(B),B={})}w.options.altRows!==!0||o||("last"==c?(w.rows.length-1)%2==1&&$(w.rows[w.rows.length-1]).addClass(q):$(w.rows).each(function(a){a%2==1?$(this).addClass(q):$(this).removeClass(q)})),w._updatepager(!0,!0),u=!0,$("#noRecordsTips_"+$.grid.coralID(w.options.id)).hide(),$.fn.afterFmatter.call(w)}return this.options.frozenColumns&&this._setFrozenHeight(),u},footerData:function(a,b){function c(a){var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0}var d,e,f="set",g=!1,h={};void 0==a&&(f="get"),"boolean"!=typeof b&&(b=!0),f=f.toLowerCase();var i,j=this;return j.grid&&j.options.footerrow?"set"===f&&c(a)?!1:(g=!0,$(this.options.colModel).each(function(c){d=this.name,"set"===f?void 0!==a[d]&&(i=b?j._formatter("",a[d],c,a,"edit"):a[d],e=this.title?{title:$.grid.stripHtml(i)}:{},$("tr.footrow td:eq("+c+")",j.grid.sDiv).html(i).attr(e),g=!0):"get"===f&&(h[d]=$("tr.footrow td:eq("+c+")",j.grid.sDiv).html())}),$.fn.afterFmatter.call(j),"get"===f?h:g):!1},clearGridData:function(a){var b=this,c=!("card"!=b.options.model);if(b.grid){if("boolean"!=typeof a&&(a=!1),c)$("#"+$.grid.coralID(b.options.id)+" .coral-pic").empty();else if(b.options.deepempty)$("#"+$.grid.coralID(b.options.id)+" tbody:first tr:gt(0)").remove();else{var d=$(" tbody:first tr:first",b.element)[0];$(" tbody:first",b.element).empty().append(d)}b.options.footerrow&&a&&$(".coral-grid-ftable td",b.grid.sDiv).html("&#160;"),b.options.selrow=null,b.options.selarrrow=[],b.options.savedRow=[],b.options.records=0,b.options.page=1,b.options.lastpage=0,b.options.reccount=0,b.options.data=[],b.options._index={},b._updatepager(!0,!1),b._cancelCheckAll()}},sortableRows:function(){var a={};a.sortableRowsOptions&&$.extend(a,a.sortableRowsOptions);var b=this;b.grid&&(b.options.treeGrid||$.fn.sortable&&(a=$.extend({cursor:"move",axis:"y",items:".jqgrow"},a||{}),a.change=function(a,c){c.prevItemId=$(c.placeholder[0]).prev("tr").attr("id"),c.nextItemId=$(c.placeholder[0]).next("tr").attr("id"),c.targetId=c.position.top>c.originalPosition.top?c.prevItemId:c.nextItemId,$("#"+b.id+" #"+c.targetId).siblings().removeClass("coral-state-target"),$("#"+b.id+" #"+c.targetId).addClass("coral-state-target"),b._trigger("onSortableRows",a,[c])},a.start=function(a,c){if($(c.item).css("border-width","0px"),c.originalPermutation=[],c.item.is("tr")?$("td",c.item).each(function(a){this.style.width=b.grid.cols[a].style.width}):$("td",c.item.find("tr:first")).each(function(a){this.style.width=b.grid.cols[a].style.width}),b.options.subGrid){var d=$(c.item).attr("id");try{$(b).grid("collapseSubGridRow",d)}catch(a){}}$("tr.jqgrow",b.element.find(".coral-grid-btable")).each(function(){""!==this.id&&c.originalPermutation.push(this.id)}),b.sortableRowOriginalPermutation=c.originalPermutation,b._trigger("beforeSortableRows",a,[c])},a.update=function(a,c){$(c.item).css("border-width",""),c.itemId=[],c.permutation=[],c.originalPermutation=b.sortableRowOriginalPermutation||[],b.options.rownumbers===!0?$("td.grid-rownum",b.rows).each(function(a){$(this).html(a+1+(parseInt(b.options.page,10)-1)*parseInt(b.options.rowNum,10)),c.permutation.push(b.rows[a+1].id)}):$("tr.jqgrow",b.grid.rowsView).each(function(a){c.permutation.push(this.id)}),$.each(c.item,function(a){c.itemId.push(c.item[a].id)}),c.prevItemId=$(c.item[0]).prev("tr").attr("id"),c.nextItemId=$(c.item[0]).next("tr").attr("id"),c.targetId=c.position.top>c.originalPosition.top?c.prevItemId:c.nextItemId;var d=$.data(b.element[0],"dns-ref");if(d){var e=$.data(d,"dns");if(e.dragToSort){c.item.remove(),e.dragToSort=!1;var f=0;if(c.targetId){for(;f<e.dataItems.length;f++)$(d).grid("delRowData",e.dataItems[f].id);b.element.grid("addRowData",e.rowid,e.dataItems,"after",c.targetId)}}}$("#"+b.id+" #"+c.targetId).removeClass("coral-state-target"),b._trigger("afterSortableRows",a,[c])},$("tbody:first",b.grid.rowsView).sortable(a)))},destroySortableRows:function(a){var b=this;b.grid&&$.fn.sortable&&$("tbody:first",b.grid.rowsView).sortable("destroy")},sortableGrid:function(a){var b,c,d,e,f,g,h,i=this;$("tbody:first",i.element).sortable({appendTo:"body",connectWith:a.connectWith,helper:function(a,c){b=$(a.target).parent("tr")[0].id;var d=$("<div></div>");d.append($(a.target).parent("tr").clone());var e=$("#"+b).closest(".ctrl-init-grid ")[0].id;return h=$("#"+e).grid("getCol","id"),d},start:function(a,c){b=c.item[0].id,e=$(c.placeholder[0]).prev("tr").attr("id"),nextItemId=$(c.placeholder[0]).next("tr").attr("id"),f=this.closest(".ctrl-init-grid ").id,grid1=$("#"+e).closest(".ctrl-init-grid ")[0].id,d=$("#"+f).grid("getRowData",b),e==b&&(e=$("#"+e).prev("tr").attr("id")),e?prevItem=$("#"+f).grid("getRowData",e):(e=null,prevItem=null),nextItemId?nextItem=$("#"+f).grid("getRowData",nextItemId):(nextItemId=null,nextItem=null),i._trigger("onSortableStart",a,{originalPermutation:h})},stop:function(a,c){b=c.item[0].id;var d,e=$("#"+b).prev("tr").attr("id"),f=$("#"+b).next("tr").attr("id");if(e?(d=$("#"+e).closest(".ctrl-init-grid ")[0].id,prevItem=$("#"+d).grid("getRowData",e)):(e=null,prevItem=null),f?(d=$("#"+f).closest(".ctrl-init-grid ")[0].id,nextItem=$("#"+d).grid("getRowData",f)):(f=null,nextItem=null),d==grid1){var g=$("#"+d).grid("getCol","id");i._trigger("onSortableStop",a,{datafrom:grid1,currentGrid:d,itemId:b,prevItemId:e,nextItemId:f,originalPermutation:h,permutation:g,prevItem:prevItem,nextItem:nextItem})}},activate:function(a,c){b=c.item[0].id,f=this.closest(".ctrl-init-grid ").id,g=$("#"+f).grid("getCol","id")},remove:function(a,c){f=this.closest(".ctrl-init-grid ").id,$("#"+f+" tbody:first").append(c.item.clone()),$("#"+grid1).grid("delRowData",b);var g=$("#"+f).grid("getCol","id");e?prevItem=$("#"+grid1).grid("getRowData",e):(e=null,prevItem=null),nextItemId?nextItem=$("#"+grid1).grid("getRowData",nextItemId):(nextItemId=null,nextItem=null),i._trigger("onSortableRemove",a,{datafrom:grid1,deleteData:d,itemId:b,originalPrevItemId:e,originalNextItemId:nextItemId,originalPermutation:h,permutation:g,originalPrevItem:prevItem,originalNextItem:nextItem})},receive:function(a,d){b=d.item[0].id,f=this.closest(".ctrl-init-grid ").id,c=$("#"+f).grid("getRowData",b),$("#"+f).grid("addRowData",b,c,"first"),$("#"+b).remove();var e=$("#"+f).grid("getCol","id"),h=$("#"+b).prev("tr").attr("id"),j=$("#"+b).next("tr").attr("id");h?prevItem=$("#"+f).grid("getRowData",h):(h=null,prevItem=null),j?nextItem=$("#"+f).grid("getRowData",j):(j=null,nextItem=null),i._trigger("onSortableReceive",a,{datafrom:grid1,currentGrid:f,itemId:b,item:c,prevItemId:h,nextItemId:j,originalPermutation:g,permutation:e,prevItem:prevItem,nextItem:nextItem})}})},gridDnS:function(a){var b=this;if(b.grid&&!b.options.treeGrid&&$.fn.draggable&&$.fn.droppable){var c="<table id='grid_dns' class='coral-grid-dns'></table>";if(void 0===$("#grid_dns")[0]&&$("body").append(c),a.connectWith){a.connectWith=a.connectWith.split(","),a.connectWith=$.map(a.connectWith,function(a){return $.trim(a)});var d=a.connectWith.join(" .coral-grid-btable>tbody, ")+" .coral-grid-btable>tbody";if(a=$.extend({onstart:null,onstop:null,beforedrop:null,ondrop:null,dragcopy:!1,dropbyname:!1,droppos:"first",autoid:!0,rowid:"id",dataItems:[],autoidprefix:"dns_"},a||{}),$.data(b.element[0],"dns",a),"0"!=b.options.reccount&&!b.options.jqgdns){$.data(b.element,"dns");$("tr.jqgrow:not(.coral-sortable)",b.element).draggable({revert:"invalid",helper:function(a,c){var d=$(a.target).parent("tr")[0].id,e=0,f=$("<div></div>"),g=b.element.grid("option","selarrrow").concat();if($.data(b.element[0],"dns").dataItems=[],$.inArray(d,g)>-1){for(e;e<g.length;e++)$.data(b.element[0],"dns").dataItems.push($(b.element).grid("getRowData",g[e])),f.append($(".coral-grid-btable>tbody #"+g[e],b.element).clone());return f}return $.data(b.element[0],"dns").dataItems.push(b.element.grid("getRowData",d)),f.append($(a.target).parent("tr").clone()),f},connectToSortable:d,cursor:"move",appendTo:"#grid_dns",zIndex:5e3,start:function(c,d){if(b.options.subGrid){var e=$(d.helper).attr("id");try{$(b.element).grid("collapseSubGridRow",e)}catch(f){}}$.data(b.element[0],"dns").dragToSort=!0;for(var g=0;g<$.data(b.element[0],"dns").connectWith.length;g++)"0"==$($.data(b.element[0],"dns").connectWith[g]).grid("option","reccount")&&$($.data(b.element[0],"dns").connectWith[g]).grid("addRowData","jqg_empty_row",{});d.helper.addClass("coral-state-highlight"),$("td",d.helper.find("tr:first")).each(function(a){this.style.width=b.grid.headers[a].width+"px"}),a.onstart&&$.isFunction(a.onstart)&&a.onstart.call($($t),c,d)},stop:function(c,d){if(d.helper.dropped&&!a.dragcopy){var e=$(d.helper).attr("id");void 0===e&&(e=$(this).attr("id")),$(b.element).grid("delRowData",e)}for(var f=0;f<$.data(b.element[0],"dns").connectWith.length;f++)$($.data(b.element[0],"dns").connectWith[f]).grid("delRowData","jqg_empty_row");a.onstop&&$.isFunction(a.onstop)&&a.onstop.call($($t),c,d)}})}b.options.jqgdns=!0;for(var e=0;e<a.connectWith.length;e++){var f=a.connectWith[e];$.data($(f)[0],"dns-ref",b.element[0])}}}},gridDnD:function(a){function b(){var a=$.data(c.element,"dnd");$("tr.jqgrow:not(.coral-draggable)",c.element).draggable($.isFunction(a.drag)?a.drag.call($(c.element),a):a.drag)}var c=this;if(c.grid&&!c.options.treeGrid&&$.fn.draggable&&$.fn.droppable){var d="<table id='jqgrid_dnd' class='coral-grid-dnd'></table>";if(void 0===$("#jqgrid_dnd")[0]&&$("body").append(d),"string"==typeof a&&"updateDnD"==a&&c.options.jqgdnd===!0)return void b();if(a.connectWith){a.connectWith=a.connectWith.split(","),a.connectWith=$.map(a.connectWith,function(a){return $.trim(a)});var e=a.connectWith.join(" .coral-grid-btable>tbody, ")+" .coral-grid-btable>tbody";a=$.extend({drag:function(a){return $.extend({start:function(b,d){if(c.options.subGrid){var e=$(d.helper).attr("id");try{$(c.element).grid("collapseSubGridRow",e)}catch(f){}}for(var g=0;g<$.data(c.element,"dnd").connectWith.length;g++)"0"==$($.data(c.element,"dnd").connectWith[g]).grid("option","reccount")&&$($.data(c.element,"dnd").connectWith[g]).grid("addRowData","jqg_empty_row",{});d.helper.addClass("coral-state-highlight"),$("td",d.helper).each(function(a){this.style.width=c.grid.headers[a].width+"px"}),a.onstart&&$.isFunction(a.onstart)&&a.onstart.call($($t),b,d)},stop:function(b,d){if(d.helper.dropped&&!a.dragcopy){var e=$(d.helper).attr("id");void 0===e&&(e=$(this).attr("id")),$(c.element).grid("delRowData",e)}for(var f=0;f<$.data(c.element,"dnd").connectWith.length;f++)$($.data(c.element,"dnd").connectWith[f]).grid("delRowData","jqg_empty_row");a.onstop&&$.isFunction(a.onstop)&&a.onstop.call($($t),b,d)}},a.drag_opts||{})},drop:function(a){return $.extend({accept:function(a){if(!$(a).hasClass("jqgrow"))return a;var b=$(a).closest("table.coral-grid-btable");if(b.length>0&&void 0!==$.data(c.element,"dnd")){var d=$.data(c.element,"dnd").connectWith;return-1!=$.inArray("#"+$.grid.coralID(this.id),d)}return!1},drop:function(b,d){if($(d.draggable).hasClass("jqgrow")){var e=$(d.draggable).attr("id"),f=d.draggable.parents(".coral-grid").grid("getRowData",e);if(!a.dropbyname){var g,h=0,i={},j=$("#"+$.grid.coralID(this.id)).grid("option","colModel");try{for(var k in f)f.hasOwnProperty(k)&&(g=j[h].name,"cb"!=g&&"rn"!=g&&"subgrid"!=g?f.hasOwnProperty(k)&&j[h]&&(i[g]=f[k]):h++,h++);f=i}catch(l){}}if(d.helper.dropped=!0,a.beforedrop&&$.isFunction(a.beforedrop)){var m=a.beforedrop.call(this,b,d,f,$("#"+$.grid.coralID(c.options.id)),$(this));"undefined"!=typeof m&&null!==m&&"object"==typeof m&&(f=m)}if(d.helper.dropped){var n;a.autoid&&($.isFunction(a.autoid)?n=a.autoid.call(this,f):(n=Math.ceil(1e3*Math.random()),n=a.autoidprefix+n)),$("#"+$.grid.coralID(this.id)).grid("addRowData",n,f,a.droppos)}a.ondrop&&$.isFunction(a.ondrop)&&a.ondrop.call(this,b,d,f)}}},a.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{activeClass:"coral-state-active",hoverClass:"coral-state-hover"},drag_opts:{revert:"invalid",helper:"clone",connectToSortable:e,cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dragcopy:!1,dropbyname:!1,droppos:"first",autoid:!0,autoidprefix:"dnd_"},a||{}),$.data(c.element,"dnd",a),"0"==c.options.reccount||c.options.jqgdnd||b(),c.options.jqgdnd=!0;for(var f=0;f<a.connectWith.length;f++){var g=a.connectWith[f];$(g).droppable($.isFunction(a.drop)?a.drop.call($(c),a):a.drop)}}}},getInd:function(a,b){var c,d=!1;return c=this.rows.namedItem(a),c&&(d=b===!0?c:c.rowIndex),d}});$.extend($.grid,{htmlDecode:function(a){return a&&("&nbsp;"==a||"&#160;"==a||1===a.length&&160===a.charCodeAt(0))?"":a?String(a).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/\'/g,"&acute;"):a},htmlEncode:function(a){return a?String(a).replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&acute;"):a},format:function(a){var b=$.makeArray(arguments).slice(1);return void 0===a&&(a=""),a.replace(/\{(\d+)\}/g,function(a,c){return b[c]})},getCellIndex:function(a){var b=$(a);return b.is("tr")?-1:(b=(b.is("td")||b.is("th")?b:b.closest("td,th"))[0],b.cellIndex)},stripHtml:function(a){a+="";var b=/<("[^"]*"|'[^']*'|[^'">])*>/gi;return a?(a=a.replace(b,""),a&&"&nbsp;"!==a&&"&#160;"!==a?a.replace(/\"/g,"'"):""):a},stripPref:function(a,b){var c=$.type(a);return"string"!=c&&"number"!=c||(a=String(a),b=""!==a?String(b).replace(String(a),""):b),b},stringToDoc:function(a){var b;if("string"!=typeof a)return a;try{var c=new DOMParser;b=c.parseFromString(a,"text/xml")}catch(d){b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a)}return b&&b.documentElement&&"parsererror"!=b.documentElement.tagName?b:null},parse:function(jsonString){var js=jsonString;return"while(1);"==js.substr(0,9)&&(js=js.substr(9)),"/*"==js.substr(0,2)&&(js=js.substr(2,js.length-4)),js||(js="{}"),$.grid.useJSON===!0&&"object"==typeof JSON&&"function"==typeof JSON.parse?JSON.parse(js):eval("("+js+")")},parseDate:function(a,b){var c,d,e,f={m:1,d:1,y:1970,h:0,i:0,s:0,u:0},g=/[\\\/:_;.,\t\T\s-]/;if(b&&null!==b&&void 0!==b){b=$.trim(b),b=b.split(g),void 0!==$.grid.formatter.date.masks[a]&&(a=$.grid.formatter.date.masks[a]),a=a.split(g);var h=$.grid.formatter.date.monthNames,i=$.grid.formatter.date.AmPm,j=function(a,b){return 0===a?12===b&&(b=0):12!==b&&(b+=12),b};for(c=0,d=a.length;d>c;c++)"M"==a[c]&&(e=$.inArray(b[c],h),-1!==e&&12>e&&(b[c]=e+1,f.m=b[c])),"F"==a[c]&&(e=$.inArray(b[c],h),-1!==e&&e>11&&(b[c]=e+1-12,f.m=b[c])),"a"==a[c]&&(e=$.inArray(b[c],i),-1!==e&&2>e&&b[c]==i[e]&&(b[c]=e,f.h=j(b[c],f.h))),"A"==a[c]&&(e=$.inArray(b[c],i),-1!==e&&e>1&&b[c]==i[e]&&(b[c]=e-2,f.h=j(b[c],f.h))),void 0!==b[c]&&(f[a[c].toLowerCase()]=parseInt(b[c],10));f.m=parseInt(f.m,10)-1;var k=f.y;k>=70&&99>=k?f.y=1900+f.y:k>=0&&69>=k&&(f.y=2e3+f.y),void 0!==f.j&&(f.d=f.j),void 0!==f.n&&(f.m=parseInt(f.n,10)-1)}return new Date(f.y,f.m,f.d,f.h,f.i,f.s,f.u)},coralID:function(a){return String(a).replace(/[!"#$%&'()*+,.\/:;<=>?@\[\\\]\^`{|}~]/g,"\\$&")},guid:1,uidPref:"coralg",randId:function(a){return(a?a:$.grid.uidPref)+$.grid.guid++},getAccessor:function(a,b){var c,d,e,f=[];if("function"==typeof b)return b(a);if(c=a[b],void 0===c)try{if("string"==typeof b&&(f=b.split(".")),e=f.length)for(c=a;c&&e--;)d=f.shift(),c=c[d]}catch(g){}return c},ajaxOptions:{},from:function(source){var QueryObject=function(d,q){"string"==typeof d&&(d=$.data(d));var self=this,_data=d,_usecase=!0,_trim=!1,_query=q,_stripNum=/[\$,%]/g,_lastCommand=null,_lastField=null,_orDepth=0,_negate=!1,_queuedOperator="",_sorting=[],_useProperties=!0,_usePinyin=!0;if("object"!=typeof d||!d.push)throw"data provides is not an array";return d.length>0&&(_useProperties="object"==typeof d[0]),this._hasData=function(){return null===_data?!1:0!==_data.length},this._getStr=function(a){var b=[];return _trim&&b.push("jQuery.trim("),b.push("String("+a+")"),_trim&&b.push(")"),_usecase||b.push(".toLowerCase()"),b.join("")},this._strComp=function(a){return"string"==typeof a?".toString()":""},this._group=function(a,b){return{field:a.toString(),unique:b,items:[]}},this._toStr=function(a){return _trim&&(a=$.trim(a)),a=a.toString().replace(/\\/g,"\\\\").replace(/\"/g,'\\"'),_usecase?a:a.toLowerCase()},this._funcLoop=function(a){var b=[];return $.each(_data,function(c,d){b.push(a(d))}),b},this._append=function(a){var b;for(null===_query?_query="":_query+=""===_queuedOperator?" && ":_queuedOperator,b=0;_orDepth>b;b++)_query+="(";_negate&&(_query+="!"),_query+="("+a+")",_negate=!1,_queuedOperator="",_orDepth=0},this._setCommand=function(a,b){_lastCommand=a,_lastField=b},this._resetNegate=function(){_negate=!1},this._repeatCommand=function(a,b){return null===_lastCommand?self:null!==a&&null!==b?_lastCommand(a,b):null===_lastField?_lastCommand(a):_useProperties?_lastCommand(_lastField,a):_lastCommand(a)},this._equals=function(a,b){return 0===self._compare(a,b,1)},this._compare=function(a,b,c){var d=Object.prototype.toString;return void 0===c&&(c=1),void 0===a&&(a=null),void 0===b&&(b=null),null===a&&null===b?0:null===a&&null!==b?1:null!==a&&null===b?-1:"[object Date]"===d.call(a)&&"[object Date]"===d.call(b)?b>a?-c:a>b?c:0:(_usecase||"number"==typeof a||"number"==typeof b||(a=String(a).toLowerCase(),b=String(b).toLowerCase()),b>a?-c:a>b?c:0)},this._performSort=function(){0!==_sorting.length&&(_data=self._doSort(_data,0))},this._doSort=function(a,b){var c=_sorting[b].by,d=_sorting[b].dir,e=_sorting[b].type,f=_sorting[b].datefmt;if(b==_sorting.length-1)return self._getOrder(a,c,d,e,f);b++;for(var g=self._getGroup(a,c,d,e,f),h=[],i=0;i<g.length;i++)for(var j=self._doSort(g[i].items,b),k=0;k<j.length;k++)h.push(j[k]);return h},this._getOrder=function(a,b,c,d,e){var f,g,h,i,j=[],k=[],l="a"==c?1:-1;void 0===d&&(d="text"),i="float"==d||"number"==d||"currency"==d||"numeric"==d?function(a){var b=parseFloat(String(a).replace(_stripNum,""));return isNaN(b)?0:b}:"int"==d||"integer"==d?function(a){return a?parseFloat(String(a).replace(_stripNum,"")):0}:"date"==d||"datetime"==d?function(a){return $.grid.parseDate(e,a).getTime()}:$.isFunction(d)?d:function(a){return a||(a=""),$.trim(String(a).toUpperCase())},$.each(a,function(a,c){g=""!==b?$.grid.getAccessor(c,b):c,void 0===g&&(g=""),g=i(g,c),k.push({vSort:g,index:a})}),k.sort(function(a,b){return a=a.vSort,b=b.vSort,self._compare(a,b,l)}),h=0;for(var m=a.length;m>h;)f=k[h].index,j.push(a[f]),h++;return j},this._getGroup=function(a,b,c,d,e){var f,g=[],h=null,i=null;return $.each(self._getOrder(a,b,c,d,e),function(a,c){f=$.grid.getAccessor(c,b),void 0===f&&(f=""),self._equals(i,f)||(i=f,null!==h&&g.push(h),h=self._group(b,f)),h.items.push(c)}),null!==h&&g.push(h),g},this.ignoreCase=function(){return _usecase=!1,self},this.useCase=function(){return _usecase=!0,self},this.trim=function(){return _trim=!0,self},this.noTrim=function(){return _trim=!1,self},this.execute=function(){var match=_query,results=[];return null===match?self:($.each(_data,function(){eval(match)&&results.push(this)}),_data=results,self)},this.data=function(){return _data},this.select=function(a){if(self._performSort(),!self._hasData())return[];if(self.execute(),$.isFunction(a)){var b=[];return $.each(_data,function(c,d){b.push(a(d))}),b}return _data},this.hasMatch=function(){return self._hasData()?(self.execute(),_data.length>0):!1},this.andNot=function(a,b,c){return _negate=!_negate,self.and(a,b,c)},this.orNot=function(a,b,c){return _negate=!_negate,self.or(a,b,c)},this.not=function(a,b,c){return self.andNot(a,b,c)},this.and=function(a,b,c){return _queuedOperator=" && ",void 0===a?self:self._repeatCommand(a,b,c)},this.or=function(a,b,c){return _queuedOperator=" || ",void 0===a?self:self._repeatCommand(a,b,c)},this.orBegin=function(){return _orDepth++,self},this.orEnd=function(){return null!==_query&&(_query+=")"),self},this.isNot=function(a){return _negate=!_negate,self.is(a)},this.is=function(a){return self._append("this."+a),self._resetNegate(),self},this._compareValues=function(a,b,c,d,e){var f;f=_useProperties?"jQuery.grid.getAccessor(this,'"+b+"')":"this",void 0===c&&(c=null);var g=c,h=void 0===e.stype?"text":e.stype;if(null!==c)switch(h){case"int":case"integer":g=isNaN(Number(g))||""===g?"0":g,f="parseInt("+f+",10)",g="parseInt("+g+",10)";break;case"float":case"number":case"numeric":g=String(g).replace(_stripNum,""),g=isNaN(Number(g))||""===g?"0":g,f="parseFloat("+f+")",g="parseFloat("+g+")";break;case"date":case"datetime":g=String($.grid.parseDate(e.newfmt||"Y-m-d",g).getTime()),f='jQuery.grid.parseDate("'+e.srcfmt+'",'+f+").getTime()";break;default:f=self._getStr(f),g=self._getStr('"'+self._toStr(g)+'"')}return self._append(f+" "+d+" "+g),self._setCommand(a,b),self._resetNegate(),self},this.equals=function(a,b,c){return self._compareValues(self.equals,a,b,"==",c)},this.notEquals=function(a,b,c){return self._compareValues(self.equals,a,b,"!==",c)},this.isNull=function(a,b,c){return self._compareValues(self.equals,a,null,"===",c)},this.greater=function(a,b,c){return self._compareValues(self.greater,a,b,">",c)},this.less=function(a,b,c){return self._compareValues(self.less,a,b,"<",c)},this.greaterOrEquals=function(a,b,c){return self._compareValues(self.greaterOrEquals,a,b,">=",c)},this.lessOrEquals=function(a,b,c){return self._compareValues(self.lessOrEquals,a,b,"<=",c)},this.startsWith=function(a,b){var c=void 0===b||null===b?a:b,d=_trim?$.trim(c.toString()).length:c.toString().length;return _useProperties?self._append(self._getStr("jQuery.grid.getAccessor(this,'"+a+"')")+".substr(0,"+d+") == "+self._getStr('"'+self._toStr(b)+'"')):(d=_trim?$.trim(b.toString()).length:b.toString().length,self._append(self._getStr("this")+".substr(0,"+d+") == "+self._getStr('"'+self._toStr(a)+'"'))),self._setCommand(self.startsWith,a),self._resetNegate(),self},this.endsWith=function(a,b){var c=void 0===b||null===b?a:b,d=_trim?$.trim(c.toString()).length:c.toString().length;return _useProperties?self._append(self._getStr("jQuery.grid.getAccessor(this,'"+a+"')")+".substr("+self._getStr("jQuery.grid.getAccessor(this,'"+a+"')")+".length-"+d+","+d+') == "'+self._toStr(b)+'"'):self._append(self._getStr("this")+".substr("+self._getStr("this")+'.length-"'+self._toStr(a)+'".length,"'+self._toStr(a)+'".length) == "'+self._toStr(a)+'"'),self._setCommand(self.endsWith,a),self._resetNegate(),self},this.contains=function(a,b){return _useProperties?_usePinyin?self._append(self._getStr("jQuery.grid.getAccessor(this,'"+a+"')")+'.indexOf("'+self._toStr(b)+'",0) > -1 || '+self._getStr("pinyinEngine.toPinyin(jQuery.grid.getAccessor(this,'"+a+'\'), false, "")')+'.indexOf("'+self._toStr(b)+'",0) > -1'):self._append(self._getStr("jQuery.grid.getAccessor(this,'"+a+"')")+'.indexOf("'+self._toStr(b)+'",0) > -1'):_usePinyin?self._append(self._getStr("this")+'.indexOf("'+self._toStr(a)+'",0) > -1 || '+pinyinEngine.toPinyin(self._getStr("this"),!1,"")+'.indexOf("'+self._toStr(b)+'",0) > -1'):self._append(self._getStr("this")+'.indexOf("'+self._toStr(a)+'",0) > -1'),
self._setCommand(self.contains,a),self._resetNegate(),self},this.groupBy=function(a,b,c,d){return self._hasData()?self._getGroup(_data,a,b,c,d):null},this.orderBy=function(a,b,c,d){return b=void 0===b||null===b?"a":$.trim(b.toString().toLowerCase()),null!==c&&void 0!==c||(c="text"),null!==d&&void 0!==d||(d="Y-m-d"),"desc"!=b&&"descending"!=b||(b="d"),"asc"!=b&&"ascending"!=b||(b="a"),_sorting.push({by:a,dir:b,type:c,datefmt:d}),self},self};return new QueryObject(source,null)},getMethod:function(a){return this.getAccessor($.fn.grid,a)},extend:function(a){$.extend($.fn.grid,a),this.no_legacy_api||$.fn.extend(a)}}),grid=$.component("coral.grid",$.coral.grid,{_isArray:function(a){return"[object Array]"===Object.prototype.toString.apply(a)},transformToArrayFormat:function(a){var b="children",c=[];if(this._isArray(a))for(var d=0,e=a.length;e>d;d++)c.push(a[d]),a[d][b]&&(c=c.concat(this.transformToArrayFormat(a[d][b])));else c.push(a),a[b]&&(c=c.concat(this.transformToArrayFormat(a[b])));return c},transformToTreeFormat:function(a){var b,c,d="id",e=this.options.treeReader.parent_id_field,f="children";if(this._isArray(a)){var g=[],h=[];for(b=0,c=a.length;c>b;b++)a[b][this.options.treeReader.loaded]=!0,h[a[b][d]]=a[b];for(b=0,c=a.length;c>b;b++)h[a[b][e]]&&a[b][d]!=a[b][e]?(h[a[b][e]][f]||(h[a[b][e]][f]=[]),h[a[b][e]][f].push(a[b])):g.push(a[b]);return g}return[a]},setSonNodeLevel:function(a,b){var c=this;if(a.children)for(var d=a.children.length,e=0;d>e;e++){var f=b+1;a.children[e].level=f,c.setSonNodeLevel(a.children[e],f)}},getNodeLevel:function(a,b){for(var c=this,d=0;d<a.length;d++)a[d].level=b,c.setSonNodeLevel(a[d],b);return a},recurrenceNode:function(a){var b=this,c=b.getNodeLevel(a,0);return c},setTreeNode:function(a,b){var c=this;if(c.grid&&c.options.treeGrid)for(var d,e,f,g,h,i,j,k,l=c.options.expColInd,m=c.options.treeReader.expanded_field,n=c.options.treeReader.leaf_field,o=c.options.treeReader.level_field,p=c.options.treeReader.icon_field,q=c.options.treeReader.loaded;b>a;){var r,s=c.rows[a].id,t=c.options._index[s];if(j=c.options.data[t],"nested"==c.options.treeGridModel&&(j[n]||(d=parseInt(j[c.options.treeReader.left_field],10),e=parseInt(j[c.options.treeReader.right_field],10),j[n]=e===d+1?"true":"false",c.rows[a].cells[c.options._treeleafpos].innerHTML=j[n])),f=parseInt(j[o],10),0===c.options.tree_root_level?(g=f+1,h=f):(g=f,h=f-1),i="<div class='tree-wrap tree-wrap-"+c.options.direction+"' style='width:"+18*g+"px;'>",i+="<div style='"+("rtl"==c.options.direction?"right:":"left:")+18*h+"px;' class=' ",void 0!==j[q]&&("true"==j[q]||j[q]===!0?j[q]=!0:j[q]=!1),"true"==j[n]||j[n]===!0?(i+=(void 0!==j[p]&&""!==j[p]?j[p]:c.options.treeIcons.leaf)+" tree-leaf treeclick",j[n]=!0,k="leaf"):(j[n]=!1,k=""),j[m]=("true"==j[m]||j[m]===!0)&&j[q],i+=j[m]===!1?j[n]===!0?"'":c.options.treeIcons.plus+" tree-plus treeclick'":j[n]===!0?"'":c.options.treeIcons.minus+" tree-minus treeclick'",i+="></div></div>",$(c.rows[a].cells[l]).wrapInner("<span class='cell-wrapper"+k+"'></span>").prepend(i),f!==parseInt(c.options.tree_root_level,10)){var u=$(c.element).grid("getNodeParent",j);r=u&&u.hasOwnProperty(m)?u[m]:!0,r||$(c.rows[a]).css("display","none")}$(c.rows[a].cells[l]).find("div.treeclick").bind("click",function(a){var b=a.target||a.srcElement,d=$(b,c.rows).closest("tr.jqgrow")[0].id,e=c.options._index[d];return c.options.data[e][n]||(c.options.data[e][m]?($(c.element).grid("collapseRow",c.options.data[e]),$(c.element).grid("collapseNode",c.options.data[e])):($(c.element).grid("expandRow",c.options.data[e]),$(c.element).grid("expandNode",c.options.data[e]))),!1}),c.options.ExpandColClick===!0&&$(c.rows[a].cells[l]).find("span.cell-wrapper").css("cursor","pointer").bind("click",function(a){var b=a.target||a.srcElement,d=$(b,c.rows).closest("tr.jqgrow")[0].id,e=c.options._index[d];return c.options.data[e][n]||(c.options.data[e][m]?($(c.element).grid("collapseRow",c.options.data[e]),$(c.element).grid("collapseNode",c.options.data[e])):($(c.element).grid("expandRow",c.options.data[e]),$(c.element).grid("expandNode",c.options.data[e]))),$(c.element).grid("setSelection",d),!1}),a++}},setTreeGrid:function(){var a,b,c,d=this,e=0,f=!1,g=[];if(d.options.treeGrid){d.options.treedatatype||$.extend(d.options,{treedatatype:d.options.datatype}),d.options.subGrid=!1,d.options.altRows=!1,d.options.gridview=!0,null===d.options.rowTotal&&(d.options.rowNum=1e4),d.options.multiselect=!1,d.options.rowList=[],d.options.expColInd=0,a="coral-icon-triangle-1-"+("rtl"==d.options.direction?"w":"e"),d.options.treeIcons=$.extend({plus:"cui-icon-arrow-right3",minus:"cui-icon-arrow-down3",leaf:"cui-icon-file-empty2"},d.options.treeIcons||{}),"nested"==d.options.treeGridModel?d.options.treeReader=$.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},d.options.treeReader):"adjacency"==d.options.treeGridModel&&(d.options.treeReader=$.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},d.options.treeReader));for(c in d.options.colModel)if(d.options.colModel.hasOwnProperty(c)){b=d.options.colModel[c].name,b!=d.options.expandColumn||f||(f=!0,d.options.expColInd=e),e++;for(var h in d.options.treeReader)d.options.treeReader[h]==b&&g.push(b)}$.each(d.options.treeReader,function(a,b){b&&-1===$.inArray(b,g)&&("leaf_field"===a&&(d.options._treeleafpos=e),e++,d.options.colNames.push(b),d.options.colModel.push({name:b,width:1,hidden:!0,sortable:!1,resizable:!1,hidedlg:!0,editable:!0,search:!1}))})}},expandRow:function(a){var b=this;if(b.grid&&b.options.treeGrid){var c=$(b.element).grid("getNodeChildren",a),d=b.options.treeReader.expanded_field,e=b.rows;$(c).each(function(){var a=$.grid.getAccessor(this,b.options.localReader.id);$(e.namedItem(a)).css("display",""),this[d]&&$(b.element).grid("expandRow",this)})}},collapseRow:function(a){var b=this;if(b.grid&&b.options.treeGrid){var c=$(b.element).grid("getNodeChildren",a),d=b.options.treeReader.expanded_field,e=b.rows;$(c).each(function(){var a=$.grid.getAccessor(this,b.options.localReader.id);$(e.namedItem(a)).css("display","none"),this[d]&&$(b.element).grid("collapseRow",this)})}},getRootNodes:function(){var a=[],b=this;if(b.grid&&b.options.treeGrid){switch(b.options.treeGridModel){case"nested":var c=b.options.treeReader.level_field;$(b.options.data).each(function(){parseInt(this[c],10)===parseInt(b.options.tree_root_level,10)&&a.push(this)});break;case"adjacency":var d=b.options.treeReader.parent_id_field;$(b.options.data).each(function(){null!==this[d]&&"null"!=String(this[d]).toLowerCase()||a.push(this)})}return a}},getNodeDepth:function(a){var b=null;return this.each(function(){if(this.grid&&this.options.treeGrid){var c=this;switch(that.options.treeGridModel){case"nested":var d=that.options.treeReader.level_field;b=parseInt(a[d],10)-parseInt(that.options.tree_root_level,10);break;case"adjacency":b=$(c).grid("getNodeAncestors",a).length}}}),b},getNodeParent:function(a){var b=null,c=this;if(c.grid&&c.options.treeGrid){switch(c.options.treeGridModel){case"nested":var d=c.options.treeReader.left_field,e=c.options.treeReader.right_field,f=c.options.treeReader.level_field,g=parseInt(a[d],10),h=parseInt(a[e],10),i=parseInt(a[f],10);$(c.options.data).each(function(){return parseInt(this[f],10)===i-1&&parseInt(this[d],10)<g&&parseInt(this[e],10)>h?(b=this,!1):void 0});break;case"adjacency":var j=c.options.treeReader.parent_id_field,k=c.options.localReader.id;$(c.options.data).each(function(){return this[k]==a[j]?(b=this,!1):void 0})}return b}},getNodeChildren:function(a){var b=[],c=this;if(c.grid&&c.options.treeGrid){switch(c.options.treeGridModel){case"nested":var d=c.options.treeReader.left_field,e=c.options.treeReader.right_field,f=c.options.treeReader.level_field,g=parseInt(a[d],10),h=parseInt(a[e],10),i=parseInt(a[f],10);$(this.options.data).each(function(){parseInt(this[f],10)===i+1&&parseInt(this[d],10)>g&&parseInt(this[e],10)<h&&b.push(this)});break;case"adjacency":var j=c.options.treeReader.parent_id_field,k=c.options.localReader.id;$(this.options.data).each(function(){this[j]==a[k]&&b.push(this)})}return b}},getFullTreeNode:function(a){var b=[];return this.each(function(){var c,d=this;if(d.grid&&that.options.treeGrid)switch(that.options.treeGridModel){case"nested":var e=that.options.treeReader.left_field,f=that.options.treeReader.right_field,g=that.options.treeReader.level_field,h=parseInt(a[e],10),i=parseInt(a[f],10),j=parseInt(a[g],10);$(this.options.data).each(function(){parseInt(this[g],10)>=j&&parseInt(this[e],10)>=h&&parseInt(this[e],10)<=i&&b.push(this)});break;case"adjacency":if(a){b.push(a);var k=that.options.treeReader.parent_id_field,l=that.options.localReader.id;$(this.options.data).each(function(a){for(c=b.length,a=0;c>a;a++)if(b[a][l]==this[k]){b.push(this);break}})}}}),b},getNodeAncestors:function(a){var b=[];return this.each(function(){if(this.grid&&this.options.treeGrid)for(var c=$(this).grid("getNodeParent",a);c;)b.push(c),c=$(this).grid("getNodeParent",c)}),b},isVisibleNode:function(a){var b=!0;return this.each(function(){var c=this;if(c.grid&&that.options.treeGrid){var d=$(c).grid("getNodeAncestors",a),e=that.options.treeReader.expanded_field;$(d).each(function(){return b=b&&this[e],b?void 0:!1})}}),b},isNodeLoaded:function(a){var b,c=this;if(c.grid&&c.options.treeGrid){var d=c.options.treeReader.leaf_field;return b=void 0!==a?void 0!==a.loaded?a.loaded:!!(a[d]||$(c.element).grid("getNodeChildren",a).length>0):!1}},expandNode:function(a){if(this.grid&&this.options.treeGrid){var b=this.options.treeReader.expanded_field,c=this.options.treeReader.parent_id_field,d=this.options.treeReader.loaded,e=this.options.treeReader.level_field,f=this.options.treeReader.left_field,g=this.options.treeReader.right_field;if(!a[b]){var h=$.grid.getAccessor(a,this.options.localReader.id),i=$("#"+$.grid.coralID(h),this.grid.rowsView)[0],j=this.options._index[h];$(this.element).grid("isNodeLoaded",this.options.data[j])?(a[b]=!0,$("div.treeclick",i).removeClass(this.options.treeIcons.plus+" tree-plus").addClass(this.options.treeIcons.minus+" tree-minus")):this.grid.columnsView.loading||(a[b]=!0,$("div.treeclick",i).removeClass(this.options.treeIcons.plus+" tree-plus").addClass(this.options.treeIcons.minus+" tree-minus"),this.options.treeANode=i.rowIndex,this.options.datatype=this.options.treedatatype,"nested"==this.options.treeGridModel?$(this.element).grid("option",{postData:{nodeid:h,n_left:a[f],n_right:a[g],n_level:a[e]}}):$(this.element).grid("option",{postData:{nodeid:h,parentid:a[c],n_level:a[e]}}),$(this.element).grid("reload"),a[d]=!0,"nested"==this.options.treeGridModel?$(this.element).grid("option",{postData:{nodeid:"",n_left:"",n_right:"",n_level:""}}):$(this.element).grid("option",{postData:{nodeid:"",parentid:"",n_level:""}}))}}},collapseNode:function(a){if(this.grid&&this.options.treeGrid){var b=this.options.treeReader.expanded_field;if(a[b]){a[b]=!1;var c=$.grid.getAccessor(a,this.options.localReader.id),d=$("#"+$.grid.coralID(c),this.grid.rowsView)[0];$("div.treeclick",d).removeClass(this.options.treeIcons.minus+" tree-minus").addClass(this.options.treeIcons.plus+" tree-plus")}}},sortTree:function(a,b,c,d){if(this.grid&&this.options.treeGrid){var e,f,g,h,i,j=[],k=this,l=$(k.element).grid("getRootNodes");for(h=$.grid.from(l),h.orderBy(a,b,c,d),i=h.select(),e=0,f=i.length;f>e;e++)g=i[e],j.push(g),$(k.element).grid("collectChildrenSortTree",j,g,a,b,c,d);$.each(j,function(a){var b=$.grid.getAccessor(this,k.options.localReader.id);$("#"+$.grid.coralID(k.options.id)+" tbody tr:eq("+a+")").after($("tr#"+$.grid.coralID(b),k.grid.rowsView))}),h=null,i=null,j=null}},collectChildrenSortTree:function(a,b,c,d,e,f){if(this.grid&&this.options.treeGrid){var g,h,i,j,k,l;for(j=$(this.element).grid("getNodeChildren",b),k=$.grid.from(j),k.orderBy(c,d,e,f),l=k.select(),g=0,h=l.length;h>g;g++)i=l[g],a.push(i),$(this.element).grid("collectChildrenSortTree",a,i,c,d,e,f)}},setTreeRow:function(a,b){var c=!1;return this.each(function(){var d=this;d.grid&&d.options.treeGrid&&(c=$(d).grid("setRowData",a,b))}),c},delTreeNode:function(a){return this.each(function(){var b,c,d,e,f=this,g=that.options.localReader.id,h=that.options.treeReader.left_field,i=that.options.treeReader.right_field;if(f.grid&&that.options.treeGrid){var j=that.options._index[a];if(void 0!==j){b=parseInt(that.options.data[j][i],10),c=b-parseInt(that.options.data[j][h],10)+1;var k=$(f).grid("getFullTreeNode",that.options.data[j]);if(k.length>0)for(var l=0;l<k.length;l++)$(f).grid("delRowData",k[l][g]);if("nested"===that.options.treeGridModel){if(d=$.grid.from(that.options.data).greater(h,b,{stype:"integer"}).select(),d.length)for(e in d)d.hasOwnProperty(e)&&(d[e][h]=parseInt(d[e][h],10)-c);if(d=$.grid.from(that.options.data).greater(i,b,{stype:"integer"}).select(),d.length)for(e in d)d.hasOwnProperty(e)&&(d[e][i]=parseInt(d[e][i],10)-c)}}}})},addChildNode:function(a,b,c){var d=this[0];if(c){var e,f,g,h,i,j,k,l,m=that.options.treeReader.expanded_field,n=that.options.treeReader.leaf_field,o=that.options.treeReader.level_field,p=that.options.treeReader.parent_id_field,q=that.options.treeReader.left_field,r=that.options.treeReader.right_field,s=that.options.treeReader.loaded,t=0,u=b;if("undefined"==typeof a||null===a){if(i=that.options.data.length-1,i>=0)for(;i>=0;)t=Math.max(t,parseInt(that.options.data[i][that.options.localReader.id],10)),i--;a=t+1}var v=$(d).grid("getInd",b);if(k=!1,void 0===b||null===b||""===b)b=null,u=null,e="last",h=that.options.tree_root_level,i=that.options.data.length+1;else{e="after",f=that.options._index[b],g=that.options.data[f],b=g[that.options.localReader.id],h=parseInt(g[o],10)+1;var w=$(d).grid("getFullTreeNode",g);w.length?(i=w[w.length-1][that.options.localReader.id],u=i,i=$(d).grid("getInd",u)+1):i=$(d).grid("getInd",b)+1,g[n]&&(k=!0,g[m]=!0,$(d.rows[v]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(that.options.treeIcons.leaf+" tree-leaf").addClass(that.options.treeIcons.minus+" tree-minus"),that.options.data[f][n]=!1,g[s]=!0)}if(j=i+1,c[m]=!1,c[s]=!0,c[o]=h,c[n]=!0,"adjacency"===that.options.treeGridModel&&(c[p]=b),"nested"===that.options.treeGridModel){var x,y,z;if(null!==b){if(l=parseInt(g[r],10),x=$.grid.from(that.options.data),x=x.greaterOrEquals(r,l,{stype:"integer"}),y=x.select(),y.length)for(z in y)y.hasOwnProperty(z)&&(y[z][q]=y[z][q]>l?parseInt(y[z][q],10)+2:y[z][q],y[z][r]=y[z][r]>=l?parseInt(y[z][r],10)+2:y[z][r]);c[q]=l,c[r]=l+1}else{if(l=parseInt($(d).grid("getCol",r,!1,"max"),10),y=$.grid.from(that.options.data).greater(q,l,{stype:"integer"}).select(),y.length)for(z in y)y.hasOwnProperty(z)&&(y[z][q]=parseInt(y[z][q],10)+2);if(y=$.grid.from(that.options.data).greater(r,l,{stype:"integer"}).select(),y.length)for(z in y)y.hasOwnProperty(z)&&(y[z][r]=parseInt(y[z][r],10)+2);c[q]=l+1,c[r]=l+2}}if(null===b||$(d).grid("isNodeLoaded",g)||k){if(that.options.generalLevel===!0||"true"==that.options.generalLevel){var A=that.transformToTreeFormat(c);that.options.data=that.recurrenceNode(A),that.options.data=that.transformToArrayFormat(that.options.data)}$(d).grid("addRowData",a,c,e,u),$(d).grid("setTreeNode",i,j)}g&&!g[m]&&$(d.rows[v]).find("div.treeclick").click()}},refreshDescription:function(a){this.options.toolbarOptions&&this.options.description&&$(".pager-description",this.element).html(a)},hideGridHeader:function(){this.element.find(".coral-grid-columns").hide()},showGridHeader:function(){this.element.find(".coral-grid-columns").show()},valid:function(a,b){var c,d,e,f,g,h={},i=!1,j=0,k=this;k.errorResults=[];var l;if("undefined"!=typeof a&&a){if(g=k.rows.namedItem(a),!g)return h;d=2}else i=!0,c=[],d=k.rows.length;for(;d>j;)i&&(g=k.rows[j]),$(g).hasClass("jqgrow")&&($('td[role="gridcell"]',g).each(function(a){var c;if(e=k.options.colModel[a].name,f=k.options.colModel[a].editable,(!b||b&&e==b)&&"cb"!==e&&"subgrid"!==e&&"rn"!==e){if(k.options.treeGrid===!0&&e==k.options.expandColumn)h[e]=$.grid.htmlDecode($("span:first",this).html());else try{var d=$.grep(k.options.savedRow,function(a){return a.id==g.id||k.rows[a.id].id==g.id});l=k.options.savedRow.length&&d.length&&f?"edittype":null,h[e]=$.unformat.call(k,this,{rowId:g.id,colModel:k.options.colModel[a]},a,"get",l)}catch(i){h[e]=$.grid.htmlDecode($(this).html())}var m=$.extend(k.options.colModel[a].formatoptions||{},k.options.colModel[a].editoptions||{}),n=$.Event();n.target=this;var o=$(this).find(".ctrl-form-element");if(o.length>0)for(var a=0;a<o.length;a++){var p={validoptions:m,notComponent:!1,showRequiredMark:$.noop,hasTips:!1,component:k.getCellComponent(g.id,e),element:$(o[a]),value:h[e]};c=$.validate.validateField(n,p)}else{var p={validoptions:m,notComponent:!0,showRequiredMark:$.noop,hasTips:!1,component:$(this),element:$(this),value:h[e]};c=$.validate.validateField(n,p)}c.length?(k.options.allowSaveOnError?$(this).addClass("coral-gridcell-error").attr("data-errors",c):$(this).addClass("coral-gridcell-error"),k.errorResults.push({rowId:g.id,rowIndex:j,cellIndex:a,errors:c})):$(this).removeClass("coral-gridcell-error").removeAttr("data-errors")}}),i&&(c.push(h),h={})),j++;return this.options.isValid=!(this.errorResults.length>0),this.options.isValid},clearErrors:function(a,b){var c,d,e,f={},g=!1,h=0,i=this;if(this.errorResults=this.errorResults||[],"undefined"!=typeof a&&a){if(e=i.rows.namedItem(a),!e)return f;d=2;var j=i.errorResults.length;for(j;j>0;j--)i.errorResults[j-1].rowId==e.id&&i.errorResults.splice(j-1,1)}else g=!0,c=[],d=i.rows.length,i.errorResults=[];for(;d>h;)g&&(e=i.rows[h]),$(e).hasClass("jqgrow")&&$('td[role="gridcell"]',e).each(function(a){$(this).removeClass("coral-gridcell-error coral-validate-error").removeAttr("data-errors")}),h++;this.options.isValid=!(this.errorResults.length>0)},getCellErrors:function(){return that.errorResults},resizeFrozen:function(){var a=this.options.caption?$(this.grid.cDiv).outerHeight():0,b=$(".coral-grid-htable","#"+$.grid.coralID(this.options.id)).outerHeight();if(this.options.toppager&&(a+=$($t.grid.topDiv).outerHeight()),this.options.toolbar[0]===!0&&"bottom"!=this.options.toolbar[1]&&(a+=$(this.grid.uDiv).outerHeight()),this.grid.fhDiv){var c=$("th",this.grid.columnsView).height();$(this.grid.fhDiv).css({top:a}),$("th",this.grid.fhDiv).each(function(){$(this).height(c)}),$(this.grid.fbDiv).css({top:parseInt(a,10)+parseInt(b,10)}),$(this.grid.fbDiv).height($(this.grid.rowsView).height()-this.getScrollBarWidth()+2)}if(this.grid.rightfhDiv){var c=$("th",this.grid.columnsView).height();$("th",this.grid.rightfhDiv).each(function(){$(this).height(c)}),$(this.grid.rightfhDiv).css({top:a}),$(this.grid.rightfbDiv).css({top:parseInt(a,10)+parseInt(b,10)}),$(this.grid.rightfbDiv).height($(this.grid.rowsView).height()-this.getScrollBarWidth()+2)}},setFrozenColumns:function(){if(this.grid){var a=this,b=a.options.colModel,c=0,d=b.length,e=d-1,f=-1,g=-1,h=!1;if(!(a.options.subGrid===!0||a.options.treeGrid===!0||a.options.cellEdit===!0||a.options.sortable||a.options.scroll||a.options.grouping)){for(a.options.rownumbers&&c++,(a.options.multiselect||a.options.singleselect)&&c++;d>c&&b[c].frozen===!0;)h=!0,g=c,c++;for(;e>0&&b[e].frozen===!0;)h=!0,f=e,e--;if(f>0&&(g=-1),h){var i=a.options.caption?$(a.grid.cDiv).outerHeight():0,j=$(".coral-grid-htable","#"+$.grid.coralID(a.options.id)).outerHeight();a.options.toppager&&(i+=$(a.grid.topDiv).outerHeight()),a.options.toolbar[0]===!0&&"bottom"!=a.options.toolbar[1]&&(i+=$(a.grid.uDiv).outerHeight()),g>=0&&(a.grid.fhDiv=$('<div style="position:absolute;left:0px;top:'+i+'px;" class="frozen-div-left coral-state-default coral-grid-columns coral-grid-columns-view"></div>'),a.grid.fbDiv=$('<div style="position:absolute;left:0px;top:'+(parseInt(i,10)+parseInt(j,10))+'px;overflow-y:hidden" class="frozen-bdiv coral-grid-rows coral-grid-rows-view"></div>'),$("#"+$.grid.coralID(a.options.id)).append(a.grid.fhDiv)),f>=0&&(a.grid.rightfhDiv=$('<div style="position:absolute;right:0;top:'+i+'px;" class="frozen-div-right coral-state-default coral-grid-columns coral-grid-columns-view"></div>'),a.grid.rightfbDiv=$('<div style="position:absolute;right:0;top:'+(parseInt(i,10)+parseInt(j,10))+'px;overflow-y:hidden" class="frozen-bdiv coral-grid-rows coral-grid-rows-view"></div>'),$("#"+$.grid.coralID(a.options.id)).append(a.grid.rightfhDiv));var k=$(".coral-grid-htable","#"+$.grid.coralID(a.options.id)).clone(!0),l=$(".coral-grid-htable","#"+$.grid.coralID(a.options.id)).clone(!0);if(a.rightFrozenWidth=0,a.options.groupHeader){g>=0&&$("tr.jqg-first-row-header, tr.jqg-third-row-header",k).each(function(){$("th:gt("+g+")",this).remove()}),f>=0&&$("tr.jqg-first-row-header, tr.jqg-third-row-header",l).each(function(){$("th:lt("+f+")",this).remove()});var m=-1,n=-1;$("tr.jqg-second-row-header th",k).each(function(){var a=parseInt($(this).attr("colspan"),10);return a&&(m+=a,n++),m===g?!1:void 0}),m!==g&&(n=g),$("tr.jqg-second-row-header",k).each(function(){$("th:gt("+n+")",this).remove()})}else g>=0&&$("tr",k).each(function(){$("th:gt("+g+")",this).remove()}),f>=0&&$("tr",l).each(function(){$("th:lt("+f+")",this).remove();var b=a.getScrollBarWidth()-2;$(this).append("<th style='width:"+b+"px;' class='coral-state-default'>&nbsp;</th>")});$(k).width(1),$(l).width(1),g>=0&&$(a.grid.fhDiv).append(k).mousemove(function(b){return a.grid.resizing?(a.grid.dragMove(b),!1):void 0}),f>=0&&$(a.grid.rightfhDiv).append(l).mousemove(function(b){return a.grid.resizing?(a.grid.dragMove(b),!1):void 0}),$(a.element).bind("gridonresizestop.setFrozenColumns",function(b,c){var e=c.index,h=c.newWidth;if(g>=0){var i=$(".coral-grid-htable",a.grid.fhDiv);$("th:eq("+e+")",i).width(h);var j=$(".coral-grid-btable",a.grid.fbDiv);$("tr:first td:eq("+e+")",j).width(h)}if(f>=0){var i=$(".coral-grid-htable",a.grid.rightfhDiv);$("th:eq("+(d-e-1)+")",i).width(h);var j=$(".coral-grid-btable",a.grid.rightfbDiv);$("tr:first td:eq("+(d-e-1)+")",j).width(h),a.resetFrozen()}}),$(a.element).bind("gridonsortcol.setFrozenColumns",function(b,c){var d=(c.id,c.colIndex);if(g>=0){var e=$("tr.coral-grid-labels:last th:eq("+a.options.lastsort+")",a.grid.fhDiv),h=$("tr.coral-grid-labels:last th:eq("+d+")",a.grid.fhDiv);$("span.coral-grid-ico-sort",e).addClass("coral-state-disabled"),$(e).attr("aria-selected","false"),$("span.coral-icon-"+a.options.sortorder,h).removeClass("coral-state-disabled"),$(h).attr("aria-selected","true"),a.options.viewsortcols[0]||a.options.lastsort!=d&&($("span.s-ico",e).hide(),$("span.s-ico",h).show())}if(f>=0){d=a.grid.headers.length-d-1;var e=$("tr.coral-grid-labels:last th:eq("+a.options.lastsort+")",a.grid.rightfhDiv),h=$("tr.coral-grid-labels:last th:eq("+d+")",a.grid.rightfhDiv);$("span.coral-grid-ico-sort",e).addClass("coral-state-disabled"),$(e).attr("aria-selected","false"),$("span.coral-icon-"+a.options.sortorder,h).removeClass("coral-state-disabled"),$(h).attr("aria-selected","true"),a.options.viewsortcols[0]||a.options.lastsort!=d&&($("span.s-ico",e).hide(),$("span.s-ico",h).show())}}),g>=0&&$("#"+$.grid.coralID(a.options.id)).append(a.grid.fbDiv),f>=0&&$("#"+$.grid.coralID(a.options.id)).append(a.grid.rightfbDiv),jQuery(a.grid.rowsView).scroll(function(){g>=0&&jQuery(a.grid.fbDiv).scrollTop(jQuery(this).scrollTop()),f>=0&&jQuery(a.grid.rightfbDiv).scrollTop(jQuery(this).scrollTop())});var o=0,p=0,q=0;g>=0&&$(a.grid.fbDiv).mousewheel(function(b,c){var d=-(b.deltaY*b.deltaFactor);p=$(a.grid.rowsView).scrollTop(),o=p,o+=d,$(a.grid.rowsView).scrollTop(o),q=$(a.grid.rowsView).scrollTop(),q==p?o-=d:b.preventDefault()}),f>=0&&$(a.grid.rightfbDiv).mousewheel(function(b,c){var d=-(b.deltaY*b.deltaFactor);p=$(a.grid.rowsView).scrollTop(),o=p,o+=d,$(a.grid.rowsView).scrollTop(o),q=$(a.grid.rowsView).scrollTop(),q==p?o-=d:b.preventDefault()}),a.options.hoverrows===!0&&$("#"+$.grid.coralID(a.options.id)).unbind("mouseover").unbind("mouseout"),$(a.element).bind("gridaftercomplete.setFrozenColumns",function(){$("#"+$.grid.coralID(a.options.id)+"_frozen").remove();var b,c;g>=0&&(b=$("#"+$.grid.coralID(a.options.id)+"_table").clone(!0),jQuery(a.grid.fbDiv).height(jQuery(a.grid.rowsView).height()-a.getScrollBarWidth()+2),$("tr",b).each(function(){$("td:gt("+g+")",this).remove(),!a.options.singleselect||$("td:eq(0)>input",this).attr("name",$("td:eq(0)>input",this).attr("name")+"_forzen")}),$(b).width(1).attr("id",a.options.id+"_frozen"),$(a.grid.fbDiv).append(b),a.options.hoverrows===!0&&($("tr.jqgrow",b).hover(function(){$(this).addClass("coral-state-hover"),$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID(a.options.id)).addClass("coral-state-hover")},function(){$(this).removeClass("coral-state-hover"),$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID(a.options.id)).removeClass("coral-state-hover")}),$("tr.jqgrow","#"+$.grid.coralID(a.options.id)).hover(function(){$(this).addClass("coral-state-hover"),$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID(a.options.id)+"_frozen").addClass("coral-state-hover")},function(){$(this).removeClass("coral-state-hover"),$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID(a.options.id)+"_frozen").removeClass("coral-state-hover")})),b=null),f>=0&&($(a.grid.rowsView)[0].scrollHeight-$(a.grid.rowsView)[0].clientHeight>0&&a.grid.rightfbDiv.css({right:a.getScrollBarWidth()-2+"px"}),c=$("#"+$.grid.coralID(a.options.id)+"_table").clone(!0),jQuery(a.grid.rightfbDiv).height(jQuery(a.grid.rowsView).height()-a.getScrollBarWidth()+2),$("tr",c).each(function(){$("td:lt("+f+")",this).remove(),!a.options.singleselect||$("td:eq(0)>input",this).attr("name",$("td:eq(0)>input",this).attr("name")+"_forzen")}),$(c).width(1).attr("id",a.options.id+"_frozen"),$(a.grid.rightfbDiv).append(c),a.options.hoverrows===!0&&($("tr.jqgrow",c).hover(function(){$(this).addClass("coral-state-hover"),$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID(a.options.id)).addClass("coral-state-hover")},function(){$(this).removeClass("coral-state-hover"),$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID(a.options.id)).removeClass("coral-state-hover")}),$("tr.jqgrow","#"+$.grid.coralID(a.options.id)).hover(function(){$(this).addClass("coral-state-hover"),$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID(a.options.id)+"_frozen").addClass("coral-state-hover")},function(){$(this).removeClass("coral-state-hover"),$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID(a.options.id)+"_frozen").removeClass("coral-state-hover")})),c=null)}),a.options.frozenColumns=!0}}}},destroyFrozenColumns:function(){if(this.grid&&this.options.frozenColumns===!0){var a=this;if($(a.grid.fhDiv).remove(),$(a.grid.fbDiv).remove(),$(a.grid.rightfhDiv).remove(),$(a.grid.rightfbDiv).remove(),a.grid.fhDiv=null,a.grid.fbDiv=null,a.grid.rightfhDiv=null,a.grid.rightfbDiv=null,$(this.element).unbind(".setFrozenColumns"),a.options.hoverrows===!0){var b;$("#"+$.grid.coralID(a.options.id)).bind("mouseover",function(a){b=$(a.target).closest("tr.jqgrow"),"coral-subgrid"!==$(b).attr("class")&&$(b).addClass("coral-state-hover")}).bind("mouseout",function(a){b=$(a.target).closest("tr.jqgrow"),$(b).removeClass("coral-state-hover")})}this.options.frozenColumns=!1}}}),$.extend($.grid,{template:function(a){var b,c=$.makeArray(arguments).slice(1),d=c.length;return null==a&&(a=""),a.replace(/\{([\w\-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,function(a,e){if(!isNaN(parseInt(e,10)))return c[parseInt(e,10)];for(b=0;d>b;b++)if($.isArray(c[b]))for(var f=c[b],g=f.length;g--;)if(e===f[g].nm)return f[g].v})}}),grid=$.component("coral.grid",$.coral.grid,{groupingSetup:function(){var a,b,c,d=this,e=d.options.colModel,f=d.options.groupingView;if(null===f||"object"!=typeof f&&!$.isFunction(f))this.options.grouping=!1;else if(f.groupField.length){for(void 0===f.visibiltyOnNextGrouping&&(f.visibiltyOnNextGrouping=[]),f.lastvalues=[],f._locgr||(f.groups=[]),f.counters=[],a=0;a<f.groupField.length;a++)f.groupOrder[a]||(f.groupOrder[a]="asc"),f.groupText[a]||(f.groupText[a]="{0}"),"boolean"!=typeof f.groupColumnShow[a]&&(f.groupColumnShow[a]=!0),"boolean"!=typeof f.groupSummary[a]&&(f.groupSummary[a]=!1),f.groupSummaryPos[a]||(f.groupSummaryPos[a]="footer"),f.groupColumnShow[a]===!0?(f.visibiltyOnNextGrouping[a]=!0,$(this.element).grid("showCol",f.groupField[a])):(f.visibiltyOnNextGrouping[a]=$("#"+$.grid.coralID(d.options.id+"_"+f.groupField[a])).is(":visible"),$(this.element).grid("hideCol",f.groupField[a]));for(f.summary=[],f.hideFirstGroupCol&&(f.formatDisplayField[0]=function(a){return a}),b=0,c=e.length;c>b;b++)f.hideFirstGroupCol&&(e[b].hidden||f.groupField[0]!==e[b].name||(e[b].formatter=function(){return""})),e[b].summaryType&&(e[b].summaryDivider?f.summary.push({nm:e[b].name,st:e[b].summaryType,v:"",sd:e[b].summaryDivider,vd:"",sr:e[b].summaryRound,srt:e[b].summaryRoundType||"round"}):f.summary.push({nm:e[b].name,st:e[b].summaryType,v:"",sr:e[b].summaryRound,srt:e[b].summaryRoundType||"round"}))}else d.options.grouping=!1},groupingPrepare:function(a,b){var c,d,e,f,g,h=this,i=this.options.groupingView,j=i.groupField.length,k=0;for(c=0;j>c;c++)d=i.groupField[c],f=i.displayField[c],e=a[d],g=null==f?null:a[f],null==g&&(g=e),void 0!==e&&(0===b?(i.groups.push({idx:c,dataIndex:d,value:e,displayValue:g,startRow:b,cnt:1,summary:[]}),i.lastvalues[c]=e,i.counters[c]={cnt:1,pos:i.groups.length-1,summary:$.extend(!0,[],i.summary)},$.each(i.counters[c].summary,function(){$.isFunction(this.st)?this.v=this.st.call(this,this.v,this.nm,a):(this.v=h.groupingCalculations.handler(this.st,this.v,this.nm,this.sr,this.srt,a),"avg"===this.st.toLowerCase()&&this.sd&&(this.vd=h.groupingCalculations.handler(this.st,this.vd,this.sd,this.sr,this.srt,a)))}),i.groups[i.counters[c].pos].summary=i.counters[c].summary):"object"==typeof e||($.isArray(i.isInTheSameGroup)&&$.isFunction(i.isInTheSameGroup[c])?i.isInTheSameGroup[c].call(this,i.lastvalues[c],e,c,i):i.lastvalues[c]===e)?1===k?(i.groups.push({idx:c,dataIndex:d,value:e,displayValue:g,startRow:b,cnt:1,summary:[]}),i.lastvalues[c]=e,i.counters[c]={cnt:1,pos:i.groups.length-1,summary:$.extend(!0,[],i.summary)},$.each(i.counters[c].summary,function(){$.isFunction(this.st)?this.v=this.st.call(this,this.v,this.nm,a):(this.v=h.groupingCalculations.handler(this.st,this.v,this.nm,this.sr,this.srt,a),"avg"===this.st.toLowerCase()&&this.sd&&(this.vd=h.groupingCalculations.handler(this.st,this.vd,this.sd,this.sr,this.srt,a)))}),i.groups[i.counters[c].pos].summary=i.counters[c].summary):(i.counters[c].cnt+=1,i.groups[i.counters[c].pos].cnt=i.counters[c].cnt,$.each(i.counters[c].summary,function(){$.isFunction(this.st)?this.v=this.st.call(this,this.v,this.nm,a):(this.v=h.groupingCalculations.handler(this.st,this.v,this.nm,this.sr,this.srt,a),"avg"===this.st.toLowerCase()&&this.sd&&(this.vd=h.groupingCalculations.handler(this.st,this.vd,this.sd,this.sr,this.srt,a)))}),i.groups[i.counters[c].pos].summary=i.counters[c].summary):(i.groups.push({idx:c,dataIndex:d,value:e,displayValue:g,startRow:b,cnt:1,summary:[]}),i.lastvalues[c]=e,k=1,i.counters[c]={cnt:1,pos:i.groups.length-1,summary:$.extend(!0,[],i.summary)},$.each(i.counters[c].summary,function(){$.isFunction(this.st)?this.v=this.st.call(this,this.v,this.nm,a):(this.v=h.groupingCalculations.handler(this.st,this.v,this.nm,this.sr,this.srt,a),"avg"===this.st.toLowerCase()&&this.sd&&(this.vd=h.groupingCalculations.handler(this.st,this.vd,this.sd,this.sr,this.srt,a)))}),i.groups[i.counters[c].pos].summary=i.counters[c].summary));return this},groupingToggle:function(a){var b=this,c=b.options.groupingView,d=a.split("_"),e=parseInt(d[d.length-2],10);d.splice(d.length-2,2);var f,g,h=d.join("_"),i=c.minusicon,j=c.plusicon,k=$("#"+$.grid.coralID(a)),l=k.length?k[0].nextSibling:null,m=$("#"+$.grid.coralID(a)+" span.tree-wrap-"+b.options.direction),n=function(a){var b=$.map(a.split(" "),function(a){return a.substring(0,h.length+1)===h+"_"?parseInt(a.substring(h.length+1),10):void 0});return b.length>0?b[0]:void 0;
},o=!1,p=b.options.frozenColumns?b.options.id+"_frozen":!1,q=p?$("#"+$.grid.coralID(a),"#"+$.grid.coralID(p)):!1,r=q&&q.length?q[0].nextSibling:null;if(m.hasClass(i)){if(c.showSummaryOnHide){if(l)for(;l&&(f=n(l.className),!(void 0!==f&&e>=f));)$(l).hide(),l=l.nextSibling,p&&($(r).hide(),r=r.nextSibling)}else if(l)for(;l&&(f=n(l.className),!(void 0!==f&&e>=f));)$(l).hide(),l=l.nextSibling,p&&($(r).hide(),r=r.nextSibling);m.removeClass(i).addClass(j),o=!0}else{if(l)for(g=void 0;l;){if(f=n(l.className),void 0===g&&(g=void 0===f),void 0!==f){if(e>=f)break;f===e+1&&($(l).show().find(">td>span.tree-wrap-"+b.options.direction).removeClass(i).addClass(j),p&&$(r).show().find(">td>span.tree-wrap-"+b.options.direction).removeClass(i).addClass(j))}else g&&($(l).show(),p&&$(r).show());l=l.nextSibling,p&&(r=r.nextSibling)}m.removeClass(j).addClass(i)}return this._trigger("onClickGroup",null,[{headId:a,collapsed:o}]),!1},groupingRender:function(a,b,c,d){function e(a,b,c){var d,e=!1;if(0===b)e=c[a];else{var f=c[a].idx;if(0===f)e=c[a];else for(d=a;d>=0;d--)if(c[d].idx===f-b){e=c[d];break}}return e}function f(a,c,d,f){var g,h,i=e(a,c,d),k=j.options.colModel,l=i.cnt,m="";for(h=f;b>h;h++){var n="<td "+j._formatCol(h,1,"")+">&#160;</td>",o="{0}";$.each(i.summary,function(){if(this.nm===k[h].name){k[h].summaryTpl&&(o=k[h].summaryTpl),"string"==typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?this.v=this.v/this.vd:this.v&&l>0&&(this.v=this.v/l));try{this.groupCount=i.cnt,this.groupIndex=i.dataIndex,this.groupValue=i.value,g=this.formatter("",this.v,h,this)}catch(a){g=this.v}return n="<td "+j._formatCol(h,1,"")+">"+$.grid.format(o,g)+"</td>",!1}}),m+=n}return m}var g,h,i,j=this,k=j.options.groupingView,l="",m="",n=k.groupCollapse?k.plusicon:k.minusicon,o=[],p=k.groupField.length;n+=" tree-wrap-"+j.options.direction,$.each(j.options.colModel,function(a,b){var c;for(c=0;p>c;c++)if(k.groupField[c]===b.name){o[c]=a;break}});var q,r=0,s=$.makeArray(k.groupSummary);s.reverse(),q=j.options.multiselect?' colspan="2"':"",$.each(k.groups,function(e,t){if(k._locgr&&!(t.startRow+t.cnt>(c-1)*d&&t.startRow<c*d))return!0;r++,h=j.options.id+"ghead_"+t.idx,g=h+"_"+e,m="<span style='cursor:pointer;' class='icon "+n+"' onclick=\"jQuery('#"+$.grid.coralID(j.options.id)+"').grid('groupingToggle','"+g+"');return false;\"></span>";try{$.isArray(k.formatDisplayField)&&$.isFunction(k.formatDisplayField[t.idx])?(t.displayValue=k.formatDisplayField[t.idx].call(this,t.displayValue,t.value,j.options.colModel[o[t.idx]],t.idx,k),i=t.displayValue):i=this.formatter(g,t.displayValue,o[t.idx],t.value)}catch(u){i=t.displayValue}"header"===k.groupSummaryPos[t.idx]?(l+='<tr id="'+g+'"'+(k.groupCollapse&&t.idx>0?' style="display:none;" ':" ")+'role="row" class= "coral-component-content jqgroup coral-row-'+j.options.direction+" "+h+'"><td style="padding-left:'+12*t.idx+'px;"'+q+">"+m+$.grid.template(k.groupText[t.idx],i,t.cnt,t.summary)+"</td>",l+=f(e,0,k.groups,k.groupColumnShow[t.idx]===!1?""===q?2:3:""===q?1:2),l+="</tr>"):l+='<tr id="'+g+'"'+(k.groupCollapse&&t.idx>0?' style="display:none;" ':" ")+'role="row" class= "coral-component-content jqgroup coral-row-'+j.options.direction+" "+h+'"><td style="padding-left:'+12*t.idx+'px;" colspan="'+(k.groupColumnShow[t.idx]===!1?b-1:b)+'">'+m+$.grid.template(k.groupText[t.idx],i,t.cnt,t.summary)+"</td></tr>";var v=p-1===t.idx;if(v){var w,x,y=k.groups[e+1],z=0,A=t.startRow,B=void 0!==y?y.startRow:k.groups[e].startRow+k.groups[e].cnt;for(k._locgr&&(z=(c-1)*d,z>t.startRow&&(A=z)),w=A;B>w&&a[w-z];w++)l+=a[w-z].join("");if("header"!==k.groupSummaryPos[t.idx]){var C;if(void 0!==y){for(C=0;C<k.groupField.length&&y.dataIndex!==k.groupField[C];C++);r=k.groupField.length-C}for(x=0;r>x;x++)if(s[x]){var D="";k.groupCollapse&&!k.showSummaryOnHide&&(D=' style="display:none;"'),l+="<tr"+D+' jqfootlevel="'+(t.idx-x)+'" role="row" class="coral-component-content jqfoot coral-row-'+j.options.direction+'">',l+=f(e,x,k.groups,0),l+="</tr>"}r=C}}}),$("#"+$.grid.coralID(j.options.id)+" tbody:first").append(l),l=null},groupingGroupBy:function(a,b){var c=this;"string"==typeof a&&(a=[a]);var d=c.options.groupingView;c.options.grouping=!0,void 0===d.visibiltyOnNextGrouping&&(d.visibiltyOnNextGrouping=[]);var e;for(e=0;e<d.groupField.length;e++)!d.groupColumnShow[e]&&d.visibiltyOnNextGrouping[e]&&$(this).grid("showCol",d.groupField[e]);for(e=0;e<a.length;e++)d.visibiltyOnNextGrouping[e]=$("#"+$.grid.coralID(c.options.id)+"_"+$.grid.coralID(a[e])).is(":visible");c.options.groupingView=$.extend(c.options.groupingView,b||{}),d.groupField=a,$(this).trigger("reloadGrid")},groupingRemove:function(a){var b=this;if(void 0===a&&(a=!0),b.options.grouping=!1,a===!0){var c,d=b.options.groupingView;for(c=0;c<d.groupField.length;c++)!d.groupColumnShow[c]&&d.visibiltyOnNextGrouping[c]&&$(this).grid("showCol",d.groupField);$("tr.jqgroup, tr.jqfoot","#"+$.grid.coralID(b.options.id)+" tbody:first").remove(),$("tr.jqgrow:hidden","#"+$.grid.coralID(b.options.id)+" tbody:first").show()}else $(this).trigger("reloadGrid")},groupingCalculations:{handler:function(a,b,c,d,e,f){var g={sum:function(){return parseFloat(b||0)+parseFloat(f[c]||0)},min:function(){return""===b?parseFloat(f[c]||0):Math.min(parseFloat(b),parseFloat(f[c]||0))},max:function(){return""===b?parseFloat(f[c]||0):Math.max(parseFloat(b),parseFloat(f[c]||0))},count:function(){return""===b&&(b=0),f.hasOwnProperty(c)?b+1:0},avg:function(){return g.sum()}};if(!g[a])throw"grid Grouping No such method: "+a;var h=g[a]();if(null!=d)if("fixed"===e)h=h.toFixed(d);else{var i=Math.pow(10,d);h=Math.round(h*i)/i}return h}}}),grid=$.component("coral.grid",$.coral.grid,{setSubGrid:function(){var a,b,c=this,d={plusicon:"coral-icon-plus",minusicon:"coral-icon-minus",openicon:"coral-icon-carat-1-sw",expandOnLoad:!1,delayOnLoad:50,selectOnExpand:!1,selectOnCollapse:!1,reloadOnExpand:!0};if(c.options.subGridOptions=$.extend(d,c.options.subGridOptions||{}),c.options.colNames.unshift(""),c.options.colModel.unshift({name:"subgrid",width:$.grid.cell_width?c.options.subGridWidth+$t.options.cellLayout:c.options.subGridWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,fixed:!0}),a=c.options.subGridModel,a[0])for(a[0].align=$.extend([],a[0].align||[]),b=0;b<a[0].name.length;b++)a[0].align[b]=a[0].align[b]||"left"},addSubGridCell:function(a,b){var c,d,e="";return e=this._formatCol(a,b),d=this.options.id,c=this.options.subGridOptions.plusicon,'<td role="gridcell" aria-describedby="'+d+'_subgrid" class="coral-sgcollapsed sgcollapsed" '+e+"><a style='cursor:pointer;'><span class='coral-icon "+c+"'></span></a></td>"},addSubGrid:function(a,b){var c=this;if(c.grid){var d,e,f,g,h,i=function(a,b,d){var e=$("<td align='"+c.options.subGridModel[0].align[d]+"'></td>").html(b);$(a).append(e)},j=function(a,b){var d,e,f,g=$("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),h=$("<tr></tr>");for(e=0;e<c.options.subGridModel[0].name.length;e++)d=$("<th class='coral-state-default coral-th-subgrid coral-th-column coral-th-"+c.options.direction+"'></th>"),$(d).html(c.options.subGridModel[0].name[e]),$(d).width(c.options.subGridModel[0].width[e]),$(h).append(d);$(g).append(h),a&&(f=c.options.xmlReader.subgrid,$(f.root+" "+f.row,a).each(function(){if(h=$("<tr class='coral-component-content coral-subtblcell'></tr>"),f.repeatitems===!0)$(f.cell,this).each(function(a){i(h,$(this).text()||"&#160;",a)});else{var a=c.options.subGridModel[0].mapping||c.options.subGridModel[0].name;if(a)for(e=0;e<a.length;e++)i(h,$(a[e],this).text()||"&#160;",e)}$(g).append(h)}));var j=$("table:first",c.grid.bDiv).attr("id")+"_";return $("#"+$.grid.coralID(j+b)).append(g),c.grid.hDiv.loading=!1,$("#load_"+$.grid.coralID(c.options.id)).hide(),!1},k=function(a,b){var d,e,f,g,h,j,k=$("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),l=$("<tr></tr>");for(f=0;f<c.options.subGridModel[0].name.length;f++)d=$("<th class='coral-state-default coral-th-subgrid coral-th-column coral-th-"+c.options.direction+"'></th>"),$(d).html(c.options.subGridModel[0].name[f]),$(d).width(c.options.subGridModel[0].width[f]),$(l).append(d);if($(k).append(l),a&&(h=c.options.jsonReader.subgrid,e=$.grid.getAccessor(a,h.root),void 0!==e))for(f=0;f<e.length;f++){if(g=e[f],l=$("<tr class='coral-component-content coral-subtblcell'></tr>"),h.repeatitems===!0)for(h.cell&&(g=g[h.cell]),j=0;j<g.length;j++)i(l,g[j]||"&#160;",j);else{var m=c.options.subGridModel[0].mapping||c.options.subGridModel[0].name;if(m.length)for(j=0;j<m.length;j++)i(l,g[m[j]]||"&#160;",j)}$(k).append(l)}var n=$("table:first",c.grid.bDiv).attr("id")+"_";return $("#"+$.grid.coralID(n+b)).append(k),c.grid.hDiv.loading=!1,$("#load_"+$.grid.coralID(c.options.id)).hide(),!1},l=function(a){var b,d,e,f;if(b=$(a).attr("id"),d={nd_:(new Date).getTime()},d[c.options.prmNames.subgridid]=b,!c.options.subGridModel[0])return!1;if(c.options.subGridModel[0].params)for(f=0;f<c.options.subGridModel[0].params.length;f++)for(e=0;e<c.options.colModel.length;e++)c.options.colModel[e].name===c.options.subGridModel[0].params[f]&&(d[c.options.colModel[e].name]=$("td:eq("+e+")",a).text().replace(/\&#160\;/gi,""));if(!c.grid.hDiv.loading)switch(c.grid.hDiv.loading=!0,$("#load_"+$.grid.coralID(c.options.id)).show(),c.options.subgridtype||(c.options.subgridtype=c.options.datatype),$.isFunction(c.options.subgridtype)?c.options.subgridtype.call(c,d):c.options.subgridtype=c.options.subgridtype.toLowerCase(),c.options.subgridtype){case"xml":case"json":$.ajax($.extend({type:c.options.mtype,url:$.isFunction(c.options.subGridUrl)?c.options.subGridUrl.call(c,d):c.options.subGridUrl,dataType:c.options.subgridtype,data:$.isFunction(c.options.serializeSubGridData)?c.options.serializeSubGridData.call(c,d):d,complete:function(a){"xml"===c.options.subgridtype?j(a.responseXML,b):k($.grid.parse(a.responseText),b),a=null}},$.grid.ajaxOptions,c.options.ajaxSubgridOptions||{}))}return!1},m=0;$.each(c.options.colModel,function(){this.hidden!==!0&&"rn"!==this.name&&"cb"!==this.name||m++});var n=c.rows.length,o=1;for(void 0!==b&&b>0&&(o=b,n=b+1);n>o;)$(c.rows[o]).hasClass("jqgrow")&&(c.options.scroll&&$(c.rows[o].cells[a]).unbind("click"),$(c.rows[o].cells[a]).bind("click",function(){var b=$(this).parent("tr")[0];if(e=c.options.id,d=b.id,h=$("#"+e+"_"+d+"_expandedContent"),$(this).hasClass("sgcollapsed")){if(g=$(c).triggerHandler("jqGridSubGridBeforeExpand",[e+"_"+d,d]),g=g!==!1&&"stop"!==g,g&&$.isFunction(c.options.subGridBeforeExpand)&&(g=c.options.subGridBeforeExpand.call(c,e+"_"+d,d)),g===!1)return!1;c.options.subGridOptions.reloadOnExpand===!0||c.options.subGridOptions.reloadOnExpand===!1&&!h.hasClass("coral-subgrid")?(f=a>=1?"<td colspan='"+a+"'>&#160;</td>":"",$(b).after("<tr role='row' id='"+e+"_"+d+"_expandedContent' class='coral-subgrid coral-sg-expanded'>"+f+"<td class='coral-component-content subgrid-cell'><span class='coral-icon "+c.options.subGridOptions.openicon+"'></span></td><td colspan='"+parseInt(c.options.colNames.length-1-m,10)+"' class='coral-component-content subgrid-data'><div id="+e+"_"+d+" class='tablediv'></div></td></tr>"),$(c).triggerHandler("jqGridSubGridRowExpanded",[e+"_"+d,d]),$.isFunction(c.options.subGridRowExpanded)?c.options.subGridRowExpanded.call(c,e+"_"+d,d):l(b)):h.show().removeClass("coral-sg-collapsed").addClass("coral-sg-expanded"),$(this).html("<a style='cursor:pointer;'><span class='coral-icon "+c.options.subGridOptions.minusicon+"'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded"),c.options.subGridOptions.selectOnExpand&&$(c).jqGrid("setSelection",d)}else if($(this).hasClass("sgexpanded")){if(g=$(c).triggerHandler("jqGridSubGridRowColapsed",[e+"_"+d,d]),g=g!==!1&&"stop"!==g,g&&$.isFunction(c.options.subGridRowColapsed)&&(g=c.options.subGridRowColapsed.call(c,e+"_"+d,d)),g===!1)return!1;c.options.subGridOptions.reloadOnExpand===!0?h.remove(".coral-subgrid"):h.hasClass("coral-subgrid")&&h.hide().addClass("coral-sg-collapsed").removeClass("coral-sg-expanded"),$(this).html("<a style='cursor:pointer;'><span class='coral-icon "+c.options.subGridOptions.plusicon+"'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed"),c.options.subGridOptions.selectOnCollapse&&$(c).jqGrid("setSelection",d)}return!1})),o++;if(c.options.subGridOptions.expandOnLoad===!0){var p=c.options,q=p.rownumbers===!0?1:0,r=p.multiselect===!0?1:p.singleselect===!0?1:0,s=q+r;$(c.rows).filter(".jqgrow").each(function(a,b){$(b.cells[s]).click()})}c.subGridXml=function(a,b){j(a,b)},c.subGridJson=function(a,b){k(a,b)}}},expandSubGridRow:function(a){var b=this;if((b.grid||a)&&b.options.subGrid===!0){var c=$(this).jqGrid("getInd",a,!0);if(c){var d=$("td.sgcollapsed",c)[0];d&&$(d).trigger("click")}}},collapseSubGridRow:function(a){var b=this;if((b.grid||a)&&b.options.subGrid===!0){var c=$(this).jqGrid("getInd",a,!0);if(c){var d=$("td.sgexpanded",c)[0];d&&$(d).trigger("click")}}},toggleSubGridRow:function(a){var b=this;if((b.grid||a)&&b.options.subGrid===!0){var c=$(this).jqGrid("getInd",a,!0);if(c){var d=$("td.sgcollapsed",c)[0];d?$(d).trigger("click"):(d=$("td.sgexpanded",c)[0],d&&$(d).trigger("click"))}}}}),grid=$.component("coral.grid",$.coral.grid,{filterToolbar:function(a){var b=$.grid.search;options=$.extend({autosearch:!0,autosearchDelay:500,searchOnEnter:!0,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,searchurl:"",stringResult:!1,groupOp:"AND",defaultSearch:"bw",searchOperators:!1,resetIcon:"x",operands:{eq:"==",ne:"!",lt:"<",le:"<=",gt:">",ge:">=",bw:"^",bn:"!^","in":"=",ni:"!=",ew:"|",en:"!@",cn:"~",nc:"!~",nu:"#",nn:"!#"}},b,a||{});var c=this;if(!c.options.filterToolbar){$(c).data("filterToolbar")||$(c).data("filterToolbar",options),c.options.force_regional&&(options=$.extend(options,b));var d,e=function(){var a,b,d,e={},f=0,g={};$.each(c.options.colModel,function(){var h="text"==this.stype?"textbox":this.stype,i=$("#gsh_"+c.options.idPrefix+c.element[0].id+"_"+$.grid.coralID(this.name)+" .ctrl-init",this.frozen===!0&&c.options.frozenColumns===!0?c.grid.fhDiv:c.grid.columnsView);if(b=this.index||this.name,d=options.searchOperators?i[h]("component").parent().prev().children("a").attr("soper")||options.defaultSearch:this.searchoptions&&this.searchoptions.sopt?this.searchoptions.sopt[0]:"select"===this.stype?"eq":options.defaultSearch,a="custom"===this.stype&&$.isFunction(this.searchoptions.custom_value)&&i.length>0&&"SPAN"===i[0].nodeName.toUpperCase()?this.searchoptions.custom_value.call(c,i.children(".customelement:first"),"get"):i.hasClass("ctrl-init")?i[h]("getValue"):void 0,a||"nu"===d||"nn"===d)e[b]=a,g[b]=d,f++;else try{delete c.options.postData[b]}catch(j){}});var h=f>0;if(options.stringResult===!0||"local"===c.options.datatype||options.searchOperators===!0){var i='{"groupOp":"'+options.groupOp+'","rules":[',j=0;$.each(e,function(a,b){j>0&&(i+=","),i+='{"field":"'+a+'",',i+='"op":"'+g[a]+'",',b+="",i+='"data":"'+b.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',j++}),i+="]}",$.extend(c.options.postData,{filters:i}),$.each(["searchField","searchString","searchOper"],function(a,b){c.options.postData.hasOwnProperty(b)&&delete c.options.postData[b]})}else $.extend(c.options.postData,e);var k;c.options.searchurl&&(k=c.options.url,$(c).grid("option",{url:c.options.searchurl}));var l="stop"===$(c).triggerHandler("jqGridToolbarBeforeSearch");!l&&$.isFunction(options.beforeSearch)&&(l=options.beforeSearch.call(c)),l||(c.isFilterAction=c.isFilterAction!==!1,$(c.element[0]).grid("option",{search:h}).grid("reload"),c.isFilterAction=!1),k&&$(c.element[0]).grid("option",{url:k}),$.isFunction(options.afterSearch)&&options.afterSearch.call(c)},f=function(a){var b,d={},e=0;a="boolean"!=typeof a?!0:a,$.each(c.options.colModel,function(){var a,f=$("#gs_"+c.options.idPrefix+$.grid.coralID(this.name),this.frozen===!0&&c.options.frozenColumns===!0?c.grid.fhDiv:c.grid.columnsView);switch(this.searchoptions&&void 0!==this.searchoptions.defaultValue&&(a=this.searchoptions.defaultValue),b=this.index||this.name,this.stype){case"select":if(f.find("option").each(function(b){return 0===b&&(this.selected=!0),$(this).val()===a?(this.selected=!0,!1):void 0}),void 0!==a)d[b]=a,e++;else try{delete c.options.postData[b]}catch(g){}break;case"text":if(f.val(a||""),void 0!==a)d[b]=a,e++;else try{delete c.options.postData[b]}catch(h){}break;case"custom":$.isFunction(this.searchoptions.custom_value)&&f.length>0&&"SPAN"===f[0].nodeName.toUpperCase()&&this.searchoptions.custom_value.call(c,f.children(".customelement:first"),"set",a||"")}});var f=e>0;if(c.options.resetsearch=!0,options.stringResult===!0||"local"===c.options.datatype){var g='{"groupOp":"'+options.groupOp+'","rules":[',h=0;$.each(d,function(a,b){h>0&&(g+=","),g+='{"field":"'+a+'",',g+='"op":"eq",',b+="",g+='"data":"'+b.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',h++}),g+="]}",$.extend(c.options.postData,{filters:g}),$.each(["searchField","searchString","searchOper"],function(a,b){c.options.postData.hasOwnProperty(b)&&delete c.options.postData[b]})}else $.extend(c.options.postData,d);var i;c.options.searchurl&&(i=c.options.url,$(c).grid("option",{url:c.options.searchurl}));var j="stop"===$(c).triggerHandler("jqGridToolbarBeforeClear");!j&&$.isFunction(options.beforeClear)&&(j=options.beforeClear.call(c)),j||a&&$(c).grid("option",{search:f}).trigger("reload",[{page:1}]),i&&$(c).grid("option",{url:i}),$.isFunction(options.afterClear)&&options.afterClear()},g=function(){var a=$("tr.coral-search-toolbar",c.grid.columnsView),b=c.options.frozenColumns===!0?$("tr.coral-search-toolbar",c.grid.fhDiv):!1;"none"===a.css("display")?(a.show(),b&&b.show()):(a.hide(),b&&b.hide())},h=function(a,b,d){$("#sopt_menu").remove(),b=parseInt(b,10),d=parseInt(d,10)+18;for(var f,g,h=$(".coral-grid-view").css("font-size")||"11px",i='<ul id="sopt_menu" class="coral-search-menu" role="menu" tabindex="0" style="font-size:'+h+";left:"+b+"px;top:"+d+'px; cursor:pointer;">',j=$(a).attr("soper"),k=[],l=0,m=$(a).attr("colname"),n=c.options.colModel.length;n>l&&c.options.colModel[l].name!==m;)l++;var o=c.options.colModel[l],p=$.extend({},o.searchoptions);for(p.sopt||(p.sopt=[],p.sopt[0]="select"===o.stype?"eq":options.defaultSearch),$.each(options.odata,function(){k.push(this.oper)}),l=0;l<p.sopt.length;l++)g=$.inArray(p.sopt[l],k),-1!==g&&(f=j===options.odata[g].oper?"coral-state-highlight":"",i+='<li class="coral-menu-item '+f+'" role="presentation"><a class="coral-corner-all coral-menu-item" tabindex="0" role="menuitem" value="'+options.odata[g].oper+'" oper="'+options.operands[options.odata[g].oper]+'"><table cellspacing="0" cellpadding="0" border="0"><tr><td width="25px">'+options.operands[options.odata[g].oper]+"</td><td>"+options.odata[g].text+"</td></tr></table></a></li>");i+="</ul>",$("body").append(i),$("#sopt_menu").addClass("coral-menu coral-component coral-component-content coral-corner-all"),$("#sopt_menu > li > a").hover(function(){$(this).addClass("coral-state-hover")},function(){$(this).removeClass("coral-state-hover")}).click(function(){var b=$(this).attr("value"),c=$(this).attr("oper");if($("#sopt_menu").hide(),$(a).text(c).attr("soper",b),options.autosearch===!0){var d=$(a).parent().next().children()[0].firstChild.firstChild;($(d).val()||"nu"===b||"nn"===b)&&e()}})},i=$("<tr class='coral-search-toolbar' role='row'></tr>");$.each(c.options.colModel,function(a){var b,f,g,h,j,k,l,m=this,n="",o="=",p=$("<th role='columnheader' class='coral-state-default coral-th-"+c.options.direction+"' id='gsh_"+c.options.id+"_"+m.name+"' ></th>"),q=$("<div></div>"),r=$("<table class='coral-search-table' cellspacing='0'><tr><td class='coral-search-oper' headers=''></td><td class='coral-search-input' headers=''></td><td class='coral-search-clear' headers=''></td></tr></table>");if(this.hidden===!0&&$(p).css("display","none"),this.search=this.search!==!1,void 0===this.stype&&(this.stype="text"),b=$.extend({},this.searchoptions||{},{name:m.index||m.name,id:"gs_"+c.options.idPrefix+m.name,oper:"search"}),this.search){if(options.searchOperators){for(f=b.sopt?b.sopt[0]:"select"===m.stype?"eq":options.defaultSearch,g=0;g<options.odata.length;g++)if(options.odata[g].oper===f){o=options.operands[f]||"";break}h=null!=b.searchtitle?b.searchtitle:options.operandTitle,n="<a title='"+h+"' style='padding-right: 0.5em;cursor:pointer;' soper='"+f+"' class='soptclass' colname='"+this.name+"'>"+o+"</a>"}switch($("td:eq(0)",r).attr("colindex",a).append(n),void 0===b.clearSearch&&(b.clearSearch=!0),b.clearSearch?(j=options.resetTitle||"Clear Search Value",$("td:eq(2)",r).append("<a title='"+j+"' style='padding-right: 0.3em;padding-left: 0.3em;cursor:pointer;' class='clearsearchclass'>"+options.resetIcon+"</a>")):$("td:eq(2)",r).hide(),this.surl&&(b.dataUrl=this.surl),k="",b.defaultValue&&(k=$.isFunction(b.defaultValue)?b.defaultValue.call(c):b.defaultValue),l=$.grid.createEl.call(c,m.stype,b,k,!1,$.extend({},$.grid.ajaxOptions,c.options.ajaxSelectOptions||{})),$(l).css({width:"100%"}).addClass("coral-widget-content coral-corner-all"),$("td:eq(1)",r).append(l),$(q).append(r),$.extend(options,{onKeyPress:function(a,b){var c=a.charCode||a.keyCode||0;return 13===c?(e(),!1):void 0},onKeyDown:function(a,b){var c=a.which;switch(c){case 13:return!1;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:d&&clearTimeout(d),d=setTimeout(function(){e()},500)}},onChange:function(){e(this)}}),this.stype){case"combobox":var s,t=this.searchoptions;s=$.extend(options,t),$(l)[this.stype](s);var u=options.onClick;options=$.extend({},options,{onClick:function(a,b){u&&u.apply(l,[a,b])}});break;case"text":options.valueChangedOnKeyUp=!0,$(l).textbox(options)}}$(p).append(q),$(i).append(p),options.searchOperators||$("td:eq(0)",r).hide()}),$("table thead",c.grid.columnsView).append(i),options.searchOperators&&($(".soptclass",i).click(function(a){var b=$(this).offset(),c=b.left,d=b.top;h(this,c,d),a.stopPropagation()}),$("body").on("click",function(a){"soptclass"!==a.target.className&&$("#sopt_menu").hide()})),$(".clearsearchclass",i).click(function(){var a=$(this).parents("tr:first"),b=parseInt($("td.coral-search-oper",a).attr("colindex"),10),d=$.extend({},c.options.colModel[b].searchoptions||{}),f=d.defaultValue?d.defaultValue:"";"select"===c.options.colModel[b].stype?f?$("td.coral-search-input select",a).val(f):$("td.coral-search-input select",a)[0].selectedIndex=0:$("td.coral-search-input input",a).val(f),options.autosearch===!0&&e()}),this.options.filterToolbar=!0,this.triggerToolbar=e,this.clearToolbar=f,this.toggleToolbar=g}},destroyFilterToolbar:function(){this.options.filterToolbar&&(this.triggerToolbar=null,this.clearToolbar=null,this.toggleToolbar=null,this.options.filterToolbar=!1,$(this.grid.columnsView).find("table thead tr.coral-search-toolbar").remove())}});