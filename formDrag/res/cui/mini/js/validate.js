/*! cui 2016-11-08 */
var validate_uuid=0,validateSuffix="coralForm",validatePrefix="validate";$.validate={options:{onStatus:"onstatus",errorMode:1,errMsgPosition:"leftBottom",requiredMsg:"*必输项",triggers:{textbox:["onchange","onblur","onkeyup"],radio:["onchange","onblur"],checkbox:["onchange","onblur"],radiolist:["onchange","onblur"],checkboxlist:["onchange","onblur"],combobox:["onchange","onblur"],colorpicker:[],combotree:["onchange","onblur"],combogrid:["onchange","onblur"],datepicker:["onchange","onblur"],autocomplete:["onchange","onblur"],spinner:["onchange","onblur"],textboxlist:["onchange","onblur"],autocompletetree:["onchange","onblur"],fileuploader:["onchange"]}},validateSuffix:function(){return validateSuffix},_validate:function(a){var b=a.validType,c=a.validValue,d=a.elementValue,e=a.optionValue,f=a.field,g=a.requiredMsg,h=a.errMsg;if("undefined"==typeof c)return"";switch(b){case"required":return this._checkRequired(c,d,g);case"minlength":return this._checkMinlength(c,d,h);case"maxlength":return this._checkMaxlength(c,d,h);case"pattern":return this._checkPattern(c,d,h);case"validType":return this._checkValidType(c,d,e,h);case"valid":return this._checkValid(c,d,h,f);case"specialCharacters":return this._isSpecialCharacters(c,d,h);default:return""}},getFieldType:function(a){return $(a).attr("component-role")},validTypeNames:["required","minlength","maxlength","pattern","validType","valid","specialCharacters"],validTypeOptions:{maxlength:{restrictInput:!1,showTooltip:!1},number:{restrictInput:!1},naturalnumber:{restrictInput:!1},integer:{restrictInput:!1},"float":{restrictInput:!1},zh:{restrictInput:!1},letter:{restrictInput:!1},uppercase:{restrictInput:!1},lowercase:{restrictInput:!1},zhOrNumOrLett:{restrictInput:!1},ip:{restrictInput:!1},port:{restrictInput:!1},url:{restrictInput:!1},email:{restrictInput:!1},mobile:{restrictInput:!1},idno:{restrictInput:!1},zipcode:{restrictInput:!1}},validateField:function(a,b){validAction=!0,b.validoptions=b.validoptions||{};var c=b.element,d=$.validate.getFieldType(c),e=b.notComponent?b.component:c[d]("component"),f=b.notComponent?b.validoptions:c[d]("option"),g=null,h=b.hasTips,i=[],j=f.errorMode||b.validoptions.errorMode||$.validate.options.errorMode,k=(f.errMsgPosition||b.validoptions.errMsgPosition||$.validate.options.errMsgPosition,f.readonly,f.disabled),l=f.isLabel;if(e.is(":visible")||(h=!1),h=!1,"hidden"==c.attr("type"))return c.prop("isError",!1),i;if(l||k)return c.prop("isError",!1),i;if(b.notComponent)g=b.value;else if("radio"===d||"checkbox"===d)g=c.prop("checked")?c[d]("getValue"):"";else try{g=c[d]("getValidateValue")}catch(m){$.error("cannot call methods on "+d+" , please achieve the getValue method !")}for(var n=0;n<this.validTypeNames.length;n++){var o=this.validTypeNames[n],p={optionValue:f.validType,requiredMsg:f.requiredMsg,elementValue:g,field:c,errMsg:f.errMsg,validValue:f[o],validType:o};if(f[o]&&"required"==o?!0:""!=g){var q=$.validate._validate(p);""==q||i.push(q)}}if(i.length>0){if($.validate.hideErrors(e),!b.notComponent)if(0==j)$(e).attr("data-errors",i.toString());else{var r=e.css("padding-right");e.append("<span class='cui-icon-notification2 coral-errorIcon' style='right:"+r+"' data-errors = '"+i.toString()+"' ></span>"),e.addClass("hasErrorIcon ")}e.addClass("coral-validate-error ");var s=i;return $.validate._apply(f.onValidError,c,a,s),$(c).prop("isError",!0),i}return $.validate._apply(f.onValidSuccess,c,a,{}),e.removeClass("coral-validate-error"),$.validate.hideErrors(e),$(c).prop("isError",!1),$(e).removeAttr("data-errors"),i},_apply:function(a,b,c,d){var e=$.coral.toFunction(a);return $.isFunction(e)?e.apply(b,[c,d]):void 0},_checkValid:function(a,b,c,d){var e="";c&&(e=c);var f=null;if(a){if(f=$.coralApply($.coral.toFunction(a),d&&d[0],[{value:b}]),"object"==typeof f&&"boolean"==typeof f.isValid)return f.isValid?"":f.errMsg?f.errMsg:""==e?f.errMsg:e;if("boolean"==typeof f)return f?e:e}return""},_checkRequired:function(a,b,c){var d=$.validate.options.requiredMsg;return c&&(d=c),"boolean"==typeof a&&a&&""==$.trim(b)?d:""},_checkMinlength:function(a,b,c){var d="最少输入"+a+"个字符！";if("undefined"!=typeof c&&null!=c&&""!=c&&(d=c),a&&this._isPositiveInteger(a)){var e=parseInt(a),f=this._getByteLength(b);return e>f?d:""}},_checkMaxlength:function(a,b,c){var d="最多输入"+a+"个字符！";if("undefined"!=typeof c&&null!=c&&""!=c&&(d=c),a&&this._isPositiveInteger(a)){var e=parseInt(a),f=this._getByteLength(b);return f>e?d:""}},_checkPattern:function(validValue,elementValue,errMsg){var errMsgResult="请输入匹配的字符串！";if("undefined"!=typeof errMsg&&null!=errMsg&&""!=errMsg&&(errMsgResult=errMsg),validValue){var reg=eval(validValue.replace(/\/\//g,"/"));return reg.test($.trim(elementValue))?"":errMsgResult}return""},_isSpecialCharacters:function(validValue,elementValue,errMsg){var errMsgResult="含有特殊符号！";if("undefined"!=typeof errMsg&&null!=errMsg&&""!=errMsg&&(errMsgResult=errMsg),validValue){var reg=eval(validValue.replace(/\/\//g,"/"));return reg.test($.trim(elementValue))?errMsgResult:""}return""},_checkValidType:function(a,b,c,d){var e="";"undefined"!=typeof d&&null!=d&&""!=d&&(e=d);var f=b;switch(a){case"number":return""==e&&(e="请输入数字！"),this._isNumber(f)?"":e;case"naturalnumber":return""==e&&(e="请输入自然数！"),this._isNaturalnumber(f)?"":e;case"integer":return""==e&&(e="请输入整数！"),this._isInteger(f)?"":e;case"float":return""==e&&(e="请输入实数！"),this._isFloat(f)?"":e;case"zh":return""==e&&(e="请输入汉字！"),this._isZh(f)?"":e;case"letter":return""==e&&(e="请输入英文字母！"),this._isLetter(f)?"":e;case"uppercase":return""==e&&(e="请输入大写英文字母！"),this._isUppercase(f)?"":e;case"lowercase":return""==e&&(e="请输入小写英文字母！"),this._isLowercase(f)?"":e;case"zhOrNumOrLett":return""==e&&(e="请输入汉字、数字、英文字母！"),this._isZhOrNumOrLett(f)?"":e;case"ip":return""==e&&(e="请输入合法的计算机IP地址！"),this._isIp(f)?"":e;case"port":return""==e&&(e="请输入合法的计算机IP地址端口号！"),this._isPort(f)?"":e;case"url":return""==e&&(e="请输入合法的网页地址！"),this._isUrl(f)?"":e;case"email":return""==e&&(e="请输入合法的电子邮件地址！"),this._isEmail(f)?"":e;case"mobile":return""==e&&(e="请输入合法的手机号码！"),this._isMobile(f)?"":e;case"idno":return""==e&&(e="请输入合法的身份证号码！"),this._isIDNo(f)?"":e;case"zipcode":return""==e&&(e="请输入合法邮政编码！"),this._isZipcode(f)?"":e;default:return""}},_isNumber:function(a){return!isNaN(a)},_isNaturalnumber:function(a){return!!/^[0-9]+$/.test(a)},_isInteger:function(a){return!!/^(\+|-)?\d+$/.test(a)},_isFloat:function(a){return!!/^(\+|-)?\d+($|\.\d+$)/.test(a)},_isZh:function(a){return!!/^[\u4e00-\u9fa5]+$/.test(a)},_isLetter:function(a){return!!/^[A-Za-z]+$/.test(a)},_isUppercase:function(a){return!!/^[A-Z]+$/.test(a)},_isLowercase:function(a){return!!/^[a-z]+$/.test(a)},_isZhOrNumOrLett:function(a){return!!/^[0-9a-zA-Z\u4e00-\u9fa5]+$/.test(a)},_isIp:function(a){return/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/.test(a)?RegExp.$1<256&&RegExp.$2<256&&RegExp.$3<256&&RegExp.$4<256?!0:void 0:!1},_isPort:function(a){return!!(this._isNaturalnumber(a)&&65536>a)},_isUrl:function(a){return!!/^(http|https|ftp):\/\/(www\.)?.+.?$/.test(a)},_isEmail:function(a){return!!/^([-_A-Za-z0-9\.]+)@([_A-Za-z0-9]+\.)+[A-Za-z0-9]{2,3}$/.test(a)},_isMobile:function(a){return!!/^0?(13[0-9]|15[012356789]|17[0-9]|18[0-9]|14[57])[0-9]{8}$/.test(a)},_isIDNo:function(a){var b={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"},c=0,d=a,e=d.length;if(!/^\d{17}(\d|x)$/i.test(d)&&!/^\d{15}$/i.test(d))return!1;if(d=d.replace(/x$/i,"a"),null==b[parseInt(d.substr(0,2))])return!1;if(18==e){var f=d.substr(6,4)+"-"+Number(d.substr(10,2))+"-"+Number(d.substr(12,2)),g=new Date(f.replace(/-/g,"/"));if(f!=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate())return!1;for(var h=17;h>=0;h--)c+=Math.pow(2,h)%11*parseInt(d.charAt(17-h),11);if(c%11!=1)return!1}else if(15==e){f="19"+d.substr(6,2)+"-"+Number(d.substr(8,2))+"-"+Number(d.substr(10,2));var g=new Date(f.replace(/-/g,"/")),i=g.getFullYear().toString()+"-"+(g.getMonth()+1)+"-"+g.getDate();if(f!=i)return!1}return!0},_isZipcode:function(a){return!(!this._isNaturalnumber(a)||6!=a.length)},_isDate:function(a,b){var c,d,e,f,g,h=$.trim(a);if(/^(y{4})(-|\/)(M{1,2})\2(d{1,2})$/.test(b))f=/^(\d{4})(-|\/)(\d{1,2})\2(\d{1,2})$/;else if(/^(y{4})(年)(M{1,2})(月)(d{1,2})(日)$/.test(b))f=/^(\d{4})年(\d{1,2})月(\d{1,2})日$/;else{if("yyyyMMdd"!=b)return!1;f=/^(\d{4})(\d{2})(\d{2})$/}if(g=h.match(f),null==g)return!1;if(/^(y{4})(-|\/)(M{1,2})\2(d{1,2})$/.test(b)?(c=g[1],d=g[3],e=g[4]):(c=g[1],d=g[2],e=g[3]),1>d||d>12)return!1;if(1>e||e>31)return!1;if((4==d||6==d||9==d||11==d)&&31==e)return!1;if(2==d){var i=c%4==0&&(c%100!=0||c%400==0);if(e>29)return!1;if(29==e&&!i)return!1}return!0},showRequiredMark:function(a){var b=a.component;b.find("span.coral-validate-required:first").remove(),b.append("<span class='coral-validate-required'>*</span>")},hideRequiredMark:function(a){var b=a.component;b.find("span.coral-validate-required:first").remove()},showErrors:function(a,b,c,d){var e=a;(a.hasClass("coral-hasLabel")||a.hasClass("coral-validate-starBefore"))&&(a.find(".coral-radio-label").length?a=a.find(".coral-radio-label"):a.find(".coral-checkbox-label").length?a=a.find(".coral-checkbox-label"):a.find(".coral-label").next().length?a=a.find(".coral-label").next():a.find(".coral-validate-required").next().length&&(a=a.find(".coral-validate-required").next()));var f,g,h=$(a).parents("form"),i="tooltip",j=b.join("<br />"),k=$(a),l=k.attr("id"),f=$("."+l+validateSuffix),m="coral-validate-errorArrow-top";switch(0!=$(a).parents("form").length&&(i=$(h).form("option","container")),c){case"leftTop":m="coral-validate-errorArrow-top";break;case"leftBottom":m="coral-validate-errorArrow-bottom";break;case"rightTop":m="coral-validate-errorArrow-top";break;case"rightBottom":m="coral-validate-errorArrow-bottom";break;case"right":m="coral-validate-errorArrow-right"}var n='<div class="'+m+'"></div>';if(null==l&&(l=k.attr("id",validatePrefix+validate_uuid++).attr("id")),$("."+l+validateSuffix).length>0)$("."+l+validateSuffix).find(".error-content").html(j);else{f=$("<div class='"+l+validateSuffix+" coral-validate-state-error'><div class='error-content'>"+j+"</div>"+n+"</div>");var o=$(a).parents("form").attr("context");$(o).length>0?$(o).append(f):$(document.body).append(f),g=k.position()}var p="left top",q="right-20 top-"+(f.outerHeight()+8);switch(c){case"leftTop":p="right top",q="left+"+f.outerWidth()+" top-"+(f.outerHeight()+8);break;case"leftBottom":p="right bottom",q="left+"+f.outerWidth()+" bottom+"+(f.outerHeight()+8);break;case"rightTop":p="left top",q="right-20 top-"+(f.outerHeight()+8);break;case"rightBottom":p="left bottom",q="right-20 bottom+"+(f.outerHeight()+8);break;case"right":p="left middle",q="right+15 middle"}f.position({my:p,at:q,of:k}),e.addClass("coral-validate-error");setTimeout(function(){},2e3)},clearErrors:function(a){var b=$.coral.findComponent(".ctrl-form-element",a),c=0,d=b.length;for(c;d>c;c++){var e=b[c];e.clearError()}},clear:function(){$(".coral-validate-state-error").remove(),$(".coral-errorIcon").remove(),$(".coral-validate-error").removeClass("coral-validate-error")},hideErrors:function(a){var b=$(a),c=b.attr("id");$("."+c+validateSuffix).remove(),$(".coral-errorIcon",b).remove(),b.removeClass("coral-validate-error hasErrorIcon ")},hideErrorsTip:function(a){var b=$(a),c=b.attr("id");$("."+c+validateSuffix).remove()},_showTooltip:function(a,b){var c=$(a),d=$("<div class='coral-validate-tooltip'>"+b+"</div>");$(document.body).after(d);c.position();d.position({my:"left top",at:"right+20 top+"+($(a).height()/2-d.outerHeight()/2),of:c})},_hideTooltip:function(a){$(a);$(".coral-validate-tooltip").remove()},_getSubString:function(a,b){var c=/[^\x00-\xff]/g;if(a.replace(c,"mm").length<=b)return a;for(var d=Math.floor(b/2),e=d;e<a.length;e++)if(a.substr(0,e).replace(c,"mm").length>=b)return a.substr(0,e);return a},_getByteLength:function(a){for(var b=0,c=0;c<a.length;c++){var d=a.charAt(c);b+=null!=d.match(/[^\x00-\xff]/gi)?2:1}return b},_isPositiveInteger:function(a){return"NaN"===parseInt(a).toString()?!1:parseInt(a)>0},showTooltip:function(a,b){b=$.extend(!0,{},$.validate.validTypeOptions,b);var c=b.maxlength.showTooltip;c&&($(a).attr("tooltips","tooltips"),$(a).tooltip({items:"[tooltips]"}).addClass("hasTooltip"),$.validate.getMaxLength(a),$(a).on({keyup:function(b){$.validate.getMaxLength(a)}}))},getMaxLength:function(a){var b=0,c=$(a).val(),d=$(a).attr("component-role"),e=$(a)[d]("option","isLabel"),f=$(a)[d]("option","readonly"),g=$(a)[d]("option","readonlyInput"),h=$.validate._getByteLength(c),i=$(a)[d]("option","maxlength"),b=i-h;0==e&&0==f&&0==g&&$(a).tooltip("option","content","还可以输入"+b+"个字符")},restrictInput:function(a,b,c){var d=$(a).attr("component-role"),e=$(a)[d]("option"),f=null;return $.each($.validate.validTypeNames,function(c,d){var g=e[d],h=$.validate.validTypeOptions[d],i=$.validate.validTypeOptions[g],j=null,k=null;g&&h?(j=d,k=h):g&&i&&(j=g,k=i),j&&k&&k.restrictInput&&(f=$.validate.forbiddenInput(j,b,a))}),f},forbiddenInput:function(a,b,c){var d=$(c).attr("component-role"),e=$(c)[d]("option"),f=null,g=c.val();switch(a){case"maxlength":if(!b.ctrlKey&&-1==$.inArray(b.keyCode,[8,46,9,37,39,35,36])&&""!==$.validate._checkMaxlength(e[a],g+String.fromCharCode(b.keyCode))){for(var h=0,i=[],j=0;j<g.length;j++){var k=g.charAt(j);null!==k.match(/[^\x00-\xff]/gi)?(h+=2,h<=e[a]&&i.push(k)):(h+=1,h<=e[a]&&i.push(k))}c.val(i.join("")),f=!1}break;case"number":!b.ctrlKey&&-1==$.inArray(b.keyCode,[8,46,9,37,39,35,36])&&(b.keyCode<48||b.keyCode>57&&b.keyCode<96||b.keyCode>105)&&(f=!1);var l=/^[0-9]+.?[0-9]*$/;l.test(g)||$(c).val("")}return f},_changeRequiredMark:function(a,b){var c,d=a.attr("component-role"),e=a.closest(".ctrl-init-form");e.length>0&&(c=e.form("option"));var f=a[d]("option","showRequiredMark"),g=a[d]("option","hideRequiredMark"),h=null==f?c&&c.showRequiredMark||$.validate.showRequiredMark:f,i=null==g?c&&c.hideRequiredMark||$.validate.hideRequiredMark:g;h=$.coral.toFunction(h),i=$.coral.toFunction(i),b===!0?h&&h.apply(a[0],[{component:a[d]("component")}]):i&&i.apply(a[0],[{component:a[d]("component")}])},validItem:function(a,b,c){var d=this.options,e={validoptions:d,hasTips:c,element:a},f=$(a).attr("component-role"),g=$(a)[f]("option"),h=g.excluded;h||$.validate.validateField(b,e)},setExcluded:function(a,b){var c=$.coral.findComponent(".ctrl-form-element",$(b)),d=0,e=c.length;for(d;e>d;d++){var f=c[d];f._setOption("excluded",a),f.component().removeClass("coral-validate-error"),f.component().removeAttr("data-errors"),$(".coral-errorIcon",f.component()).remove(),f.element.prop("isError",!1)}}},$.component("coral.validate",{version:$.coral.version,options:{onStatus:"onstatus",showStar:!0,errMessages:{required:"* 必输项",minLength:"{0}",maxLength:"{0}",pattern:"",validType:{number:""},valid:""},fields:{},errMsgPosition:"leftBottom",excluded:[":disabled",":hidden",":not(:visible)"]},_isExclud:function(a,b){if(!b)return!1;for(var c=b.length,d=a.attr("component-role"),e=a[d]("option"),f=e.excluded,g=a[d]("component"),h=0;c>h;h++)if("string"==typeof b[h]&&g.is(b[h])||f)return!0;return!1},_create:function(){this.element.addClass("coral-validate ctrl-init ctrl-init-validate"),this.element.addClass("inited-validate")},_destroy:function(){this.element.removeClass("coral-validate ctrl-init ctrl-init-validate"),this._super()},_setOption:function(a,b){"id"!=a&&"name"!=a&&this._super(a,b)},removeField:function(){},updateField:function(){},_initField:function(){$(this.element).find(".ctrl-form-element")},valid:function(a){a||(a=this.element);var b=this,c=null,d=0,e=this.options.excluded,f=null,g=!0;return e&&"string"==typeof e&&(e=$.map(e.split(","),function(a){return $.trim(a)})),c=a.is($("[class*='coral-validation-']"))?$(a):$(a).find($("[class*='coral-validation-']")),"form"===$(a)[0].tagName.toLowerCase()&&(f=$(a).form("option","errTipsType")),f="none",c.each(function(a){var c=$(this),h=$.validate.getFieldType(c);b._isExclud(c,e)||("none"===f&&(g=!1),$.validate.validItem(c,null,g),c.prop("isError")&&("first"===f&&(g=!1),0==d&&c[h]("focus"),++d))}),!(d>0)}});