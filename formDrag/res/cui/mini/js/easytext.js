/*! cui 2016-11-08 */
!function(){"use strict";var a="easyinput",b="easytext",c=a+b.charAt(0).toUpperCase()+b.slice(1);$.component(a+"."+b,{options:{currentValue:"",values:[],maxWidth:200,minWidth:80,maxChars:200,storage:"array",ajaxConfig:{url:"/",id:"",UPDATETemplate:"",UPDATEData:{},GETCallback:null}},_name:b,_input:null,_id:null,_valuesIndex:null,_classUnChanged:null,_classEmpty:null,_classOnEdit:null,_classChanged:null,_classEasyText:b.toLowerCase(),_setListeners:function(){this._input.bind({focus:this._focusBehaviour,input:this._autoGrownBehaviour,blur:this._blurBehaviour,storageChange:this._storageChange})},_getClassName:function(a){return this._name.toLowerCase()+"-"+a},_setClassNames:function(){this._classOnHover=this._getClassName("onHover"),this._classUnChanged=this._getClassName("unChanged"),this._classOnEdit=this._getClassName("onEdit"),this._classChanged=this._getClassName("changed"),this._classEmpty=this._getClassName("empty")},_setVars:function(){var a=this.element;this._input=a,a.uniqueId(),this._valuesIndex=0,this._id=this._name+"-"+a.attr("id"),a.attr("maxLength",this.options.maxChars)},_setRuler:function(){var a="#"+this._name+"-ruler",b=$(a),c=this._input;b.length||(String.prototype.visualLength=function(){var b=$(a);return b.html(this.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),b.width()},b=$('<span id="'+a.substr(1)+'"></span>'),b.css({fontSize:c.css("fontSize"),fontFamily:c.css("font-family"),fontWeight:c.css("fontWeight"),position:"absolute",visibility:"hidden",whiteSpace:"nowrap"}),$("body").after(b))},_initializeAjax:function(){var a=this.options.ajaxConfig;$.isFunction(a.GETCallback)&&("/"!==a.url.charAt(a.url.length-1)&&(a.url+="/"),a.id||(a.id=this._id),$.ajax({url:a.url+a.id,succes:a.GETCallback}))},_setState:function(){var a,b=this._input,c=b.val(),d=c.visualLength(),e=this.options.minWidth,f=this.options.maxWidth;a=e>d?e:d>f?f:d,b.width(a),0===b.val().length?(b.removeClass(this._classChanged),b.addClass(this._classEmpty)):b.addClass(this._classChanged)},_focusBehaviour:function(){var a=$(this).data(c),b=a._input;b.removeClass(a._classChanged+" "+a._classUnChanged+" "+a._classEmpty).addClass(a._classOnEdit)},_autoGrownBehaviour:function(){var a=$(this).data(c),b=a._input,d=b.val(),e=a.options.minWidth,f=a.options.maxWidth,g=d.visualLength();e>g?g=e:g>f&&(g=f),b.width(g)},_blurBehaviour:function(){var a=$(this).data(c),b=a._input,d=b.val(),e=a.options.ajaxConfig;b.removeClass(a._classOnEdit),0===d.length?b.addClass(a._classEmpty):(b.addClass(a._classChanged),a.option("values",d),a._valuesIndex=a.option("values").length-1,"ajax"===a.options.storage&&(e.UPDATEData.value=b.val(),$.ajax({url:e.url+e.id,data:a._tmpl(e.UPDATETemplate,e.UPDATEData),type:"UPDATE"}))),a._setState()},_tmpl:function(a,b){var c="string"!=typeof a?function(){throw{name:"Invalid Parameter",message:"You must insert a string into the function"}}():new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return b?c(b):c},_setOption:function(a,b){var c=this.options;switch(a){case"values":return c.values.push(b),void("localStorage"===c.storage&&localStorage.setItem(this._id,JSON.stringify(c.values)));case"currentValue":this.option("values",b),this._input.val(b)}this._super("_setOption",a,b)},_create:function(){var a,b,c=this.options.storage;this._setClassNames(),this._setVars(),this._setListeners(),b=this._input,b.addClass(this._classEasyText),"localStorage"===c?localStorage[this._id]&&(a=JSON.parse(localStorage[this._id]),this.options.values=a,b.val(a[a.length-1]),this._valuesIndex=a.length-1):"ajax"===c&&this._initializeAjax(),this._setRuler(),this._setState()},_destroy:function(){this._input.attr("class","")},deleteStorage:function(){var a=this.options.ajaxConfig,b=this.options.storage;"localStorage"===b?localStorage.removeItem(this._id):"ajax"===b&&$.ajax({url:a.url+a.id,type:"DELETE"}),this.options.values=[],this._input.val(""),this._setState()},getNextBackValue:function(a){var b=this.option("values"),c=this._valuesIndex;if(void 0===a&&(a=!0),"boolean"!=typeof a)throw new Error("Invalid parameter");return c+=a?1:-1,void 0===b[c]?-1:(this._valuesIndex=c,this._input.val(b[c]),this._setState(),b[c])}})}();