/*! cui 2016-11-08 */
$.component("coral.radiolist",$.coral.formelement,{version:"4.0.1",castProperties:["data","triggers","showRequiredMark","hideRequiredMark","shortCut"],options:{id:null,name:null,valueField:"value",textField:"text",required:!1,labelField:null,starBefore:!1,showStar:!0,column:null,disabled:!1,readonly:!1,isLabel:!1,isCheck:!1,allowCancel:!1,value:"",valueIndex:null,data:[],url:null,termSplit:";",itemSplit:":",repeatLayout:"table",itemWidth:"auto",errMsg:null,errMsgPosition:"leftBottom",onLoad:null,onValidError:null,onKeyDown:null,onValidSuccess:null,triggers:null,excluded:!1,onChange:$.noop},_create:function(){this.options;this._prepareInit(),this._initComponent(),this._setDefaultValue(),this._initData(),this._bindEvent(),(this.options.url||this.options.data)&&this._trigger("onLoad",null,[{data:this.getData()}])},_prepareInit:function(){this.isInit=!1},_initComponent:function(){this.element.addClass("coral-form-element-radiolist coral-validation-radiolist ctrl-init ctrl-form-element ctrl-init-radiolist"),"undefined"==typeof this.element.attr("id")&&!!this.options.id&&that.element.attr("id",this.options.id),this.options.id=this.element.uniqueId().attr("id");var a=this.element.attr("value");a&&(this.options.value=a);var b=this.element.attr("name");"undefined"!=typeof b?this.options.name=b:this.element.attr("name",this.options.name),this.uiBoxlist=$('<span class="coral-radiolist"></span>'),this.uiInput=$('<input type="hidden">'),this.options.name&&(this.uiInput.attr("name",this.options.name),this.element.removeAttr("name").attr("orgname",this.options.name)),this.uiInput.appendTo(this.uiBoxlist),this.options.labelField&&(this.uiLabel=$('<label class="coral-label">'+this.options.labelField+"</label>"),this.uiBoxlist.prepend(this.uiLabel),this.uiBoxlist.addClass("coral-hasLabel")),this.uiBoxlist.insertAfter(this.element),this.element.hide()},_setDefaultValue:function(){},reload:function(a){var b=this,c={},d=[],e=!1;a||b.options.url?!a&&b.options.url&&(a=b.options.url):a=[],"string"!=typeof a?(c=a,c.data?d=c.data:c.url?(a=c.url,b.options.url=c.url,e=!0):c instanceof Array?d=a:c.url||c.data||b.options.url?c.url||c.data||!b.options.url||(a=b.options.url,e=!0):d=[]):(b.options.url=a,e=!0),this.uiBoxlist.empty(),e?(this.xhr&&this.xhr.abort(),this.xhr=$.ajax(this._ajaxSettings()),this.xhr.success(function(a){b._loadData(a)}).complete(function(a,c){a===b.xhr&&(b.xhr=null)}).error(function(){$.alert("Json Format Error!")})):b._loadData(d)},_initData:function(){var a=this,b=this.options;b.url?(this.xhr&&this.xhr.abort(),this.xhr=$.ajax(this._ajaxSettings()),this.xhr.success(function(b){a._loadData(b)}).complete(function(b,c){b===a.xhr&&(a.xhr=null)}).error(function(){$.alert("Json Format Error!")})):b.data&&this._loadData(b.data)},_ajaxSettings:function(){var a=this.options;return{type:"get",url:a.url,data:{},async:!1,dataType:"json"}},_loadData:function(a){var b,c,d=null,e=0,f=null,g=null,h=null;if("string"==typeof a)for(d=a.split(this.options.termSplit),a=[];e<d.length;e++)g=d[e],h=g.split(this.options.itemSplit),f={},f[this.options.valueField]=h[0],f[this.options.textField]=h[1],a.push(f);for(this.data=a,e;e<a.length;e++)b=a[e],b.checked&&(c=b[this.options.valueField]);this.options.value&&(c=this.options.value),this.isInit||(this.isInit=!0,this.originalValue=c),this._renderRadioItem(),this.setValue(c)},_renderRadioItem:function(){"table"==this.options.repeatLayout?(null==this.options.column&&(this.options.column=3),this._renderTableItem(),this.uiTable.appendTo(this.uiBoxlist)):"flow"==this.options.repeatLayout&&(null==this.options.column&&(this.options.column=this.data.length),this._renderFlowItem(),this.uiBorder.appendTo(this.uiBoxlist))},reset:function(){this.setValue(this.originalValue)},getData:function(){return this.data},_renderFlowItem:function(){var a=this,b=this.options,c=this.options.column,d=this.data;a.uiBorder=$('<span class="coral-radiolist-border"></span>');for(var e in d)e>c-1&&e%c===0&&$("<br/>").appendTo(a.uiBorder),a._renderItem(d[e]).css("width",b.itemWidth).appendTo(a.uiBorder)},_renderTableItem:function(){this.uiTable=$("<table></table>");var a=0,b=0,c=this.data,d=c.length||0,e=this.options.column,f=0,g=null,h=null;if(c&&!(c.length<1))for(f=Math.ceil(d/e);f>a;a++){for(g=$("<tr></tr>"),b=0;e>b;b++)h=$("<td></td>"),d>a*e+b&&this._renderItem(c[a*e+b]).appendTo(h),h.appendTo(g);g.appendTo(this.uiTable)}},_renderItem:function(a){for(var b,c,d,e,f=this.data,g=!1,h=0;h<f.length;h++)1==f[h].checked&&(g=!0);return g?this.tabIndex=h:this.tabIndex=0,c=a.hidden===!0?"hidden":"",d=a.checked===!0?"tabindex = 0":"",e=a.checked===!0?"tabbable":"",g||a[this.options.valueField]!=f[0].value?b=$("<span class='coral-radio "+c+e+"'"+d+"></span>"):(d="tabindex = 0",b=$("<span class='coral-radio "+c+"tabbable '"+d+"></span>")),uiLabel=$("<label class='coral-radio-label'></label>"),uiIcon=$("<span class='coral-radio-icon'></span>"),value=a[this.options.valueField],text=a[this.options.textField],b.attr("value",value),uiLabel.append(uiIcon).append(text),uiLabel.appendTo(b),uiIcon.addClass("cui-icon-radio-unchecked"),b},_bindEvent:function(){var a=this;this.options.disabled&&this._setDisabled(this.options.disabled),this.options.readonly&&this._setReadonly(this.options.readonly),this.options.isLabel&&this._setIsLabel(this.options.isLabel),this._on({"mouseenter .coral-radio":function(b){if(a.options.readonly||a.options.isLabel)return!1;var c=$(b.target).closest(".coral-radio");$(c).hasClass("coral-state-disabled")||$(c).addClass("coral-radio-hover")},"mouseleave .coral-radio":function(b){if(a.options.readonly||a.options.isLabel)return!1;var c=$(b.target).closest(".coral-radio");$(c).hasClass("coral-state-disabled")||$(c).removeClass("coral-radio-hover")},"focus .coral-radio":function(a){var b=$(a.target).closest(".coral-radio");$(b).addClass("coral-radio-highlight")},"blur .coral-radio":function(a){var b=$(a.target).closest(".coral-radio");$(b).removeClass("coral-radio-highlight")},"keydown .coral-radio":function(b){var c=$.coral.keyCode,d=this.options,e=$(b.target).closest(".coral-radiolist"),f=e.find(".coral-radio");switch(record=0,isChecked=!0,$.each(f,function(a){f[a]==document.activeElement&&(record=a),isChecked=$(f[a]).attr("checked")===!0}),b.keyCode){case c.SPACE:b.preventDefault(),a._selectItem(b);break;case c.LEFT:if(b.preventDefault(),a.options.readonly||a.options.isLabels)return!1;0==record&&(record=f.length);var g=$(f[record-1]),h=g.find(".coral-radio-icon"),i=g.attr("value");g.attr("tabindex","0"),$(f[record]).removeAttr("tabindex"),g.addClass("tabbable"),$(f[record]).removeClass("tabbable"),a.setValue(i),setTimeout(function(){g.focus()}),a._trigger("onChange",null,{value:i,checked:h.hasClass("coral-radiolist-item-hightlight")});break;case c.RIGHT:if(b.preventDefault(),a.options.readonly||a.options.isLabel)return!1;record==f.length-1&&(record=-1);var g=$(f[record+1]),h=g.find(".coral-radio-icon"),i=g.attr("value");g.attr("tabindex","0"),$(f[record]).removeAttr("tabindex"),g.addClass("tabbable"),$(f[record]).removeClass("tabbable coral-radio-highlight"),a.setValue(i),setTimeout(function(){g.focus()}),a._trigger("onChange",null,{value:i,checked:h.hasClass("coral-radiolist-item-hightlight")})}d.shortCut&&$.coral.callFunction(d.shortCut,event,this),a._trigger("onKeyDown",b,{})},"click .coral-radio":function(b){a.options.disabled||a.options.readonly||(a._selectItem(b),b.stopPropagation())}})},_selectItem:function(a){var b=this,c=$(".coral-radiolist").find(".coral-radio"),d=$(a.target).closest(".coral-radio");if(b.options.readonly||b.options.isLabel)return!1;var e=d,f=e.find(".coral-radio-icon"),g=e.attr("value"),h=b.getValue();if($.each(c,function(a){$(c[a]).hasClass("tabbable")&&($(c[a]).removeClass("tabbable"),$(c[a]).removeAttr("tabindex"))}),e.addClass("tabbable"),e.attr("tabindex","0"),e.focus(),g==h){if(!this.options.allowCancel)return!1;f.removeClass("cui-icon-radio-checked coral-radiolist-item-hightlight ").addClass("cui-icon-radio-unchecked"),c.removeClass("coral-radio-highlight"),b.uiInput.val("")}else b.setValue(g),b._trigger("onChange",null,{value:g,checked:f.hasClass("coral-radiolist-item-hightlight")})},_setDisabled:function(a){a=!!a,this.uiBoxlist.find(".coral-radio").each(function(){$(this).toggleClass("coral-state-disabled",a),$(this).toggleClass("tabbable",!a)}),this.options.disabled=a},_setReadonly:function(a){a=!!a,this.uiBoxlist.find(".coral-radio").each(function(){$(this).toggleClass("coral-readonly",a),$(this).toggleClass("tabbable",!a)}),this.options.readonly=a},_setIsLabel:function(a){a=!!a,this.uiBoxlist.find(".coral-radio").each(function(){$(this).toggleClass("coral-isLabel",a),$(this).toggleClass("tabbable",!a)}),this.options.isLabel=a},_setOption:function(a,b){"id"!==a&&"name"!==a&&("disabled"===a&&this._setDisabled(b),"readonly"===a&&this._setReadonly(b),"isLabel"===a&&this._setIsLabel(b),this._super(a,b))},_destroy:function(){this.component().remove(),this.options.name&&this.element.removeAttr("orgname").attr("name",this.options.name),this.element.removeClass("coral-form-element-radiolist"),this.element.removeClass("coral-validation-radiolist"),this.element.show()},focus:function(){},component:function(){return this.uiBoxlist},disable:function(){this._setDisabled(!0)},readonly:function(){this._setReadonly(!0)},enable:function(){this._setDisabled(!1)},disableItem:function(a){this.uiBoxlist.find('.coral-radio[value="'+a+'"]').toggleClass("coral-state-disabled",!0)},enableItem:function(a){this.options.disabled=!1,this.uiBoxlist.find('.coral-radio[value="'+a+'"]').toggleClass("coral-state-disabled",!1)},show:function(){this.component().show()},hide:function(){this.component().hide()},getValue:function(){return this.uiInput.val()},setValue:function(a){a=a||"",this.uiBoxlist.find(".coral-radiolist-item-hightlight").each(function(){$(this).removeClass("cui-icon-radio-checked coral-radiolist-item-hightlight").addClass("cui-icon-radio-unchecked")});this.uiBoxlist.find('.coral-radio[value="'+a+'"]').find(".coral-radio-icon").removeClass("cui-icon-radio-unchecked").addClass("cui-icon-radio-checked coral-radiolist-item-hightlight");this.uiInput.val(a)},getText:function(a){var b=0,c=this.data,d=null;for(a||(a=this.getValue());b<c.length;b++)if(d=c[b][this.options.valueField],d==a)return c[b][this.options.textField];return""}});