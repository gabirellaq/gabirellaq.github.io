/*! cui 2016-11-08 */
$.component("coral.checkboxlist",$.coral.formelement,{version:"4.0.1",castProperties:["data","triggers","showRequiredMark","hideRequiredMark","shortCut"],options:{id:null,name:null,valueField:"value",textField:"text",required:!1,showStar:!0,maxLabelWidth:"auto",labelField:null,starBefore:!1,column:null,disabled:!1,readonly:!1,isLabel:!1,value:"",data:null,url:null,termSplit:";",itemSplit:":",errMsg:null,errMsgPosition:"leftBottom",repeatLayout:"table",itemWidth:"auto",onValidError:null,onKeyDown:null,onValidSuccess:null,triggers:null,excluded:!1,onChange:$.noop},_create:function(){var a=this,b=this.options;this.element.jquery||(this.element=$(this.element)),this.element.addClass("coral-form-element-checkboxlist  ctrl-init ctrl-form-element ctrl-init-checkboxlist coral-validation-checkboxlist"),"undefined"==typeof a.element.attr("id")&&!!a.options.id&&a.element.attr("id",a.options.id),a.options.id=a.element.uniqueId().attr("id");var c=a.element.attr("name");"undefined"!=typeof c?a.options.name=c:a.element.attr("name",a.options.name),this.uiBoxlist=$('<span class="coral-checkboxlist"></span>'),this.uiInput=$('<input type="hidden">'),this.options.name&&this.uiInput.attr("name",this.options.name),this.options.value&&this.uiInput.val(this.options.value),this._initData(),this._bindEvent(),this.uiInput.appendTo(this.uiBoxlist),b.labelField&&(this.uiLabel=$('<label class="coral-label">'+b.labelField+"</label>"),this.uiBoxlist.prepend(this.uiLabel),this.uiBoxlist.addClass("coral-hasLabel")),this.uiBoxlist.insertAfter(this.element),this.element.hide()},reload:function(a){var b=this,c={},d=[],e=!1;a||b.options.url?!a&&b.options.url&&(a=b.options.url):a=[],"string"!=typeof a?(c=a,c.data?d=c.data:c.url?(a=c.url,b.options.url=c.url,e=!0):c instanceof Array?d=a:c.url||c.data||b.options.url?c.url||c.data||!b.options.url||(a=b.options.url,e=!0):d=[]):(b.options.url=a,e=!0),this.uiBoxlist.empty(),e?(this.xhr&&this.xhr.abort(),this.xhr=$.ajax(this._ajaxSettings()),this.xhr.success(function(a){b._loadData(a)}).complete(function(a,c){a===b.xhr&&(b.xhr=null)}).error(function(){$.alert("Json Format Error!")})):b._loadData(d),this._bindEvent()},_initData:function(){var a=this;this.options;this.options.url?(this.xhr&&this.xhr.abort(),this.xhr=$.ajax(this._ajaxSettings()),this.xhr.success(function(b){a._loadData(b)}).complete(function(b,c){b===a.xhr&&(a.xhr=null)}).error(function(){$.alert("Json Format Error!")})):this.options.data&&this._loadData(this.options.data)},_ajaxSettings:function(){var a=this.options;return{type:"get",url:a.url,data:{},async:!1,dataType:"json"}},_loadData:function(a){var b,c=null,d=[],e=[],f=[],g=0,h=null,i=null,j=null;if("string"==typeof a)for(c=a.split(this.options.termSplit),a=[];g<c.length;g++)i=c[g],j=i.split(this.options.itemSplit),h={},h[this.options.valueField]=j[0],h[this.options.textField]=j[1],a.push(h);for(this.data=a,g;g<a.length;g++)b=a[g],b.checked&&d.push(b[this.options.valueField]),f.push(b[this.options.valueField]);if(this.options.value&&(d=this.options.value.split(",")),this.options.clearOnLoad){for(var k=0;k<d.length;k++)$.inArray(d[k],f)>-1&&e.push(d[k]);d=e}this.isInit||(this.isInit=!0,this.originalValue=d.join(",")),this._renderChkItem(),this.setValue(d)},_renderChkItem:function(){"table"==this.options.repeatLayout?(null==this.options.column&&(this.options.column=3),this._renderTableItem(),this.uiTable.appendTo(this.uiBoxlist)):"flow"==this.options.repeatLayout&&(null==this.options.column&&(this.options.column=this.data.length),this._renderBorderItem(),this.uiBorder.appendTo(this.uiBoxlist))},reset:function(){this.setValue(this.originalValue)},_renderBorderItem:function(){var a=this,b=this.options,c=this.options.column,d=this.data;a.uiBorder=$('<span class="coral-checkboxlist-border"></span>');for(var e in d)e>c-1&&e%c==0&&$("<br/>").appendTo(a.uiBorder),a._renderItem(d[e]).css("width",b.itemWidth).appendTo(a.uiBorder)},_renderTableItem:function(){this.uiTable=$("<table></table>");var a=0,b=0,c=this.data,d=c.length||0,e=this.options.column,f=0,g=null,h=null;if(c&&!(c.length<1))for(f=Math.ceil(d/e);f>a;a++){for(g=$("<tr></tr>"),b=0;e>b;b++)h=$("<td></td>"),d>a*e+b&&this._renderItem(c[a*e+b]).appendTo(h),h.appendTo(g);g.appendTo(this.uiTable)}},_renderItem:function(a){var b=1==a.hidden?"hidden":"",c=$("<span class='coral-checkbox tabbable "+b+"'tabindex=0></span>"),d=$("<span class='coral-checkbox-label'></span>"),e=$("<span class='coral-checkbox-icon'></span>"),f=this.options.maxLabelWidth,g=$(),h=a[this.options.valueField],i=a[this.options.textField];return g="auto"==f?$('<span class="coral-checkbox-text"></span>'):$("<span class='coral-checkbox-text'  title='"+i+"' style='max-width:"+f+"px;'></span>"),c.attr("data-value",h),d.append(e).append(g),d.appendTo(c),e.addClass("cui-icon-checkbox-unchecked"),g.append(i),c},_bindEvent:function(){var a=this;this.options.disabled&&this._setDisabled(this.options.disabled),this.options.readonly&&this._setReadonly(this.options.readonly),this.options.isLabel&&this._setIsLabel(this.options.isLabel),this.uiBoxlist.find(".coral-checkbox").each(function(){$(this).bind("click"+a.eventNamespace,function(b){a._selectItems(b),b.stopPropagation()})}),this._on({"keydown .coral-checkbox":function(b){var c=$.coral.keyCode,d=a.options;switch(b.keyCode){case c.SPACE:b.preventDefault(),a._selectItems(b)}d.shortCut&&$.coral.callFunction(d.shortCut,event,this),a._trigger("onKeyDown",b,{})},"focus .coral-checkbox":function(a){var b=$(a.target).closest(".coral-checkbox");b.addClass("coral-checkbox-highlight")},"blur .coral-checkbox":function(a){var b=$(a.target).closest(".coral-checkbox");b.removeClass("coral-checkbox-highlight")},"mouseenter .coral-checkbox":function(a){var b=$(a.target).closest(".coral-checkbox");b.hasClass("coral-state-disabled")||b.addClass("coral-checkbox-hover")},"mouseleave .coral-checkbox":function(a){var b=$(a.target).closest(".coral-checkbox");b.hasClass("coral-state-disabled")||b.removeClass("coral-checkbox-hover")}}),this.uiBoxlist.find(".coral-checkbox-label").each(function(){$(this).bind("click"+a.eventNamespace,function(b){return a.options.readonly||a.options.isLabel?!1:void 0})})},_selectItems:function(a){var b=this;if(!b.options.disabled&&!b.options.readonly&&!b.options.isLabel){var c=$(a.target).closest(".coral-checkbox"),d=c.find(".coral-checkbox-icon");if(c.hasClass("coral-state-disabled")||c.hasClass("coral-readonly")||c.hasClass("coral-isLabel"))return void event.stopPropagation();d.hasClass("coral-checkboxlist-item-highlight")?(d.removeClass("cui-icon-checkbox-checked coral-checkboxlist-item-highlight").addClass("cui-icon-checkbox-unchecked"),c.removeClass("coral-checkbox-highlight")):(d.removeClass("cui-icon-checkbox-unchecked").addClass("coral-checkboxlist-item-highlight cui-icon-checkbox-checked"),c.addClass("coral-checkbox-highlight"));var e=b.getValue();b._changeValue(),b._trigger("onChange",null,{value:b.uiInput.val(),oldValue:e,checked:d.hasClass("coral-checkboxlist-item-highlight")})}},_changeValue:function(){var a=[];this.uiBoxlist.find(".coral-checkbox").each(function(){$(this).find(".coral-checkbox-icon").hasClass("coral-checkboxlist-item-highlight")&&a.push($(this).attr("data-value"))}),this.uiInput.val(a.toString())},_setDisabled:function(a){a=!!a,this.uiBoxlist.find(".coral-checkbox").each(function(){$(this).toggleClass("coral-state-disabled",a),$(this).toggleClass("tabbable",!a)}),this.options.disabled=a},_setReadonly:function(a){a=!!a,this.uiBoxlist.find(".coral-checkbox").each(function(){$(this).toggleClass("coral-readonly",a),$(this).toggleClass("tabbable",!a)}),this.options.readonly=a},_setIsLabel:function(a){a=!!a,this.uiBoxlist.find(".coral-checkbox").each(function(){$(this).toggleClass("coral-isLabel",a),$(this).toggleClass("tabbable",!a)}),this.options.isLabel=a},_setOption:function(a,b){if("id"!==a&&"name"!==a){if("readonly"===a&&this._setReadonly(b),"isLabel"===a&&this._setIsLabel(b),"disabled"===a)return void this._setDisabled(b);if("maxLabelWidth"===a){var c=b;if("auto"!=b){c+="px";for(var d=this.component().find(".coral-checkbox-text"),e=0;e<d.length;e++){var f=$(d[e]).html();$(d[e]).attr("title",f)}}else c="",this.component().find(".coral-checkbox-text").attr("title","");this.component().find(".coral-checkbox-text").css("max-width",c)}this._super(a,b)}},_destroy:function(){this.component().remove(),this.options.name&&this.element.removeAttr("orgname").attr("name",this.options.name),this.element.removeClass("coral-form-element-checkboxlist"),this.element.removeClass("coral-validation-checkboxlist"),this.element.show()},focus:function(){},component:function(){return this.uiBoxlist},disable:function(){this._setOption("disabled",!0),this._setDisabled(!0)},readonly:function(){this._setReadonly("readonly",!0)},enable:function(){this._setOption("disabled",!1),this._setDisabled(!1)},disableItem:function(a){this.uiBoxlist.find('.coral-checkbox[data-value="'+a+'"]').toggleClass("coral-state-disabled",!0)},enableItem:function(a){this.options.disabled=!1;this.uiBoxlist.find('.coral-checkbox[data-value="'+a+'"]').toggleClass("coral-state-disabled",!1)},show:function(){this.component().show()},hide:function(){this.component().hide()},getValue:function(){return this.uiInput.val()},setValue:function(a,b){this.getValue()||[];this.uiBoxlist.find(".coral-checkboxlist-item-highlight").each(function(){$(this).removeClass("cui-icon-checkbox-checked coral-checkboxlist-item-highlight").addClass("cui-icon-checkbox-unchecked")}),a=a||"";for(var c=0,d=$.isArray(a)?a:a&&"string"==typeof a&&""!==$.trim(a)?a.split(","):[];c<d.length;c++)this.uiBoxlist.find('.coral-checkbox[data-value="'+d[c]+'"]').find(".coral-checkbox-icon").removeClass("cui-icon-checkbox-unchecked").addClass("cui-icon-checkbox-checked coral-checkboxlist-item-highlight");this.uiInput.val(d.toString())},invertCheck:function(a){var b=[];this.uiBoxlist.find(".coral-checkboxlist-item-highlight").each(function(){$(this).removeClass("cui-icon-checkbox-checked coral-checkboxlist-item-highlight").addClass("coral-checkbox-temp")}),this.uiBoxlist.find(".cui-icon-checkbox-unchecked").each(function(){$(this).removeClass("cui-icon-checkbox-unchecked").addClass("cui-icon-checkbox-checked coral-checkboxlist-item-highlight")}),this.uiBoxlist.find(".coral-checkbox-temp").each(function(){$(this).removeClass("coral-checkbox-temp").addClass("cui-icon-checkbox-unchecked")}),this.uiBoxlist.find(".coral-checkbox").each(function(){$(this).find(".coral-checkbox-icon").hasClass("coral-checkboxlist-item-highlight")&&b.push($(this).attr("data-value"))}),this.setValue(b,a)},checkAll:function(){for(var a=[],b=0,c=null,d=this.data;b<d.length;b++)c=d[b],a.push(c[this.options.valueField]);this.setValue(a)},getText:function(a){var b=0,c=this.data,d=null,e=[];for(a=a?a.split(","):this.getValue().split(",");b<c.length;b++)d=c[b][this.options.valueField],$.inArray(d,a)>-1&&e.push(c[b][this.options.textField]);return e.toString()}});