/*! cui 2016-11-08 */
function spinner_modifier(a){return function(){var b=this.element.val();a.apply(this,arguments),this._refresh(),b!==this.element.val()&&this._trigger("onChange")}}var spinner=$.component("coral.spinner",$.coral.formelement,{version:"4.0.3",castProperties:["triggers"],defaultElement:"<input>",componentEventPrefix:"spin",options:{culture:null,icons:{down:"cui-icon-arrow-down3",up:"cui-icon-arrow-up3"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,onChange:null,onSpin:null,onStart:null,onStop:null,triggers:null,excluded:!1},_create:function(){"undefined"!=typeof this.element.attr("id")?this.options.id=this.element.attr("id"):this.options.id&&this.element.attr("id",this.options.id),"undefined"!=typeof this.element.attr("name")?this.options.name=this.element.attr("name"):this.options.name&&this.element.attr("name",this.options.name),"undefined"!=typeof this.element.attr("value")&&(this.options.value=this.element.attr("value")),this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),""!==$.trim(this.element.val())?this.options.value=this.element.text():this.options.value&&this.element.val(this.options.value),this.originalValue=this.getValue(),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var a={},b=this.element;return $.each(["min","max","step"],function(c,d){var e=b.attr(d);void 0!==e&&e.length&&(a[d]=e)}),a},_events:{"mouseenter.coral-textbox-border":function(a){"boolean"==typeof this.options.isLabel&&this.options.isLabel||"boolean"==typeof this.options.readonly&&this.options.readonly||(this.component().addClass("coral-textbox-hover"),this._trigger("onMouseEnter",a,[]))},"mouseleave.coral-textbox-border":function(a){"boolean"==typeof this.options.isLabel&&this.options.isLabel||"boolean"==typeof this.options.readonly&&this.options.readonly||(this.component().removeClass("coral-textbox-hover"),this._trigger("onMouseLeave",a,[]))},keydown:function(a){this._start(a)&&this._keydown(a)&&a.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(a){var b,c;return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),b=this._parse(this.element.val()),isNaN(b)&&(b=0),c=this._restrictMinMax(b),this.setValue(c),void(this.previous!==this.element.val()&&this._trigger("onChange",a)))},mousewheel:function(a,b){if(b){if(!this.spinning&&!this._start(a))return!1;this._spin((b>0?1:-1)*this.options.step,a),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(a)},100),a.preventDefault()}},"mousedown .coral-spinner-button":function(a){function b(){var a=this.element[0]===this.document[0].activeElement;a||(this.element.focus(),this.previous=c,this._delay(function(){this.previous=c}))}var c;c=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),a.preventDefault(),b.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,b.call(this)}),this._start(a)!==!1&&this._repeat(null,$(a.currentTarget).hasClass("coral-spinner-up")?1:-1,a)},"mouseup .coral-spinner-button":"_stop","mouseenter .coral-spinner-button":function(a){return $(a.currentTarget).hasClass("coral-state-active")?this._start(a)===!1?!1:void this._repeat(null,$(a.currentTarget).hasClass("coral-spinner-up")?1:-1,a):void 0},"mouseleave .coral-spinner-button":"_stop"},_draw:function(){var a=this.uiSpinner=this.element.addClass("coral-spinner-input coral-textbox-default").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.options.vertical&&this.component().addClass("spinner-vertical"),this.buttons=a.find(".coral-spinner-button").attr("tabIndex",-1).button().removeClass("coral-corner-all"),this.options.vertical||this.buttons.height()>Math.ceil(.5*a.height())&&a.height()>0&&a.height(a.height()),this.options.disabled&&this.disable()},_keydown:function(a){var b=this.options,c=$.coral.keyCode;switch(a.keyCode){case c.UP:return this._repeat(null,1,a),!0;case c.DOWN:return this._repeat(null,-1,a),!0;case c.PAGE_UP:return this._repeat(null,b.page,a),!0;case c.PAGE_DOWN:return this._repeat(null,-b.page,a),!0}return!1},_uiSpinnerHtml:function(){return"<span class='coral-spinner coral-textbox coral-component'><span class='coral-textbox-border coral-corner-all'></span></span>"},_buttonHtml:function(){return"<a class='coral-spinner-button coral-spinner-up coral-corner-tr'><span class='icon "+this.options.icons.up+"'></span></a><a class='coral-spinner-button coral-spinner-down coral-corner-br'><span class='icon "+this.options.icons.down+"'></span></a>"},_start:function(a){return this.spinning||this._trigger("onStart",a)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(a,b,c){a=a||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,b,c)},a),this._spin(b*this.options.step,c)},_spin:function(a,b){var c=this.value()||0;this.counter||(this.counter=1),c=this._adjustValue(c+a*this._increment(this.counter)),this.spinning&&this._trigger("onSpin",b,{value:c})===!1||(this._value(c),this.counter++)},_increment:function(a){var b=this.options.incremental;return b?$.isFunction(b)?b(a):Math.floor(a*a*a/5e4-a*a/500+17*a/200+1):1},_precision:function(){var a=this._precisionOf(this.options.step);return null!==this.options.min&&(a=Math.max(a,this._precisionOf(this.options.min))),a},_precisionOf:function(a){var b=a.toString(),c=b.indexOf(".");return-1===c?0:b.length-c-1},_adjustValue:function(a){var b,c,d=this.options;return b=null!==d.min?d.min:0,c=a-b,c=Math.round(c/d.step)*d.step,a=b+c,a=parseFloat(a.toFixed(this._precision())),null!==d.max&&a>d.max?d.max:null!==d.min&&a<d.min?d.min:a},_stop:function(a){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("onStop",a))},_restrictMinMax:function(a){var b=this.options.min,c=this.options.max,d=b&&b>a?b:a;return c&&d>c?c:d},_setOption:function(a,b){if("value"===a&&("undefined"!=typeof b?this.value(b):this.value()),"culture"===a||"numberFormat"===a){var c=this._parse(this.element.val());return this.options[a]=b,void this.element.val(this._format(c))}"max"!==a&&"min"!==a&&"step"!==a||"string"==typeof b&&(b=this._parse(b)),"icons"===a&&(this.buttons.first().find(".coral-icon").removeClass(this.options.icons.up).addClass(b.up),this.buttons.last().find(".coral-icon").removeClass(this.options.icons.down).addClass(b.down)),this._super(a,b),"disabled"===a&&(this.component().toggleClass("coral-state-disabled",!!b),this.element.prop("disabled",!!b),this.buttons.button(b?"disable":"enable"))},_setOptions:spinner_modifier(function(a){this._super(a)}),_parse:function(a){return"string"==typeof a&&""!==a&&(a=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(a,10,this.options.culture):+a),a},_format:function(a){return""===a?"":window.Globalize&&this.options.numberFormat?Globalize.format(a,this.options.numberFormat,this.options.culture):a},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var a=this.value();return null===a?!1:a===this._adjustValue(a)},_value:function(a,b){var c;""!==a&&(c=this._parse(a),null!==c&&(b||(c=this._adjustValue(c)),a=this._format(c))),this.element.val(a),this._refresh()},_destroy:function(){this.element.removeClass("coral-spinner-input").removeClass("coral-textbox-default").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.component().replaceWith(this.element)},reset:function(){this.setValue(this.originalValue)},stepUp:spinner_modifier(function(a){this._stepUp(a)}),_stepUp:function(a){this._start()&&(this._spin((a||1)*this.options.step),this._stop())},stepDown:spinner_modifier(function(a){this._stepDown(a)}),_stepDown:function(a){this._start()&&(this._spin((a||1)*-this.options.step),this._stop())},pageUp:spinner_modifier(function(a){this._stepUp((a||1)*this.options.page)}),pageDown:spinner_modifier(function(a){this._stepDown((a||1)*this.options.page)}),setValue:function(a){a=0==a?0:a||"",this.value(a)},getValue:function(a){return this.value()+""},value:function(a){return arguments.length?void spinner_modifier(this._value).call(this,a):this._parse(this.element.val())},component:function(){return this.uiSpinner.parent()}});