/*! cui 2016-11-08 */
$.component("coral.autocompletetree",$.coral.autocomplete,{requestIndex:0,pending:0,options:{allowPushParent:!1,rootNode:!1,multiLineLabel:!1,radioType:"level",showRootNode:!0,showClose:!1,cascadeCheck:!1,multiple:!1,triggers:null,excluded:!1},_create:function(){this.options.render="tree",this._super()},_filter:function(a,b,c){$(this.menu.element).tree("reload",a),$(this.menu.element).tree("filterNodesByParam",{name:b.term}),c(a)},_initData:function(){var a=this;this.menu={};var b=$("<ul>")[0];$(b).uniqueId().addClass("coral-autocomplete-panel coral-front").appendTo(this._appendTo()).tree({showLine:!1,showIcon:!0,radioType:this.options.radioType,checkable:null!=this.options.chkStyle,chkStyle:this.options.chkStyle,showRootNode:this.options.showRootNode,rootNode:this.options.rootNode,componentCls:"coral-autocomplete-tree",beforeClick:function(b,c){if(!a.options.allowPushParent&&c.isParent)return!1;var d=$.coral.toFunction(a.options.beforeClick);return a.options.checkable?!1:$.isFunction(d)?d(b,c):!0},onClick:function(b,c,d){var e=d,f=a.previous;if(a.element[0]!==a.document[0].activeElement&&(a.element.focus(),a.previous=f,a._delay(function(){a.previous=f,a.selectedItem=e})),!1!==a._trigger("beforeNodeClick",b,{item:e,value:a.getValue()})){a.selectedItem=e,a.selectedItems.push(e);var g=a.getValue(),h=a.getText(),i=""==g?[]:g.split(a.options.separator),j=""==h?[]:h.split(a.options.separator);if(a.options.multiple){if(!a.options.allowRepeat&&$.inArray(d.id,i)>-1)return;i.push(d.id),j.push(d.name)}else i=[d.id],j=[d.name];a.setText(j.join(a.options.separator)),a.setValue(i.join(a.options.separator),!0)}a._trigger("onNodeClick",b,{item:e,value:a.getValue()}),a.term=a._text(),a.close(b)},onCheck:function(b,c,d){for(var e=[],f=[],g=$("#"+c).tree("getCheckedNodes",!0),h=a.getValue(),i=a.getText(),f=""==h?[]:h.split(a.options.separator),e=""==i?[]:i.split(a.options.separator),j=0,k=g.length;k>j;j++)if(a.options.cascadeCheck||!g[j].getCheckStatus().half){if(!a.options.allowPushParent&&g[j].isParent)continue;(a.options.allowRepeat||-1==$.inArray(g[j].id,f))&&(e.push(g[j].name),f.push(g[j].id))}a.setValue(f.join(a.options.separator),!0),a._trigger("onNodeCheck",b,{treeId:c,node:d})}}).hide(),this.menu.element=$(b),isNaN(this.options.panelHeight)&&$(".coral-autocomplete-panel").css({"max-height":this.options.maxPanelHeight+"px"})}});